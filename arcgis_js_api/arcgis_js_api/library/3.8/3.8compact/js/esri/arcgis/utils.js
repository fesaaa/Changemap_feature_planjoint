/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/request esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/ImageServiceIdentifyResult".split(" "),function(l,d,p,g,s,n,f,c){l=l(f,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=d.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(a,e,u,m,
q){try{var h=new c(a);this._successHandler([h],"onComplete",u,q)}catch(k){this._errorHandler(k,m,q)}},execute:function(a,c,u,m){var q=m.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json"},a.toJson(q&&q[0])));var h=this._handler,k=this._errorHandler;return s({url:this._url.path,content:a,callbackParamName:"callback",load:function(b,a){h(b,a,c,u,m.dfd)},error:function(b){k(b,u,m.dfd)}})},onComplete:function(){}});n._createWrappers(l);p("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyTask",
l,g);return l})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/geometry/Point esri/tasks/query esri/layers/RenderMode esri/layers/GridLayout".split(" "),function(l,d,p,g,s,n,f,c,a,e){l=l([a],{declaredClass:"esri.layers._OnDemandMode",constructor:function(a){this.featureLayer=a;this._featureMap={};this._queryErrorHandler=p.hitch(this,this._queryErrorHandler)},initialize:function(a){this.inherited(arguments);
var c=this.featureLayer,q=c._srInfo;this._gridLayer=new e(new f(q?q.valid[0]:a.extent.xmin,a.extent.ymax,a.spatialReference),{width:c._tileWidth,height:c._tileHeight},{width:a.width,height:a.height},q);this._cellMap={};this._gridLayer.setResolution(a.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(a){this._init&&(2>a?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(a){var c=this._gridLayer,e=a.geometry,h=[];if(e)for(var h=c.getCellsInExtent("point"===e.type?{xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y}:e.getExtent(),!1).cells,c=this._cellMap,k,b=a.attributes[this.featureLayer.objectIdField],t,r,d,e=0;e<h.length;e++)k=h[e],t=k.latticeID,r=k.row,d=k.col,t?k=c[t]=c[t]||k:(c[r]=c[r]||{},k=c[r][d]=c[r][d]||k),k.features=
k.features||[],k.features.push(a),this._addFeatureIIf(b,a),this._incRefCount(b)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},_enableConnectors:function(){var a=this.map;this._zoomConnect=d.connect(a,"onZoomEnd",this,this._zoomHandler);this._panConnect=d.connect(a,"onPanEnd",this,this._panHandler);this._resizeConnect=d.connect(a,"onResize",this,this._panHandler)},_disableConnectors:function(){d.disconnect(this._zoomConnect);
d.disconnect(this._panConnect);d.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var a=this.featureLayer,c=this.map;a.suspended||(a._fireUpdateStart(),this._clearIIf(),(a=a._trackManager)&&a.clearTracks(),this._cellMap={},this._gridLayer.setResolution(c.extent),this._sendRequest())},_panHandler:function(a){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&a)},_getRequestId:function(a,c){return("_"+a.name+a.layerId+a._ulid+"_"+c.resolution+
"_"+(c.latticeID||c.row+"_"+c.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(a){this._exceeds=!1;var e=this.featureLayer,q=this.map;a=a||q.extent;q=this._gridLayer.getCellsInExtent(a,e.latticeTiling).cells;if(!e.isEditable())var h=this._cellMap,q=g.filter(q,function(b){if(b.lattice){if(h[b.latticeID])return!1}else if(h[b.row]&&h[b.row][b.col])return!1;return!0});var k=e.getOutFields(),b=e.getDefinitionExpression(),t=e._getOffsettedTE(e._mapTimeExtent),r=e.supportsAdvancedQueries?e.getOrderByFields():
null,d=e._usePatch,f=this._ioQueue,w,n=this,z=this._drawFeatures,A,x,B;this._pending=this._pending||0;for(w=0;w<q.length;w++){A=q[w];x=new c;x.geometry=A.extent||A.lattice;x.outFields=k;x.where=b;e.latticeTiling&&A.extent&&(x.spatialRelationship=c.SPATIAL_REL_CONTAINS);x.returnGeometry=!0;x.timeExtent=t;x.maxAllowableOffset=e._maxOffset;e._ts&&(x._ts=(new Date).getTime());x.orderByFields=r;B=null;if(d&&(B=this._getRequestId(e,A),this._isPending(B)))continue;this._pending++;f.push(e._task.execute(x,
function(){var b=A;return function(a){z.apply(n,[a,b])}}.call(this),this._queryErrorHandler,B))}this._removeOldCells(a);this._endCheck()},_drawFeatures:function(a,c){this._exceeds=this._exceeds||a.exceededTransferLimit;this._finalizeIO();var e=this.map.extent,h=c.extent,k=c.row,b=c.col,t=this.featureLayer.objectIdField,r=a.features,d=this._gridLayer,f=this._cellMap,w=c.latticeID,g=w?f[w]:f[k]&&f[k][b];if(c.resolution!=d._resolution||(w?w!==d.getLatticeID(e):!d.intersects(h,e)))g&&this._removeCell(k,
b,w);else if(g)this._updateCell(g,r);else{c.features=r;w?f[w]=c:(f[k]=f[k]||{},f[k][b]=c);h=r.length;for(e=0;e<h;e++)k=r[e],b=k.attributes[t],this._addFeatureIIf(b,k),this._incRefCount(b)}this._endCheck()},_queryErrorHandler:function(a){this._finalizeIO();this.featureLayer._errorHandler(a);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(a){if(0===this._pending){this._processIOQueue();var c=this.featureLayer,e=c._trackManager;e&&(e.clearTracks(),
e.addFeatures(c.graphics),c._ager&&g.forEach(c.graphics,function(a){a._shape&&c._repaint(a)}),e.moveLatestToFront(),e.drawTracks());this.featureLayer._fireUpdateEnd(a&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)c.onQueryLimitExceeded()}},_processIOQueue:function(a){this._ioQueue=g.filter(this._ioQueue,function(a){return-1<a.fired?!1:!0});a&&g.forEach(this._ioQueue,this._cancelPendingRequest)},_removeOldCells:function(a){var c=
this._cellMap,e=this._gridLayer,h,k;for(h in c)if(c[h]){var b=c[h],t=b.latticeID,r=0,d=0;if(t)r++,t!==e.getLatticeID(a)&&(this._removeCell(null,null,t),d++);else for(k in b)b[k]&&(r++,e.intersects(b[k].extent,a)||(this._removeCell(h,k),d++));d===r&&delete c[h]}},_updateCell:function(a,c){var e=this.featureLayer,h=e.objectIdField,e=e._selectedFeatures,k,b=c.length;a.features=a.features||[];for(k=0;k<b;k++){var t=c[k],d=t.attributes[h],f=this._addFeatureIIf(d,t);f===t?(this._incRefCount(d),a.features.push(f)):
d in e||(f.setGeometry(t.geometry),f.setAttributes(t.attributes))}},_removeCell:function(a,c,e){var d=this._cellMap,k=this.featureLayer,b=k.objectIdField,t=e?d[e]:d[a]&&d[a][c];if(t){e?delete d[e]:delete d[a][c];a=t.features;for(c=0;c<a.length;c++)e=a[c].attributes[b],this._decRefCount(e),e in k._selectedFeatures||this._removeFeatureIIf(e)}}});s("extend-esri")&&p.setObject("layers._OnDemandMode",l,n);return l})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on esri/Evented dijit/_WidgetBase".split(" "),
function(l,d,p,g,s,n){return l([n,s],{_onMap:function(d){var c=this.constructor._onMap,a;if(!c||!c.FINAL)delete this.constructor._onMap,c=this.registerConnectEvents(),c.FINAL=!0;d=d.toLowerCase();c[d]?a=this[c[d].method]:(d=this._onCamelCase(d),this[d]&&(a=d));return a},on:function(d,c){var a=this._onMap(d),e=d.replace(/\-/g,""),u="on"+e in this.domNode;return a||!u?this.inherited(arguments):this.own(g(this.domNode,e,c))[0]},emit:function(f,c,a){var e,u,m,q=f.toLowerCase(),h=this.constructor._onMap||
this.registerConnectEvents();u=this[this._onMap(q)];c=c||{};c.target||(c.target=this);u&&(h&&h[q])&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},h[q].argKeys)(c),m=d.mixin({},arguments),m[2]=e,m[0]=h[q].name.replace(/^on/,""));return this.inherited(m||arguments)}})})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(l,d,p,g,s,n,f){var c={_isElementShown:function(a){var c=g.get(a);return"hidden"!=
c.visibility&&"collapsed"!=c.visibility&&"none"!=c.display&&"hidden"!=p.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return p.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var c;try{var d=a.contentDocument;if("designMode"in d&&"on"==d.designMode)return!0;c=d.body}catch(m){try{c=a.contentWindow.document.body}catch(q){return!1}}return c&&("true"==c.contentEditable||c.firstChild&&"true"==
c.firstChild.contentEditable);default:return"true"==a.contentEditable}},isTabNavigable:function(a){return p.get(a,"disabled")?!1:p.has(a,"tabIndex")?0<=p.get(a,"tabIndex"):c.hasDefaultTabStop(a)},_getTabNavigable:function(a){function e(b){return b&&"input"==b.tagName.toLowerCase()&&b.type&&"radio"==b.type.toLowerCase()&&b.name&&b.name.toLowerCase()}var d,m,q,h,k,b,t={},r=c._isElementShown,v=c.isTabNavigable,f=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=n("ie")&&"HTML"!==
a.scopeName||!r(a))){if(v(a)){var c=+p.get(a,"tabIndex");if(!p.has(a,"tabIndex")||0==c)d||(d=a),m=a;else if(0<c){if(!q||c<h)h=c,q=a;if(!k||c>=b)b=c,k=a}c=e(a);p.get(a,"checked")&&c&&(t[c]=a)}"SELECT"!=a.nodeName.toUpperCase()&&f(a)}};r(a)&&f(a);return{first:t[e(d)]||d,last:t[e(m)]||m,lowest:t[e(q)]||q,highest:t[e(k)]||k}},getFirstInTabbingOrder:function(a,e){var f=c._getTabNavigable(d.byId(a,e));return f.lowest?f.lowest:f.first},getLastInTabbingOrder:function(a,e){var f=c._getTabNavigable(d.byId(a,
e));return f.last?f.last:f.highest}};s.mixin(f,c);return c})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has esri/kernel esri/SpatialReference esri/geometry/Extent esri/geometry/webMercatorUtils esri/renderers/SimpleRenderer esri/layers/layer esri/layers/FeatureLayer esri/dijit/PopupTemplate".split(" "),function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k){l=l([q],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(b,c){this.pointSymbol=c&&c.pointSymbol;this.polylineSymbol=c&&c.polylineSymbol;this.polygonSymbol=c&&c.polygonSymbol;this._outSR=c&&(c.outSpatialReference||c.outSR)||new a({wkid:4326});this._options=c},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var b=[];this._fLayers&&(b=b.concat(this._fLayers));return b},onRefresh:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._createLayer()},
_createLayer:function(b){var a=this;this._fireUpdateStart();b=this.parse(b);b.addCallback(function(b){a._io=null;a._initLayer(b)});b.addErrback(function(b){a._io=null;b=p.mixin(Error(),b);b.message="Unable to load resource: "+a.url+" "+(b.message||"");a._fireUpdateEnd(b);a.onError(b)})},_initLayer:function(b){this.loaded&&this._removeInternalLayers();this.name=b.name;this.description=b.description;this.snippet=b.snippet;this.defaultVisibility=void 0!==b.visibility?this.visible=!!b.visibility:this.visible=
!0;this.featureInfos=b.featureInfos;this.fullExtent=this.initialExtent=new e(b.lookAtExtent);this.copyright=b.author||b.copyright;var a;if((b=p.getObject("featureCollection.layers",!1,b))&&0<b.length)this._fLayers=[],g.forEach(b,function(b,c){var e=p.getObject("featureSet.features",!1,b);e&&0<e.length&&(a=p.mixin({outFields:["*"],infoTemplate:b.popupInfo?new k(b.popupInfo):null,editable:!1},this._options),a.id&&(a.id=a.id+"_"+c),b.layerDefinition.capabilities="Query,Data",e=new h(b,a),e.geometryType&&
(this["_"+e.geometryType]=e),this._fLayers.push(e))},this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(b=new m(this.pointSymbol),this._esriGeometryPoint.setRenderer(b)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(b=new m(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(b)));this._esriGeometryPolygon&&
(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(b=new m(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(b)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var b=this._map;this._fireUpdateStart();var a=b.spatialReference,c=this._outSR,e;if(a.wkid)e=a._isWebMercator()&&c._isWebMercator()||a.wkid===c.wkid;else if(a.wkt)e=a.wkt===c.wkt;else{console.log("_setMap - map has invalid spatial reference");
return}if(!e)if(a._isWebMercator()&&4326===c.wkid)this._converter=u.geographicToWebMercator;else if(c._isWebMercator()&&4326===a.wkid)this._converter=u.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(a=this._fLayers)&&0<a.length&&g.forEach(a,function(a){if(this._converter){var c=a.graphics,e,k,d=c?c.length:0;for(e=0;e<d;e++)(k=c[e].geometry)&&c[e].setGeometry(this._converter(k))}b.addLayer(a)},
this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var b=this._map;b&&g.forEach(this.getFeatureLayers(),b.removeLayer,b)},onVisibilityChange:function(b){this._fireUpdateStart();g.forEach(this.getFeatureLayers(),function(a){a.setVisibility(b)});this._fireUpdateEnd()},_setMap:function(b,a){this.inherited(arguments);this._map=b;var c=this._div=s.create("div",null,a);n.set(c,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return c},
_unsetMap:function(b,a){this._io&&this._io.cancel();d.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var c=this._div;c&&(a.removeChild(c),s.destroy(c));this._div=null;this.inherited(arguments)}});f("extend-esri")&&p.setObject("layers._ServiceGeneratedFeatureCollection",l,c);return l})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/config esri/request esri/layers/ServiceGeneratedFeatureCollection".split(" "),
function(l,d,p,g,s,n,f,c){l=l([c],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(a,c){n.defaults.geoRSSService&&(this.serviceUrl=n.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=f({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?p.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(a){this.inherited(arguments);
this.loaded||(this.loaded=!0,this.onLoad(this))}});g("extend-esri")&&d.setObject("layers.GeoRSSLayer",l,s);return l})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has esri/kernel esri/lang dojo/i18n!dojo/cldr/nls/number".split(" "),function(l,d,p,g,s,n,f,c){l=l(null,{declaredClass:"esri.PopupInfo",initialize:function(a,c){if(a){d.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;var f=this._fieldLabels=
{},m=this._fieldsMap={};a.fieldInfos&&p.forEach(a.fieldInfos,function(a){f[a.fieldName]=a.label;m[a.fieldName]=a})}},toJson:function(){return g.fromJson(g.toJson(this.info))},getTitle:function(){},getContent:function(){},getComponents:function(a){var e=this.info,f=a.getLayer(),m=d.clone(a.attributes)||{},q=d.clone(m),h=e.fieldInfos,k="",b="",t,r,v,g=f&&f._getDateOpts&&f._getDateOpts().properties,w={dateFormat:{properties:g,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
h&&p.forEach(h,function(b){var a=b.fieldName;q[a]=this._formatValue(q[a],a,w);g&&(b.format&&b.format.dateFormat)&&(b=p.indexOf(g,a),-1<b&&g.splice(b,1))},this);if(f){var n=f.types,z=f.typeIdField,A=z&&m[z];for(r in m)if(v=m[r],c.isDefined(v)){var x=this._getDomainName(f,n,A,r,v);c.isDefined(x)?q[r]=x:r===z&&(x=this._getTypeName(f,v),c.isDefined(x)&&(q[r]=x))}}e.title&&(k=d.trim(c.substitute(q,this._fixTokens(e.title),w)||""));e.description&&(b=d.trim(c.substitute(q,this._fixTokens(e.description),
w)||""));h&&(t=[],p.forEach(h,function(b){(r=b.fieldName)&&b.visible&&t.push([b.label||r,c.substitute(q,"${"+r+"}",w)||""])}));var B,L;e.mediaInfos&&(B=[],p.forEach(e.mediaInfos,function(b){L=0;v=b.value;switch(b.type){case "image":var a=v.sourceURL,a=a&&d.trim(c.substitute(m,this._fixTokens(a)));L=!!a;break;case "piechart":case "linechart":case "columnchart":case "barchart":L=p.some(v.fields,function(b){return c.isDefined(m[b])});break;default:return}if(L){b=d.clone(b);v=b.value;b.title=b.title?
d.trim(c.substitute(q,this._fixTokens(b.title),w)||""):"";b.caption=b.caption?d.trim(c.substitute(q,this._fixTokens(b.caption),w)||""):"";if("image"===b.type)v.sourceURL=c.substitute(m,this._fixTokens(v.sourceURL)),v.linkURL&&(v.linkURL=d.trim(c.substitute(m,this._fixTokens(v.linkURL))||""));else{var e=m[v.normalizeField]||0;v.fields=p.map(v.fields,function(b){var a=m[b];(a=void 0===a?null:a)&&e&&(a/=e);return{y:a,tooltip:(this._fieldLabels[b]||b)+":\x3cbr/\x3e"+this._formatValue(a,b,w,!!e)}},this)}B.push(b)}},
this));return{title:k,description:b,fields:t&&t.length?t:null,mediaInfos:B&&B.length?B:null,formatted:q,editSummary:f&&f.getEditSummary?f.getEditSummary(a):""}},getAttachments:function(a){var c=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(c&&c.hasAttachments&&c.objectIdField)&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_fixTokens:function(a){return a.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_formatValue:function(a,e,d,f){var q=this._fieldsMap[e];e=q&&q.format;if(!c.isDefined(a)||!q||!c.isDefined(e))return a;var h="",k=[],q=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),b=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(q)h="NumberFormat",k.push("places: "+(c.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),k.length&&(h+="("+k.join(",")+
")");else if(e.dateFormat)h="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return a;a=c.substitute({myKey:a},"${myKey:"+h+"}",d)||"";q&&!b&&(d=s.getLocalization("dojo.cldr","number"),d.group&&(a=a.replace(RegExp("\\"+d.group,"g"),"")));return a},_insertOffset:function(a){a&&(a=c.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,e,d,f,q){var h,k;e&&c.isDefined(d)&&p.some(e,
function(b){if(b.id==d){if((h=b.domains&&b.domains[f])&&"inherited"===h.type)h=this._getLayerDomain(a,f),k=!0;return!0}return!1},this);!k&&!h&&(h=this._getLayerDomain(a,f));if(h&&h.codedValues){var b;p.some(h.codedValues,function(a){return a.code==q?(b=a.name,!0):!1});return b}},_getLayerDomain:function(a,c){var d=a.fields;if(d){var f;p.some(d,function(a){return a.name===c?(f=a.domain,!0):!1});return f}},_getTypeName:function(a,c){var d=a.types;if(d){var f;p.some(d,function(a){return a.id==c?(f=a.name,
!0):!1});return f}}});n("extend-esri")&&(f.PopupInfo=f.PopupInfoTemplate=l);return l})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style esri/kernel esri/config esri/lang esri/request esri/SpatialReference esri/geometry/webMercatorUtils esri/dijit/PopupTemplate esri/layers/layer esri/layers/KMLFolder esri/layers/KMLGroundOverlay esri/layers/MapImageLayer esri/layers/FeatureLayer".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t,r,v,y,w,C){var z=d([r],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(b,a){b||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=a&&a.outSR||new k({wkid:4326});this._options=a;m.defaults.kmlService&&(this.serviceUrl=m.defaults.kmlService);var c=this.linkInfo=a&&a.linkInfo;c&&(this.visible=!!c.visibility,this._waitingForMap=!!c.viewFormat);(!c||c&&
c.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=g.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(b){if(b){var a=b.type,c=b.id,k;switch(a){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(b=this["_"+a])&&(k=g.getObject("_mode._featureMap."+c,!1,b));break;case "GroundOverlay":if(b=this._groundLyr){var e=b.getImages(),a=e.length;for(b=0;b<a;b++)if(e[b].id===c){k=e[b];break}}break;case "ScreenOverlay":break;
case "NetworkLink":s.some(this._links,function(b){return b.linkInfo&&b.linkInfo.id===c?(k=b,!0):!1});break;case "Folder":a=(e=this.folders)?e.length:0;for(b=0;b<a;b++)if(e[b].id===c){k=e[b];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return k}},getLayers:function(){var b=[];this._groundLyr&&b.push(this._groundLyr);this._fLayers&&(b=b.concat(this._fLayers));this._links&&s.forEach(this._links,function(a){a.declaredClass&&b.push(a)});return b},setFolderVisibility:function(b,
a){b&&(this._fireUpdateStart(),(b.visible=a)&&(a=this._areLocalAncestorsVisible(b)),this._setState(b,a),this._fireUpdateEnd())},onRefresh:function(){},_parseKml:function(b){var a=this;this._fireUpdateStart();this._io=h({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(b),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:n.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(b){a._io=null;a._initLayer(b)},error:function(b){a._io=null;b=g.mixin(Error(),
b);b.message="Unable to load KML: "+a.url+" "+(b.message||"");a._fireUpdateEnd(b);a.onError(b)}})},_initLayer:function(b){this.loaded&&this._removeInternalLayers();this.name=b.name;this.description=b.description;this.snippet=b.snippet;this.visibility=b.visibility;this.featureInfos=b.featureInfos;var a,c,e=this.folders=b.folders,k=[],d;if(e){c=e.length;for(a=0;a<c;a++)d=e[a]=new v(e[a]),-1===d.parentFolderId&&k.push(d)}var e=this._links=b.networkLinks,h;c=e?e.length:0;for(a=0;a<c;a++)e[a].viewRefreshMode&&
-1!==e[a].viewRefreshMode.toLowerCase().indexOf("onregion")||(h=g.mixin({},this._options),h.linkInfo=e[a],h.id&&(h.id=h.id+"_"+a),e[a]=new z(e[a].href,h),e[a]._parentLayer=this,e[a]._parentFolderId=this._getLinkParentId(e[a].linkInfo.id));if((e=b.groundOverlays)&&0<e.length){h=g.mixin({},this._options);h.id&&(h.id+="_mapImage");d=this._groundLyr=new w(h);c=e.length;for(a=0;a<c;a++)d.addImage(new y(e[a]))}if((b=g.getObject("featureCollection.layers",!1,b))&&0<b.length)this._fLayers=[],s.forEach(b,
function(b,a){var c=g.getObject("featureSet.features",!1,b);c&&0<c.length&&(h=g.mixin({outFields:["*"],infoTemplate:b.popupInfo?new t(b.popupInfo):null,editable:!1},this._options),h.id&&(h.id=h.id+"_"+a),b.layerDefinition.capabilities="Query,Data",c=new C(b,h),c.geometryType&&(this["_"+c.geometryType]=c),this._fLayers.push(c))},this),0===this._fLayers.length&&delete this._fLayers;c=k.length;for(a=0;a<c;a++)d=k[a],this._setState(d,d.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),
this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();this._links&&s.forEach(this._links,function(b){b.declaredClass&&(a.addLayer(b),b._waitingForMap&&(b._waitingForMap=null,b.visible?b._parseKml(a):b._wMap=a))});var c=a.spatialReference,e=this._outSR,k;if(!c.equals(e))if(c.isWebMercator()&&4326===e.wkid)k=b.geographicToWebMercator;else if(e.isWebMercator()&&4326===c.wkid)k=b.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");
return}this._groundLyr&&(k&&s.forEach(this._groundLyr.getImages(),function(b){b.extent=k(b.extent)}),a.addLayer(this._groundLyr));(c=this._fLayers)&&0<c.length&&s.forEach(c,function(b){if(k){var c=b.graphics,e,d,t=c?c.length:0;for(e=0;e<t;e++)(d=c[e].geometry)&&c[e].setGeometry(k(d))}a.addLayer(b)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var b=this._map;this._links&&s.forEach(this._links,function(b){b.declaredClass&&b._io&&b._io.cancel()});b&&s.forEach(this.getLayers(),
b.removeLayer,b)},_setState:function(b,a){var c=b.featureInfos,e,k,d,t=c?c.length:0,h=a?"show":"hide";for(d=0;d<t;d++)if(e=c[d],k=this.getFeature(e))if("Folder"===e.type)this._setState(k,a&&k.visible);else if("NetworkLink"===e.type)this._setInternalVisibility(k,a);else k[h]()},_areLocalAncestorsVisible:function(b){var a=b.parentFolderId;for(b=b.visible;b&&-1!==a;)a=this.getFeature({type:"Folder",id:a}),b=b&&a.visible,a=a.parentFolderId;return b},_setInternalVisibility:function(b,a){var c=b._parentLayer,
e=b._parentFolderId;for(a=a&&b.visible;a&&c;)a=a&&c.visible,-1<e&&(a=a&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",id:e}))),e=c._parentFolderId,c=c._parentLayer;this._setIntState(b,a)},_setIntState:function(b,a){b&&s.forEach(b.getLayers(),function(c){c.linkInfo?b._setIntState(c,a&&c.visible&&b._areLocalAncestorsVisible(b.getFeature({type:"Folder",id:c._parentFolderId}))):c.setVisibility(a)})},_getLinkParentId:function(b){var a=-1;this.folders&&s.some(this.folders,function(c){return c.networkLinkIds&&
-1!==s.indexOf(c.networkLinkIds,b)?(a=c.id,!0):!1});return a},_checkAutoRefresh:function(){var b=this.linkInfo;if(b)if(this.visible){if(this.loaded&&this._map){var a=b.refreshMode,c=b.refreshInterval,e=b.viewRefreshMode,b=b.viewRefreshTime;a&&(-1!==a.toLowerCase().indexOf("oninterval")&&0<c)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*c));e&&(-1!==e.toLowerCase().indexOf("onstop")&&0<b)&&!this._extChgHandle&&(this._extChgHandle=p.connect(this._map,"onExtentChange",this,
this._extentChanged))}}else this._stopAutoRefresh(),p.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(a){a=a||this._map;var e={},k=this.linkInfo,d=a&&a.extent,t;this._url.query&&(g.mixin(e,this._url.query),t=!!this._url.query.token);if(u.id&&!t&&(t=u.id.findCredential(this._url.path)))e.token=t.token;if(k){t=k.viewFormat;var h=k.httpQuery,k=k.viewBoundScale;if(d&&t){var f=
d,r=d,v=d.spatialReference;v&&(v.isWebMercator()?f=b.webMercatorToGeographic(d):4326===v.wkid&&(r=b.geographicToWebMercator(d)));d=f.getCenter();r=Math.max(r.getWidth(),r.getHeight());k&&(f=f.expand(k));t=t.replace(/\[bboxWest\]/ig,f.xmin).replace(/\[bboxEast\]/ig,f.xmax).replace(/\[bboxSouth\]/ig,f.ymin).replace(/\[bboxNorth\]/ig,f.ymax).replace(/\[lookatLon\]/ig,d.x).replace(/\[lookatLat\]/ig,d.y).replace(/\[lookatRange\]/ig,r).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,
d.x).replace(/\[lookatTerrainLat\]/ig,d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,d.x).replace(/\[cameraLat\]/ig,d.y).replace(/\[cameraAlt\]/ig,r).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,a.width).replace(/\[vertPixels\]/ig,a.height).replace(/\[terrainEnabled\]/ig,0);g.mixin(e,c.queryToObject(t))}h&&(h=h.replace(/\[clientVersion\]/ig,u.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,
l.locale),g.mixin(e,c.queryToObject(h)))}a=[];for(var m in e)q.isDefined(e[m])&&a.push(m+"\x3d"+e[m]);return(a=a.join("\x26"))?"?"+a:""},_setMap:function(b,c){this.inherited(arguments);this._map=b;var k=this._div=a.create("div",null,c);e.set(k,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return k},_unsetMap:function(b,c){this._io&&this._io.cancel();this._stopAutoRefresh();p.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var e=this._div;
e&&(c.removeChild(e),a.destroy(e));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(b){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,b),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&b&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._parseKml()},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});
f("extend-esri")&&g.setObject("layers.KMLLayer",z,u);return z})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(l,d,p,g,s,n,f){s.add("highcontrast",function(){var c=f.doc.createElement("div");c.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("+(d.blankGif||l.toUrl("./resources/blank.gif"))+");";f.body().appendChild(c);var a=g.getComputedStyle(c),
e=a.backgroundImage,a=a.borderTopColor==a.borderRightColor||e&&("none"==e||"url(invalid-url:)"==e);8>=s("ie")?c.outerHTML="":f.body().removeChild(c);return a});n(function(){s("highcontrast")&&p.add(f.body(),"dj_a11y")});return s})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang esri/geometry/jsonUtils".split(" "),function(l,d,p,g,s,n,f){l=l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",
geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(c){var a=c&&c.geometry||this.geometry;c={geometry:a,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?p.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?p.toJson(this.renderingRule.toJson()):null};a&&(c.geometryType=f.getJsonType(a));a=this.timeExtent;c.time=
a?a.toJson().join(","):null;n.isDefined(this.pixelSizeX)&&n.isDefined(this.pixelSizeY)?c.pixelSize=p.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?p.toJson(this.pixelSize.toJson()):null);return c}});g("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyParameters",l,s);return l})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t,r,v,y,w,C,z){function A(b){return function(a){c[a?"set":"remove"](this.domNode,b,a);this._set(b,a)}}q.add("dijit-legacy-requires",!h.isAsync);q.add("dojo-bidi",!1);q("dijit-legacy-requires")&&t(0,function(){l(["dijit/_base/manager"])});var x={};g=n("dijit._WidgetBase",[r,w],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:A("lang"),dir:"",_setDirAttr:A("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",
srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(b){this._set("ownerDocument",b)},attributeMap:{},_blankGif:g.blankGif||l.toUrl("dojo/resources/blank.gif"),_introspect:function(){var b=this.constructor;if(!b._setterAttrs){var a=b.prototype,c=b._setterAttrs=[],b=b._onMap={},e;for(e in a.attributeMap)c.push(e);for(e in a)/^on/.test(e)&&(b[e.substring(2).toLowerCase()]=e),/^_set[A-Z](.*)Attr$/.test(e)&&(e=e.charAt(4).toLowerCase()+e.substr(5,e.length-
9),(!a.attributeMap||!(e in a.attributeMap))&&c.push(e))}},postscript:function(b,a){this.create(b,a)},create:function(b,a){this._introspect();this.srcNodeRef=f.byId(a);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);b&&(this.params=b,k.mixin(this,b));this.postMixInProperties();this.id||(this.id=z.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=y.body(this.ownerDocument);z.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var e=this.srcNodeRef;e&&(e.parentNode&&this.domNode!==e)&&(e.parentNode.replaceChild(this.domNode,e),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var b={},a;for(a in this.params||{})b[a]=this._get(a);d.forEach(this.constructor._setterAttrs,
function(a){if(!(a in b)){var c=this._get(a);c&&this.set(a,c)}},this);for(a in b)this.set(a,b[a])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var b=this.baseClass.split(" ");this.isLeftToRight()||(b=b.concat(d.map(b,function(b){return b+"Rtl"})));a.add(this.domNode,b)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,d.forEach(this.getChildren(),function(b){!b._started&&
(!b._destroyed&&k.isFunction(b.startup))&&(b.startup(),b._started=!0)}))},destroyRecursive:function(b){this._beingDestroyed=!0;this.destroyDescendants(b);this.destroy(b)},destroy:function(b){function a(c){c.destroyRecursive?c.destroyRecursive(b):c.destroy&&c.destroy(b)}this._beingDestroyed=!0;this.uninitialize();d.forEach(this._connects,k.hitch(this,"disconnect"));d.forEach(this._supportingWidgets,a);this.domNode&&d.forEach(z.findWidgets(this.domNode,this.containerNode),a);this.destroyRendering(b);
z.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);this.domNode&&(b?c.remove(this.domNode,"widgetId"):e.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||e.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(b){d.forEach(this.getChildren(),function(a){a.destroyRecursive&&a.destroyRecursive(b)})},uninitialize:function(){return!1},_setStyleAttr:function(b){var a=this.domNode;k.isObject(b)?
m.set(a,b):a.style.cssText=a.style.cssText?a.style.cssText+("; "+b):b;this._set("style",b)},_attrToDom:function(b,e,t){t=3<=arguments.length?t:this.attributeMap[b];d.forEach(k.isArray(t)?t:[t],function(d){var t=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":k.isFunction(e)&&(e=k.hitch(this,e));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;t.tagName?c.set(t,d,e):t.set(d,e);break;case "innerText":t.innerHTML="";t.appendChild(this.ownerDocument.createTextNode(e));
break;case "innerHTML":t.innerHTML=e;break;case "class":a.replace(t,e,this[b])}},this)},get:function(b){var a=this._getAttrNames(b);return this[a.g]?this[a.g]():this._get(b)},set:function(b,a){if("object"===typeof b){for(var c in b)this.set(c,b[c]);return this}c=this._getAttrNames(b);var e=this[c.s];if(k.isFunction(e))var d=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&!k.isFunction(this.focusNode)?"focusNode":"domNode",t=this[e]&&this[e].tagName,h;if(h=t)if(!(h=
x[t])){h=this[e];var f={},r;for(r in h)f[r.toLowerCase()]=!0;h=x[t]=f}r=h;c=b in this.attributeMap?this.attributeMap[b]:c.s in this?this[c.s]:r&&c.l in r&&"function"!=typeof a||/^aria-|^data-|^role$/.test(b)?e:null;null!=c&&this._attrToDom(b,a,c);this._set(b,a)}return d||this},_attrPairNames:{},_getAttrNames:function(b){var a=this._attrPairNames;if(a[b])return a[b];var c=b.replace(/^[a-z]|-[a-zA-Z]/g,function(b){return b.charAt(b.length-1).toUpperCase()});return a[b]={n:b+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(b,a){var c=this[b];this[b]=a;this._created&&a!==c&&(this._watchCallbacks&&this._watchCallbacks(b,c,a),this.emit("attrmodified-"+b,{detail:{prevValue:c,newValue:a}}))},_get:function(b){return this[b]},emit:function(a,c,e){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var k,d=this["on"+a];d&&(k=d.apply(this,e?e:[c]));this._started&&!this._beingDestroyed&&b.emit(this.domNode,
a.toLowerCase(),c);return k},on:function(a,c){var e=this._onMap(a);return e?p.after(this,e,c,!0):this.own(b(this.domNode,a,c))[0]},_onMap:function(b){var a=this.constructor,c=a._onMap;if(!c){var c=a._onMap={},e;for(e in a.prototype)/^on/.test(e)&&(c[e.replace(/^on/,"").toLowerCase()]=e)}return c["string"==typeof b&&b.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?z.findWidgets(this.containerNode):
[]},getParent:function(){return z.getEnclosingWidget(this.domNode.parentNode)},connect:function(b,a,c){return this.own(s.connect(b,a,this,c))[0]},disconnect:function(b){b.remove()},subscribe:function(b,a){return this.own(v.subscribe(b,k.hitch(this,a)))[0]},unsubscribe:function(b){b.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:u.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=m.get(this.domNode,"display")},placeAt:function(b,a){var c=!b.tagName&&
z.byId(b);c&&c.addChild&&(!a||"number"===typeof a)?c.addChild(this,a):(c=c?c.containerNode&&!/after|before|replace/.test(a||"")?c.containerNode:c.domNode:f.byId(b,this.ownerDocument),e.place(this.domNode,c,a),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(b,a){var c=setTimeout(k.hitch(this,function(){c&&(c=null,this._destroyed||k.hitch(this,b)())}),a||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});q("dojo-bidi")&&g.extend(C);
return g})},"esri/layers/FeatureLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n esri/kernel esri/lang esri/request esri/deferredUtils esri/SpatialReference esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/jsonUtils esri/renderers/SimpleRenderer esri/renderers/UniqueValueRenderer esri/renderers/jsonUtils esri/tasks/QueryTask esri/tasks/query esri/tasks/FeatureSet esri/geometry/Extent esri/geometry/jsonUtils esri/geometry/normalizeUtils esri/layers/GraphicsLayer esri/layers/Field esri/layers/TimeInfo esri/layers/FeatureType esri/layers/FeatureTemplate esri/layers/FeatureEditResult esri/layers/LabelClass esri/layers/SnapshotMode esri/layers/OnDemandMode esri/layers/SelectionMode esri/layers/TrackManager dojo/i18n!esri/nls/jsapi dojo/has!extend-esri?esri/layers/agscommon".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t,r,v,y,w,C,z,A,x,B,L,I,K,U,fa,G,M,E,Q,D,X,N,F,H){l=l(U,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],
"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(b,a){this.i18n=u.getLocalization("esri","jsapi");a=a||{};this._outFields=a.outFields;this._loadCallback=a.loadCallback;var c=a._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=a.trackIdField;this.objectIdField=a.objectIdField;this._maxOffset=a.maxAllowableOffset;this._optEditable=a.editable;this._optAutoGen=
a.autoGeneralize;this.editSummaryCallback=a.editSummaryCallback;this.userId=a.userId;this.userIsAdmin=a.userIsAdmin;this.useMapTime=a.hasOwnProperty("useMapTime")?!!a.useMapTime:!0;this.source=a.source;this.gdbVersion=a.gdbVersion;this.orderByFields=a.orderByFields;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();c=this.constructor;switch(this.mode=q.isDefined(a.mode)?a.mode:c.MODE_ONDEMAND){case c.MODE_SNAPSHOT:this._mode=
new X(this);this._isSnapshot=!0;break;case c.MODE_ONDEMAND:this._tileWidth=a.tileWidth||512;this._tileHeight=a.tileHeight||512;this._mode=new N(this);this.latticeTiling=a.latticeTiling;break;case c.MODE_SELECTION:this._mode=new F(this),this._isSelOnly=!0}this._initLayer=p.hitch(this,this._initLayer);this._selectHandler=p.hitch(this,this._selectHandler);this._editable=!1;if(p.isObject(b)&&b.layerDefinition)return this._collection=!0,this.mode=c.MODE_SNAPSHOT,this._initLayer(b),this;this._task=new A(this.url,
{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);var e=a.resourceInfo;e?this._initLayer(e):(this.source&&(e={source:this.source.toJson()},this._url.query=p.mixin(this._url.query,{layer:s.toJson(e)})),this.gdbVersion&&(this._url.query=p.mixin(this._url.query,{gdbVersion:this.gdbVersion})),h({url:c,content:p.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));
this.registerConnectEvents()},_initLayer:function(a,e){if(a||e){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._mode=new X(this),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);if(a.hasOwnProperty("capabilities")){var k=this.capabilities=a.capabilities;k&&-1!==k.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||
(this._editable=this._fserver);q.isDefined(this._optEditable)&&(this._editable=this._optEditable,delete this._optEditable);this._json=s.toJson(this._json);if(this.isEditable())delete this._maxOffset;else if(this.mode!==this.constructor.MODE_SNAPSHOT&&("esriGeometryPolyline"===a.geometryType||"esriGeometryPolygon"===a.geometryType))this._autoGeneralize=q.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===this.constructor.MODE_ONDEMAND,delete this._optAutoGen;var k=a.effectiveMinScale||a.minScale,
d=a.effectiveMaxScale||a.maxScale;!this._hasMin&&k&&this.setMinScale(k);!this._hasMax&&d&&this.setMaxScale(d);this.layerId=a.id;this.name=a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.geometryType=a.geometryType;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new L(a.extent);this.initialExtent=new L(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new b(this.fullExtent.spatialReference.toJson()));
this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;
this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=q.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this._isTable="Table"===this.type;for(var h=this.fields=
[],d=a.fields,k=0;k<d.length;k++)h.push(new fa(d[k]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){d=a.fields;for(k=0;k<d.length;k++)if(h=d[k],"esriFieldTypeOID"===h.type){this.objectIdField=h.name;break}}this.objectIdField||console.debug("esri.layers.FeatureLayer: "+q.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!q.isDefined(this._nextId)){d=this.objectIdField;h=-1;if(this._collection&&d)for(var f=(k=this._featureSet)&&k.features,m=
f?f.length:0,x,k=0;k<m;k++)x=(x=f[k].attributes)&&x[d],x>h&&(h=x);this._nextId=h+1}this.globalIdField=a.globalIdField;if(k=this.typeIdField=a.typeIdField)if(k=!this._getField(k)&&this._getField(k,!0))this.typeIdField=k.name;this.visibilityField=a.visibilityField;if(d=a.defaultSymbol)this.defaultSymbol=y.fromJson(d);var n=this.types=[],A=a.types,u,l,h=(k=this.editFieldsInfo)&&k.creatorField,f=k&&k.editorField;x=h||f;m=[];if(A)for(k=0;k<A.length;k++)u=new M(A[k]),l=u.templates,x&&(l&&l.length)&&(m=
m.concat(l)),n.push(u);A=a.templates;u=this.templates=[];if(A)for(k=0;k<A.length;k++)n=new E(A[k]),x&&m.push(n),u.push(n);for(k=0;k<m.length;k++)if(x=p.getObject("prototype.attributes",!1,m[k]))h&&delete x[h],f&&delete x[f];if(k=a.timeInfo)this.timeInfo=new G(k),this._startTimeField=k.startTimeField,this._endTimeField=k.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?k.trackIdField=this._trackIdField:this._trackIdField=k.trackIdField;this.hasAttachments=
!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var k=a.drawingInfo,I;if(h=k&&k.labelingInfo)this.labelingInfo=g.map(h,function(b){return new D(b)});if(!this.renderer)if(k&&k.renderer){if(I=k.renderer,this.setRenderer(z.fromJson(I)),"classBreaks"===I.type&&this.renderer.setMaxInclusive(!0),!this._collection){var K=I.type,d=[];I=this.renderer;switch(K){case "simple":d.push(I.symbol);break;case "uniqueValue":case "classBreaks":d.push(I.defaultSymbol),d=d.concat(g.map(I.infos,
function(b){return b.symbol}))}var d=g.filter(d,q.isDefined),U=this._url.path+"/images/",Q=this._getToken();g.forEach(d,function(b){var a=b.url;a&&(-1===a.search(/https?\:/)&&-1===a.indexOf("data:")&&(b.url=U+a),Q&&-1!==b.url.search(/https?\:/)&&(b.url+="?token\x3d"+Q))})}}else if(d)A=this.types,0<A.length?(I=new C(this.defaultSymbol,this.typeIdField),g.forEach(A,function(b){I.addValue(b.id,b.symbol)})):I=new w(this.defaultSymbol),this.setRenderer(I);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":K=
new t;break;case "esriGeometryPolyline":K=new r;break;case "esriGeometryPolygon":K=new v}this.setRenderer(K?new w(K):null)}K=k&&k.transparency||0;!q.isDefined(this.opacity)&&0<K&&(this.opacity=1-K/100);this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);if((c("ie")||c("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;this.loaded=
!0;this._fixRendererFields();this._checkFields();this._updateCaps();K=function(){this.onLoad(this);var b=this._loadCallback;b&&(delete this._loadCallback,b(this))};this._collection?(this._fireUpdateStart(),k=this._featureSet,delete this._featureSet,this._mode._drawFeatures(new B(k)),this._fcAdded=!0,K.call(this)):this._forceIdentity(K)}},onRendererChange:function(){this.inherited(arguments);var b=this._getRenderer();this._ager=!(!b||!b.observationAger||!b.observationRenderer);if(b){var a=[],b=g.filter([b,
b.observationRenderer,b.latestObservationRenderer,b.trackRenderer],q.isDefined);g.forEach(b,function(b){p.isFunction(b.attributeField)||a.push(b.attributeField);a.push(b.attributeField2);a.push(b.attributeField3)},this);this._rendererFields=g.filter(a,q.isDefined)}else this._rendererFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&
this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var b=this._getRenderer();this._ager=!(!b||!b.observationAger||!b.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(b&&b.trackRenderer)},_setMap:function(b){var a=this.inherited(arguments),c=this._mode,e=this;c&&c.initialize(b);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=
this.on("graphic-node-add",function(b){b=b.graphic.attributes;(b=e._selectedFeatures[b&&b[e.objectIdField]])&&b.attr("data-selected","")});return a},_unsetMap:function(b){var a=this._mode;a&&a.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);d.disconnect(this._zoomConnect);d.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){var b=this._mode;b&&b.refresh()},getOutFields:function(){return g.filter(this._getOutFields(),
function(b){return"*"===b||!!this._getField(b)},this)},setEditable:function(b){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=b,this;var a=this._editable;this._editable=b;this._updateCaps();if(a!==b)this.onCapabilitiesChange();return this},getEditCapabilities:function(b){var a={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return a;
var c=b&&b.feature;b=b&&b.userId;var e=g.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],p.trim),k=-1<g.indexOf(e,"editing"),d=k&&-1<g.indexOf(e,"create"),a=k&&-1<g.indexOf(e,"update"),e=k&&-1<g.indexOf(e,"delete"),t=this.ownershipBasedAccessControlForFeatures,h=this.editFieldsInfo,f=h&&h.creatorField,h=h&&h.realm,c=(c=c&&c.attributes)&&f?c[f]:void 0,r=!!this.userIsAdmin,f=!t||r||!(!t.allowOthersToUpdate&&!t.allowUpdateToOthers),t=!t||r||!(!t.allowOthersToDelete&&!t.allowDeleteToOthers);
if(r||k&&!d&&!a&&!e)d=a=e=!0;k={canCreate:d,canUpdate:a,canDelete:e};null===c?(k.canUpdate=a&&f,k.canDelete=e&&t):""!==c&&c&&((b=b||this.getUserId())&&h&&(b=b+"@"+h),b.toLowerCase()!==c.toLowerCase()&&(k.canUpdate=a&&f,k.canDelete=e&&t));return k},getUserId:function(){var b;this.loaded&&(b=this.credential&&this.credential.userId||this.userId||"");return b},setUserIsAdmin:function(b){this.userIsAdmin=b},setEditSummaryCallback:function(b){this.editSummaryCallback=b},getEditSummary:function(b,a,c){c=
q.isDefined(c)?c:(new Date).getTime();var e="";c=this.getEditInfo(b,a,c);(a=a&&a.callback||this.editSummaryCallback)&&(c=a(b,c)||"");if(p.isString(c))e=c;else{if(c){b=c.action;a=c.userId;var k=c.timeValue,d=0;b&&d++;a&&d++;q.isDefined(k)&&d++;1<d&&(e=("edit"===b?"edit":"create")+(a?"User":"")+(q.isDefined(k)?c.displayPattern:""))}e=e&&q.substitute(c,this.i18n.layers.FeatureLayer[e])}return e},getEditInfo:function(b,a,c){if(this.loaded){c=q.isDefined(c)?c:(new Date).getTime();a=a&&a.action||"last";
var e=this.editFieldsInfo,k=e&&e.creatorField,d=e&&e.creationDateField,t=e&&e.editorField,e=e&&e.editDateField,t=(b=b&&b.attributes)&&t?b[t]:void 0,e=b&&e?b[e]:null,k=this._getEditData(b&&k?b[k]:void 0,b&&d?b[d]:null,c);c=this._getEditData(t,e,c);var h;switch(a){case "creation":h=k;break;case "edit":h=c;break;case "last":h=c||k}h&&(h.action=h===c?"edit":"creation");return h}},_getEditData:function(b,a,c){var e,k,d;q.isDefined(a)&&(k=c-a,d=0>k?"Full":6E4>k?"Seconds":12E4>k?"Minute":36E5>k?"Minutes":
72E5>k?"Hour":864E5>k?"Hours":6048E5>k?"WeekDay":"Full");if(void 0!==b||d)e=e||{},e.userId=b,d&&(b=f.format,c=new Date(a),e.minutes=Math.floor(k/6E4),e.hours=Math.floor(k/36E5),e.weekDay=b(c,{datePattern:"EEEE",selector:"date"}),e.formattedDate=b(c,{selector:"date"}),e.formattedTime=b(c,{selector:"time"}),e.displayPattern=d,e.timeValue=a);return e},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(b){this.isEditable()||(this._maxOffset=b);return this},
getMaxAllowableOffset:function(){return this._maxOffset},setAutoGeneralize:function(b){if(this.loaded){if(!this.isEditable()&&this.mode!==this.constructor.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType))if(this._autoGeneralize=b){if((b=this._map)&&b.loaded)this._maxOffset=Math.floor(b.extent.getWidth()/b.width)}else delete this._maxOffset}else this._optAutoGen=b;return this},setGDBVersion:function(b){if(!this._collection&&b!==this.gdbVersion&&
(b||this.gdbVersion))this.gdbVersion=b,this._task.gdbVersion=b,this._url.query=p.mixin(this._url.query,{gdbVersion:b}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange();return this},setDefinitionExpression:function(b){this._defnExpr=b;(b=this._mode)&&b.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(b){this._isSnapshot?(this._timeDefn=b,(b=this._mode)&&b.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+
this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(b,a){this._timeOffset=b;this._timeOffsetUnits=a;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(b){this.useMapTime=b;this._toggleTime(!this.suspended);(b=this._mode)&&b.propertyChangeHandler(0)},selectFeatures:function(a,c,e,d){c=c||this.constructor.SELECTION_NEW;a=this._getShallowClone(a);var t=this._map,h=k._fixDfd(new n(k._dfdCanceller));
a.outFields=this.getOutFields();a.returnGeometry=!0;t&&(a.outSpatialReference=new b(t.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return a={features:[]},this._selectHandler(a,c,e,d,h),h;if(t=this._canDoClientSideQuery(a))a={features:this._doQuery(a,t)},this._selectHandler(a,c,e,d,h);else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,d,h,!0),h;var f=this;this._ts&&(a._ts=(new Date).getTime());(h._pendingDfd=this._task.execute(a)).addCallbacks(function(b){f._selectHandler(b,
c,e,d,h)},function(b){f._resolve([b],null,d,h,!0)})}return h},getSelectedFeatures:function(){var b=this._selectedFeatures,a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(b[c]);return a},clearSelection:function(b){var a=this._selectedFeatures,c=this._mode,e;for(e in a)a.hasOwnProperty(e)&&(this._unSelectFeatureIIf(e,c),c._removeFeatureIIf(e));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!b)this.onSelectionClear();return this},setSelectionSymbol:function(b){if(this._selectionSymbol=
b){var a=this._selectedFeatures,c;for(c in a)a.hasOwnProperty(c)&&a[c].setSymbol(b)}return this},getSelectionSymbol:function(){return this._selectionSymbol},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(b,a,c,e,k,d){var t=d.assembly,f=d.dfd;this._applyNormalized(b,t&&t[0]);this._applyNormalized(a,t&&t[1]);this.onBeforeApplyEdits(b,a,c);var r={},m=this.objectIdField,t={f:"json"},q=!1;if(this._collection)d={},d.addResults=b?g.map(b,function(){q=!0;return{objectId:this._nextId++,
success:!0}},this):null,d.updateResults=a?g.map(a,function(b){q=!0;var a=b.attributes[m];r[a]=b;return{objectId:a,success:!0}},this):null,d.deleteResults=c?g.map(c,function(b){q=!0;return{objectId:b.attributes[m],success:!0}},this):null,q&&this._editHandler(d,b,r,e,k,f);else{b&&0<b.length&&(t.adds=this._convertFeaturesToJson(b,0,1),q=!0);if(a&&0<a.length){for(d=0;d<a.length;d++){var v=a[d];r[v.attributes[m]]=v}t.updates=this._convertFeaturesToJson(a,0,0,1);q=!0}if(c&&0<c.length){a=[];for(d=0;d<c.length;d++)a.push(c[d].attributes[m]);
t.deletes=a.join(",");q=!0}if(q){var x=this;return h({url:this._url.path+"/applyEdits",content:p.mixin(t,this._url.query),callbackParamName:"callback",load:function(a){x._editHandler(a,b,r,e,k,f)},error:function(b){x._resolve([b],null,k,f,!0)}},{usePost:!0})}}},queryFeatures:function(b,a,c){return this._query("execute","onQueryFeaturesComplete",b,a,c)},queryRelatedFeatures:function(b,a,c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",b,a,c)},queryIds:function(b,a,
c){return this._query("executeForIds","onQueryIdsComplete",b,a,c)},queryCount:function(b,a,c){return this._query("executeForCount","onQueryCountComplete",b,a,c)},queryAttachmentInfos:function(b,c,e){var d=this._url.path+"/"+b+"/attachments",t=new n(k._dfdCanceller),f=this;t._pendingDfd=h({url:d,content:p.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(e){e=e.attachmentInfos;var k;g.forEach(e,function(c){k=a.objectToQuery({gdbVersion:f._url.query&&f._url.query.gdbVersion,
layer:f._url.query&&f._url.query.layer,token:f._getToken()});c.url=d+"/"+c.id+(k?"?"+k:"");c.objectId=b});f._resolve([e],"onQueryAttachmentInfosComplete",c,t)},error:function(b){f._resolve([b],null,e,t,!0)}});return t},addAttachment:function(b,a,c,e){return this._sendAttachment("add",b,a,c,e)},updateAttachment:function(b,a,c,k,d){c.appendChild(e.create("input",{type:"hidden",name:"attachmentId",value:a}));return this._sendAttachment("update",b,c,k,d)},deleteAttachments:function(b,a,c,e){var d=this._url.path+
"/"+b+"/deleteAttachments",t=new n(k._dfdCanceller),f=this;a={f:"json",attachmentIds:a.join(",")};t._pendingDfd=h({url:d,content:p.mixin(a,this._url.query),callbackParamName:"callback",load:p.hitch(this,function(a){a=a.deleteAttachmentResults;a=g.map(a,function(a){a=new Q(a);a.attachmentId=a.objectId;a.objectId=b;return a});f._resolve([a],"onDeleteAttachmentsComplete",c,t)}),error:function(b){f._resolve([b],null,e,t,!0)}},{usePost:!0});return t},addType:function(b){var a=this.types;if(a){if(g.some(a,
function(a){return a.id==b.id?!0:!1}))return!1;a.push(b)}else this.types=[b];return this._typesDirty=!0},deleteType:function(b){if(this._collection){var a=this.types;if(a){var c=-1;g.some(a,function(a,e){return a.id==b?(c=e,!0):!1});if(-1<c)return this._typesDirty=!0,a.splice(c,1)[0]}}},toJson:function(){var b=this._json;if(b=p.isString(b)?s.fromJson(b):p.clone(b)){var b=b.layerDefinition?b:{layerDefinition:b},a=b.layerDefinition,c=this._collection;if(c&&this._typesDirty){a.types=g.map(this.types||
[],function(b){return b.toJson()});var e=this.renderer,k=a.drawingInfo;e&&!k&&(k=a.drawingInfo={});k&&(e&&-1===e.declaredClass.indexOf("TemporalRenderer"))&&(k.renderer=e.toJson())}e=null;if(!c||this._fcAdded)e={geometryType:a.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};b.featureSet=p.mixin({},b.featureSet||{},e);c&&(b.nextObjectId=this._nextId,a.capabilities=this.capabilities);return b}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},
onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(b){var a=this,c=this._url&&this._url.path;
(this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&c&&m.id&&m.id._hasPortalSession()&&m.id._doPortalSignIn(c)?m.id.getCredential(c).then(function(){a._findCredential();b.call(a)},function(){b.call(a)}):b.call(this)},_updateCaps:function(){var b=this._editable,a=p.trim(this.capabilities||""),c=g.map(a?a.split(","):[],p.trim),e=g.map(a?a.toLowerCase().split(","):[],p.trim),a=g.indexOf(e,"editing"),k,e={Create:g.indexOf(e,"create"),Update:g.indexOf(e,"update"),Delete:g.indexOf(e,
"delete")};if(b&&-1===a)c.push("Editing");else if(!b&&-1<a){b=[a];for(k in e)-1<e[k]&&b.push(e[k]);b.sort();for(k=b.length-1;0<=k;k--)c.splice(b[k],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var b=this._mode;b&&b.suspend()},onResume:function(b){this.inherited(arguments);this._toggleTime(!0);this._updateMaxOffset();var a=this._mode,c=this._map,e=this._getRenderer();if(b.firstOccurrence){this._fixRendererFields();
this._checkFields();this.clearSelection();if(this.timeInfo&&(this._trackIdField||e&&(e.latestObservationRenderer||e.trackRenderer)))this._trackManager=new H(this),this._trackManager.initialize(c);this._zoomConnect=d.connect(c,"onZoomEnd",this,this._updateMaxOffset)}a&&(b.firstOccurrence?a.startup():a.resume())},_updateMaxOffset:function(){var b=this._map;b&&b.loaded&&this._autoGeneralize&&(this._maxOffset=Math.floor(b.extent.getWidth()/b.width))},_toggleTime:function(b){var a=this._map;b&&this.timeInfo&&
this.useMapTime&&a?(this._mapTimeExtent=a.timeExtent,this._timeConnect||(this._timeConnect=d.connect(a,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,d.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(b){this._mapTimeExtent=b;(b=this._mode)&&b.propertyChangeHandler(0)},_getOffsettedTE:function(b){var a=this._timeOffset,c=this._timeOffsetUnits;return b&&a&&c?b.offset(-1*a,c):b},_getTimeOverlap:function(b,a){return b&&a?b.intersection(a):
b||a},_getTimeFilter:function(b){var a=this.getTimeDefinition(),c;if(a&&(c=this._getTimeOverlap(a,null),!c))return[!1];if(b){if(b=c?this._getTimeOverlap(b,c):b,!b)return[!1]}else b=c;return[!0,b]},_getAttributeFilter:function(b){var a=this.getDefinitionExpression();return b?a?"("+a+") AND ("+b+")":b:a},_applyQueryFilters:function(b,a){b.where=this._getAttributeFilter(b.where);b.maxAllowableOffset=this._maxOffset;a&&this.supportsAdvancedQueries&&(b.orderByFields=b.orderByFields||this.getOrderByFields());
if(this.timeInfo){var c=this._getTimeFilter(b.timeExtent);if(c[0])b.timeExtent=c[1];else return!1}return!0},_add:function(b){var a=this._selectionSymbol,c=b.attributes,e=this.visibilityField;a&&this._isSelOnly&&b.setSymbol(a);if(e&&c&&c.hasOwnProperty(e))b[c[e]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(b){var a=[],c=this._map;if(!this._isTable&&c&&!b.text&&!(b.where&&b.where!==this.getDefinitionExpression()||
b.orderByFields&&b.orderByFields.length)){var e=this._isSnapshot,k=this._isSelOnly,d=b.geometry;if(d)if(!k&&b.spatialRelationship===x.SPATIAL_REL_INTERSECTS&&"extent"===d.type&&(e||c.extent.contains(d)))a.push(1);else return;if(c=b.objectIds)if(e)a.push(2);else{var d=c.length,t=this._mode,h=0,f;for(f=0;f<d;f++)t._getFeature(c[f])&&h++;if(h===d)a.push(2);else return}if(this.timeInfo)if(b=b.timeExtent,c=this._mapTimeExtent,e)b&&a.push(3);else if(k){if(b)return}else if(c)if(-1!==g.indexOf(a,2))b&&a.push(3);
else return;else if(0<a.length)b&&a.push(3);else if(b)return;return 0<a.length?a:null}},_doQuery:function(b,a,c){var e=[],k=this._mode,d=this.objectIdField,t,h;if(-1!==g.indexOf(a,2)){var e=[],f=b.objectIds;h=f.length;for(t=0;t<h;t++){var r=k._getFeature(f[t]);r&&e.push(r)}if(0===e.length)return[]}if(-1!==g.indexOf(a,1)){k=0<e.length?e:this.graphics;h=k.length;f=b.geometry._normalize(null,!0);e=[];for(t=0;t<h;t++){var r=k[t],m=r.geometry;m&&(this.normalization&&f.length?(f[0].intersects(m)||f[1].intersects(m))&&
e.push(r):f.intersects(m)&&e.push(r))}if(0===e.length)return[]}-1!==g.indexOf(a,3)&&this.timeInfo&&(k=0<e.length?e:this.graphics,b=b.timeExtent,e=this._filterByTime(k,b.startTime,b.endTime).match);return c?g.map(e,function(b){return b.attributes[d]},this):e},_filterByTime:function(b,a,c){var e=this._startTimeField,k=this._endTimeField,d;this._twoTimeFields||(d=e||k);var t=q.isDefined,h=[],f=[],r,m=b.length,v,x;a=a?a.getTime():-Infinity;c=c?c.getTime():Infinity;if(d)for(r=0;r<m;r++)v=b[r],x=v.attributes,
e=x[d],e>=a&&e<=c?h.push(v):f.push(v);else for(r=0;r<m;r++)v=b[r],x=v.attributes,d=x[e],x=x[k],d=t(d)?d:-Infinity,x=t(x)?x:Infinity,d>=a&&d<=c||x>=a&&x<=c||a>=d&&c<=x?h.push(v):f.push(v);return{match:h,noMatch:f}},_resolve:function(b,a,c,e,d){a&&this[a].apply(this,b);c&&c.apply(null,b);e&&k._resDfd(e,b,d)},_getShallowClone:function(b){var a=new x,c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},_query:function(a,c,e,d,t){var h=this,f=this._map,r=new n(k._dfdCanceller),m=e,x=function(b,e){if(!e&&
"execute"===a&&!h._isTable){var k=b.features,t=h._mode,f=h.objectIdField,m;for(m=k.length-1;0<=m;m--){var v=t._getFeature(k[m].attributes[f]);v&&k.splice(m,1,v)}}h._resolve([b],c,d,r)};if("executeRelationshipQuery"!==a){m=this._getShallowClone(e);m.outFields=this.getOutFields();m.returnGeometry=e.hasOwnProperty("returnGeometry")?e.returnGeometry:!0;var v;f&&(m.outSpatialReference=new b(f.spatialReference.toJson()));if(!this._applyQueryFilters(m,"execute"===a)){switch(a){case "execute":v=new B({features:[]});
break;case "executeForIds":v=[];break;case "executeForCount":v=0}x(v,!0);return r}if(e=this._canDoClientSideQuery(m)){m=this._doQuery(m,e,"executeForIds"===a||"executeForCount"===a);switch(a){case "execute":v=new B;v.features=m;break;case "executeForIds":v=m;break;case "executeForCount":v=m.length}x(v,!0);return r}}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,t,r,!0),r;this._ts&&(m._ts=(new Date).getTime());(r._pendingDfd=this._task[a](m)).addCallbacks(x,
function(b){h._resolve([b],null,t,r,!0)});return r},_convertFeaturesToJson:function(b,a,c,e){var k=[],d=this._selectionSymbol,t=this.visibilityField,h,f=this.objectIdField;if(this.loaded&&(c||e))h=g.filter(this.fields,function(b){return!1===b.editable&&(!e||b.name!==f)});for(c=0;c<b.length;c++){var r=b[c],m={},v=r.geometry,x=r.attributes,q=r.symbol;if(v&&(!e||!this.loaded||this.allowGeometryUpdates))m.geometry=v.toJson();t?(m.attributes=x=p.mixin({},x),x[t]=r.visible?1:0):x&&(m.attributes=p.mixin({},
x));m.attributes&&(h&&h.length)&&g.forEach(h,function(b){delete m.attributes[b.name]});q&&q!==d&&(m.symbol=q.toJson());k.push(m)}return a?k:s.toJson(k)},_selectHandler:function(b,a,c,e,k){var d;e=this.constructor;switch(a){case e.SELECTION_NEW:this.clearSelection(!0);d=!0;break;case e.SELECTION_ADD:d=!0;break;case e.SELECTION_SUBTRACT:d=!1}e=b.features;var t=this._mode,h=[],f=this.objectIdField,r,m;if(d)for(d=0;d<e.length;d++)r=e[d],m=r.attributes[f],r=t._addFeatureIIf(m,r),h.push(r),this._selectFeatureIIf(m,
r,t);else for(d=0;d<e.length;d++)r=e[d],m=r.attributes[f],this._unSelectFeatureIIf(m,t),m=t._removeFeatureIIf(m),h.push(m||r);this._isSelOnly&&t._applyTimeFilter(!0);this._resolve([h,a,b.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,k);if(b.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(b,a,c){var e=this._selectedFeatures,k=e[b];k||(c._incRefCount(b),e[b]=a,this._isTable||(this._setSelectSymbol(a),a.attr("data-selected","")));return k||
a},_unSelectFeatureIIf:function(b,a){var c=this._selectedFeatures[b];c&&(a._decRefCount(b),delete this._selectedFeatures[b],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(b){},_setSelectSymbol:function(b){var a=this._selectionSymbol;a&&!this._isSelOnly&&b.setSymbol(a)},_setUnSelectSymbol:function(b){var a=this._selectionSymbol;a&&!this._isSelOnly&&a===b.symbol&&b.setSymbol(null,!0)},_getOutFields:function(){var b=[this.objectIdField,this.typeIdField,
this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),b=g.filter(b,function(b,a,c){return!!b&&g.indexOf(c,b)===a}),a=p.clone(this._outFields);if(a){if(-1!==g.indexOf(a,"*"))return a;g.forEach(b,function(b){-1===g.indexOf(a,b)&&a.push(b)});return a}return b},_checkFields:function(b){var a=b||this._getOutFields();g.forEach(a,function(b){"*"!==b&&(this._getField(b)||console.debug("esri.layers.FeatureLayer: "+q.substitute({url:this.url,
field:b},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!b&&(!this._isTable&&!this._fserver&&!this._collection)&&(g.some(this.fields,function(b){return b&&"esriFieldTypeGeometry"===b.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+q.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},_fixRendererFields:function(){var b=
this.renderer;this._orderBy=null;if(b&&0<this.fields.length){var a=[],c,e,b=g.filter([b,b.observationRenderer,b.latestObservationRenderer,b.trackRenderer],q.isDefined),k=[].concat(b);g.forEach(b,function(b){g.forEach(b.rendererInfos,function(b){b.renderer&&k.push(b.renderer)})});g.forEach(k,function(b){if((e=b.attributeField)&&!p.isFunction(e))if(c=!this._getField(e)&&this._getField(e,!0))b.attributeField=c.name;if(e=b.attributeField2)if(c=!this._getField(e)&&this._getField(e,!0))b.attributeField2=
c.name;if(e=b.attributeField3)if(c=!this._getField(e)&&this._getField(e,!0))b.attributeField3=c.name;p.isFunction(b.attributeField)||a.push(b.attributeField);a.push(b.attributeField2);a.push(b.attributeField3);if((e=b.rotationInfo&&b.rotationInfo.field)&&!p.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=b.rotationInfo.field=c.name;a.push(e)}if(b.proportionalSymbolInfo){if((e=b.proportionalSymbolInfo.field)&&!p.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=b.proportionalSymbolInfo.field=
c.name;a.push(e);this._orderBy||(this._orderBy=[e+" DESC"])}if((e=b.proportionalSymbolInfo.normalizationField)&&!p.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=b.proportionalSymbolInfo.normalizationField=c.name;a.push(e)}}if(b.colorInfo){if((e=b.colorInfo.field)&&!p.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=b.colorInfo.field=c.name;a.push(e)}if((e=b.colorInfo.normalizationField)&&!p.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=b.colorInfo.normalizationField=
c.name;a.push(e)}}if(!this._orderBy&&b.addBreak&&!p.isFunction(b.attributeField)&&(b.backgroundFillSymbol||this._hasSizeDiff(b)))this._orderBy=[b.attributeField+" DESC"]},this);this._rendererFields=g.filter(a,q.isDefined)}},_hasSizeDiff:function(b){var a=Number.MAX_VALUE,c=-Number.MAX_VALUE,e,k;g.forEach(b.infos,function(b){if(k=b.symbol){e=0;switch(k.type){case "simplemarkersymbol":e=k.size;break;case "picturemarkersymbol":e=(k.width+k.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":e=
k.width;break;case "simplefillsymbol":case "picturefillsymbol":e=k.outline&&k.outline.width}e&&(a=Math.min(a,e),c=Math.max(c,e))}});return a!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-a)},getOrderByFields:function(){var b=this.orderByFields||this._orderBy;return b&&b.length?b:null},_getField:function(b,a){var c=this.fields;if(!c||0===c.length)return null;var e;a&&(b=b.toLowerCase());g.some(c,function(c){var k=!1;(k=a?c&&c.name.toLowerCase()===b?!0:!1:c&&c.name===b?!0:!1)&&(e=c);return k});
return e},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:g.map(g.filter(this.fields,function(b){return!!(b&&"esriFieldTypeDate"===b.type)}),function(b){return b.name})});return this._dtOpts},_applyNormalized:function(b,a){b&&a&&g.forEach(b,function(b,c){b&&a[c]&&b.setGeometry(a[c])})},_editHandler:function(b,a,c,e,k,d){k=b.addResults;var t=b.updateResults;b=b.deleteResults;var h,f,r,m,v=this.objectIdField,x=this._mode,q=this._isTable;h=this.editFieldsInfo;var z=this.getOutFields()||
[],n=h&&h.creatorField,A=h&&h.creationDateField,w=h&&h.editorField,y=h&&h.editDateField;h=h&&h.realm;-1===g.indexOf(z,"*")&&(n&&-1===g.indexOf(z,n)&&(n=null),A&&-1===g.indexOf(z,A)&&(A=null),w&&-1===g.indexOf(z,w)&&(w=null),y&&-1===g.indexOf(z,y)&&(y=null));var z=A||y?(new Date).getTime():null,u=n||w?this.getUserId():void 0;u&&h&&(u=u+"@"+h);if(k)for(h=0;h<k.length;h++)k[h]=new Q(k[h]),q||(f=k[h],f.success&&(f=f.objectId,r=a[h],(m=r._graphicsLayer)&&m!==this&&m.remove(r),m=r.attributes||{},m[v]=f,
n&&(m[n]=u),w&&(m[w]=u),A&&(m[A]=z),y&&(m[y]=z),r.setAttributes(m),x._init&&x.drawFeature(r)));if(t)for(h=0;h<t.length;h++)if(t[h]=new Q(t[h]),!q&&(f=t[h],f.success)){f=f.objectId;r=c[f];if(a=x._getFeature(f))a.geometry!==r.geometry&&a.setGeometry(I.fromJson(r.geometry.toJson())),this._repaint(a,f);r=a||r;m=r.attributes||{};w&&(m[w]=u);y&&(m[y]=z);r.setAttributes(m)}if(b){c=[];for(h=0;h<b.length;h++)if(b[h]=new Q(b[h]),!q&&(f=b[h],f.success&&(f=f.objectId,r=x._getFeature(f))))this._unSelectFeatureIIf(f,
x)&&c.push(r),r._count=0,x._removeFeatureIIf(f);if(0<c.length)this.onSelectionComplete(c,this.constructor.SELECTION_SUBTRACT)}this._resolve([k,t,b],"onEditsComplete",e,d)},_sendAttachment:function(b,a,c,e,k){var d=this;return h({url:this._url.path+"/"+a+"/"+("add"===b?"addAttachment":"updateAttachment"),form:c,content:p.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var k="add"===b?"onAddAttachmentComplete":
"onUpdateAttachmentComplete";c=new Q(c["add"===b?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=a;d._resolve([c],k,e);return c}).addErrback(function(b){d._resolve([b],null,k,null,!0)})},_repaint:function(b,a,c){a=q.isDefined(a)?a:b.attributes[this.objectIdField];(!(a in this._selectedFeatures)||!this._selectionSymbol)&&b.setSymbol(b.symbol,c)},_getKind:function(b){var a=this._trackManager;return a?a.isLatestObservation(b)?1:0:0}});p.mixin(l,{MODE_SNAPSHOT:0,
MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});K._createWrappers(l);c("extend-esri")&&p.setObject("layers.FeatureLayer",l,m);return l})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/geometry/jsonUtils esri/tasks/FeatureSet".split(" "),function(l,d,p,g,
s,n){l=l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=new n(d.catalogItems));d.location&&(this.location=s.fromJson(d.location));this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.properties=d.properties}});p("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyResult",l,g);return l})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred esri/kernel esri/urlUtils esri/SpatialReference esri/layers/TileInfo esri/layers/TiledMapServiceLayer esri/geometry/Extent esri/request".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k){l=l(q,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(b){try{b=d.mixin({bingMapsKey:null,culture:"en-US"},b||{});var a=window.location.protocol;"file:"===a&&(a="http:");this.url=a+"//dev.virtualearth.net/REST/v1";this._url=e.urlToObject(this.url);this.spatialReference=new u({wkid:102100});this.tileInfo=new m({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new u({wkid:102100}));d.mixin(this,b);this.hasAttributionData=this.showAttribution;this._initLayer=d.hitch(this,this._initLayer);this._errorHandler=d.hitch(this,this._errorHandler);this._getTileInfo=d.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(c){throw this.onError(c),c;}},_unsetMap:function(b,a){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var b=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var a=this.resourceInfo;!this.loaded&&a?this._initLayer(a):k({url:b,content:d.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(b,
a){if(200!==b.statusCode){var c=Error();c.code=b.statusCode;c.message=b.statusDescription;c.details=b.errorDetails;c.authenticationResultCode=b.authenticationResultCode;this.onError(c)}else try{this.resourceInfo=p.toJson(b);var c=b.resourceSets[0].resources[0],e=c.imageUrl.replace("{","${");this.tileServers=g.map(c.imageUrlSubdomains,function(b){var a=window.location.protocol;"file:"===a&&(a="http:");return f.substitute(e,{subdomain:b}).replace("http:",a)});this._tsLength=this.tileServers.length;
if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var k=this.loadCallback;k&&(delete this.loadCallback,k(this))}}catch(d){this.onError(d)}},getAttributionData:function(){var b=new c,a=p.fromJson(this.resourceInfo),e;this.hasAttributionData&&a&&(e=d.getObject("resourceSets.0.resources.0.imageryProviders",!1,a));e?b.callback({contributors:e}):(a=Error("Layer does not have attribution data"),
a.log=s.isDebug,b.errback(a));return b},getTileUrl:function(b,a,c){return f.substitute(this.tileServers[a%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(b,a,c),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(b,a,c){var e="",k,d;for(d=b;0<d;d--)b="0",k=1<<d-1,0!=(c&k)&&b++,0!=(a&k)&&(b++,b++),e+=b;return e},setMapStyle:function(b){this.mapStyle=b;this._getTileInfo()},setCulture:function(b){this.culture=b;this._getTileInfo()},setBingMapsKey:function(b){this.bingMapsKey=
b},onMapStyleChange:function(){}});d.mixin(l,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});n("extend-esri")&&d.setObject("virtualearth.VETiledLayer",l,a);return l})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(l,d,p,g,s,n,f,c,a,e){function u(a,c,e){return b&&e?function(b,a){return n(b,e,a)}:h?function(b,e){var k=n(b,c,e),d=n(b,a,function(b){(!x||
(new Date).getTime()>x+1E3)&&e.call(this,b)});return{remove:function(){k.remove();d.remove()}}}:function(b,c){return n(b,a,c)}}function m(b){do if(b.dojoClick)return b.dojoClick;while(b=b.parentNode)}function q(b,a,c){if(r=!b.target.disabled&&m(b.target))v=b.target,y=b.touches?b.touches[0].pageX:b.clientX,w=b.touches?b.touches[0].pageY:b.clientY,C=("object"==typeof r?r.x:"number"==typeof r?r:0)||4,z=("object"==typeof r?r.y:"number"==typeof r?r:0)||4,t||(t=!0,e.doc.addEventListener(a,function(b){r=
r&&b.target==v&&Math.abs((b.touches?b.touches[0].pageX:b.clientX)-y)<=C&&Math.abs((b.touches?b.touches[0].pageY:b.clientY)-w)<=z},!0),e.doc.addEventListener(c,function(b){if(r){A=(new Date).getTime();var a=b.target;"LABEL"===a.tagName&&(a=p.byId(a.getAttribute("for"))||a);setTimeout(function(){n.emit(a,"click",{bubbles:!0,cancelable:!0,_dojo_click:!0})})}},!0),b=function(b){e.doc.addEventListener(b,function(a){!a._dojo_click&&((new Date).getTime()<=A+1E3&&!("INPUT"==a.target.tagName&&g.contains(a.target,
"dijitOffScreen")))&&(a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),"click"==b&&(("INPUT"!=a.target.tagName||"radio"==a.target.type||"checkbox"==a.target.type)&&"TEXTAREA"!=a.target.tagName&&"AUDIO"!=a.target.tagName&&"VIDEO"!=a.target.tagName)&&a.preventDefault())},!0)},b("click"),b("mousedown"),b("mouseup"))}var h=f("touch"),k=5>f("ios"),b=navigator.msPointerEnabled,t,r,v,y,w,C,z,A,x,B;h&&(b?a(function(){e.doc.addEventListener("MSPointerDown",function(b){q(b,"MSPointerMove",
"MSPointerUp")},!0)}):a(function(){function b(a){var c=s.delegate(a,{bubbles:!0});6<=f("ios")&&(c.touches=a.touches,c.altKey=a.altKey,c.changedTouches=a.changedTouches,c.ctrlKey=a.ctrlKey,c.metaKey=a.metaKey,c.shiftKey=a.shiftKey,c.targetTouches=a.targetTouches);return c}B=e.body();e.doc.addEventListener("touchstart",function(b){x=(new Date).getTime();var a=B;B=b.target;n.emit(a,"dojotouchout",{relatedTarget:B,bubbles:!0});n.emit(B,"dojotouchover",{relatedTarget:a,bubbles:!0});q(b,"touchmove","touchend")},
!0);n(e.doc,"touchmove",function(a){x=(new Date).getTime();var c=e.doc.elementFromPoint(a.pageX-(k?0:e.global.pageXOffset),a.pageY-(k?0:e.global.pageYOffset));c&&(B!==c&&(n.emit(B,"dojotouchout",{relatedTarget:c,bubbles:!0}),n.emit(c,"dojotouchover",{relatedTarget:B,bubbles:!0}),B=c),n.emit(c,"dojotouchmove",b(a)))});n(e.doc,"touchend",function(a){x=(new Date).getTime();var c=e.doc.elementFromPoint(a.pageX-(k?0:e.global.pageXOffset),a.pageY-(k?0:e.global.pageYOffset))||e.body();n.emit(c,"dojotouchend",
b(a))})}));d={press:u("mousedown","touchstart","MSPointerDown"),move:u("mousemove","dojotouchmove","MSPointerMove"),release:u("mouseup","dojotouchend","MSPointerUp"),cancel:u(c.leave,"touchcancel",h?"MSPointerCancel":null),over:u("mouseover","dojotouchover","MSPointerOver"),out:u("mouseout","dojotouchout","MSPointerOut"),enter:c._eventHandler(u("mouseover","dojotouchover","MSPointerOver")),leave:c._eventHandler(u("mouseout","dojotouchout","MSPointerOut"))};return l.touch=d})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(l,d,p,g,s){l=l(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(d){d&&(this.name=d.name,this.title=d.title,this.description=d.description,this.extent=d.extent,this.legendURL=d.legendURL,this.subLayers=d.subLayers?d.subLayers:[],this.allExtents=d.allExtents?d.allExtents:[],this.spatialReferences=d.spatialReferences?
d.spatialReferences:[])},clone:function(){var d={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},f;this.extent&&(d.extent=this.extent.getExtent());d.subLayers=[];p.forEach(this.subLayers,function(c){d.subLayers.push(c.clone())});d.allExtents=[];for(f in this.allExtents)f=parseInt(f,10),isNaN(f)||(d.allExtents[f]=this.allExtents[f].getExtent());d.spatialReferences=[];p.forEach(this.spatialReferences,function(c){d.spatialReferences.push(c)});return d}});g("extend-esri")&&
d.setObject("layers.WMSLayerInfo",l,s);return l})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(l,d,p,g,s){return p("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var d=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);s.parse(d,{noStart:!this._earlyTemplatedStartup,
template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(g.hitch(this,function(d){this._startupWidgets=d;for(var c=0;c<d.length;c++)this._processTemplateNode(d[c],function(a,c){return a[c]},function(a,c,d){return c in a?a.connect(a,c,d):a.on(c,d,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(d,f,c){return f(d,"dojoType")||f(d,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){l.forEach(this._startupWidgets,function(d){d&&(!d._started&&d.startup)&&d.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(l,d,p,g,s){l=l(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(g){d.mixin(this,
g);s.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});p("extend-esri")&&d.setObject("layers.KMLFolder",l,g);return l})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script esri/kernel".split(" "),function(l,d,p,g,s,n,f){d=d(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(l._scopeName||"dojo")+"IoScript"},initialize:function(c){this.map=c;this._init=!0},startup:function(){},
propertyChangeHandler:function(c){},destroy:function(){this._init=!1},drawFeature:function(c){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(c){(c=this._featureMap[c])&&c._count++},_decRefCount:function(c){(c=this._featureMap[c])&&c._count--},_getFeature:function(c){return this._featureMap[c]},_addFeatureIIf:function(c,a){var e=this._featureMap,d=e[c],f=this.featureLayer;d||(e[c]=a,f._add(a),a._count=0);return d||a},_removeFeatureIIf:function(c){var a=this._featureMap[c],
e=this.featureLayer;if(a){if(a._count)return;delete this._featureMap[c];e._remove(a)}return a},_clearIIf:function(){var c;c=this.featureLayer;var a=c.graphics,e=c._selectedFeatures,d=c.objectIdField;for(c=a.length-1;0<=c;c--){var f=a[c],q=f.attributes[d];q in e?f._count=1:(f._count=0,this._removeFeatureIIf(q))}},_isPending:function(c){return n[this._prefix+c]?!0:!1},_cancelPendingRequest:function(c,a){if(c=c||n[this._prefix+a])try{c.cancel(),n._validCheck(c)}catch(e){}},_purgeRequests:function(){n._validCheck(null)},
_toggleVisibility:function(c){var a=this.featureLayer,e=a.graphics,d=c?"show":"hide",f,q=e.length;c=c&&a._ager;for(f=0;f<q;f++){var h=e[f];h[d]();c&&a._repaint(h)}},_applyTimeFilter:function(c){var a=this.featureLayer;if(a.timeInfo&&!a.suspended){c||a._fireUpdateStart();var e=a._trackManager;e&&e.clearTracks();var d=a.getTimeDefinition(),f=a._getOffsettedTE(a._mapTimeExtent);f?(f=a._getTimeOverlap(d,f))?(d=a._filterByTime(a.graphics,f.startTime,f.endTime),e&&e.addFeatures(d.match),g.forEach(d.match,
function(c){var e=c._shape;c.visible||(c.show(),(e=c._shape)&&e._moveToFront());a._ager&&e&&a._repaint(c)}),g.forEach(d.noMatch,function(a){a.visible&&a.hide()})):this._toggleVisibility(!1):(e&&e.addFeatures(a.graphics),this._toggleVisibility(!0));e&&(e.moveLatestToFront(),e.drawTracks());c||a._fireUpdateEnd()}}});s("extend-esri")&&p.setObject("layers._RenderMode",d,f);return d})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/lang esri/symbols/jsonUtils esri/layers/RangeDomain esri/layers/CodedValueDomain esri/layers/InheritedDomain esri/layers/FeatureTemplate".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u){l=l(null,{declaredClass:"esri.layers.FeatureType",constructor:function(m){if(m&&d.isObject(m)){this.id=m.id;this.name=m.name;var q=m.symbol;q&&(this.symbol=f.fromJson(q));var q=m.domains,h,k=this.domains={};for(h in q)if(q.hasOwnProperty(h)){var b=q[h];switch(b.type){case "range":k[h]=new c(b);break;case "codedValue":k[h]=new a(b);break;case "inherited":k[h]=new e(b)}}if(h=m.templates){q=this.templates=[];for(m=0;m<h.length;m++)q.push(new u(h[m]))}}},toJson:function(){var a=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,e=this.domains,k=this.templates,b=n.fixJson;if(e){var d=a.domains={};for(c in e)e.hasOwnProperty(c)&&(d[c]=e[c]&&e[c].toJson());b(d)}k&&(a.templates=p.map(k,function(b){return b.toJson()}));return b(a)}});g("extend-esri")&&d.setObject("layers.FeatureType",l,s);return l})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/graphic esri/geometry/Polyline esri/layers/GraphicsLayer".split(" "),
function(l,d,p,g,s,n,f,c){l=l(null,{declaredClass:"esri.layers._TrackManager",constructor:function(a){this.layer=a;this.trackMap={}},initialize:function(a){this.map=a;var e=this.layer,d=e._getRenderer(),d=d&&d.trackRenderer;if("esriGeometryPoint"===e.geometryType){var f=this.container=new c._GraphicsLayer({id:e.id+"_tracks",_child:!0});f.loaded=!0;f.onLoad(f);f._setMap(a,e._div);f.setRenderer(d)}},addFeatures:function(a){var c,d=this.trackMap,f=this.layer,q=f._trackIdField,h,k;p.forEach(a,function(b){h=
b.attributes;c=h[q];k=d[c]=d[c]||[];k.push(b)});var b=f._startTimeField,t=f.objectIdField;a=function(a,c){var e=a.attributes[b],d=c.attributes[b];return e===d?a.attributes[t]<c.attributes[t]?-1:1:e<d?-1:1};for(c in d)d[c].sort(a)},drawTracks:function(){var a=this.container;if(a){var c=this.trackMap,d=this.map.spatialReference,m,q,h,k,b,t=this.layer._trackIdField;for(m in c){q=c[m];h=[];for(k=q.length-1;0<=k;k--)(b=q[k].geometry)&&h.push([b.x,b.y]);q={};q[t]=m;0<h.length&&a.add(new n(new f({paths:[h],
spatialReference:d}),null,q))}}},moveLatestToFront:function(){p.forEach(this.getLatestObservations(),function(a){var c=a._shape;c&&c._moveToFront();this._repaint(a,null,!0)},this.layer)},getLatestObservations:function(){var a=[],c=this.layer._getRenderer(),d=this.trackMap,f;if(!c.latestObservationRenderer)return a;for(f in d)c=d[f],a.push(c[c.length-1]);return a},clearTracks:function(){var a=this.getLatestObservations();this.trackMap={};var c=this.container;c&&c.clear();p.forEach(a,function(a){this._repaint(a,
null,!0)},this.layer)},isLatestObservation:function(a){var c=this.trackMap[a.attributes[this.layer._trackIdField]];return c?c[c.length-1]===a:!1},destroy:function(){var a=this.container;a&&(a.clear(),a._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});g("extend-esri")&&d.setObject("layers._TrackManager",l,s);return l})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/SpatialReference esri/geometry/Extent esri/geometry/Polyline".split(" "),
function(l,d,p,g,s,n,f,c){l=l(null,{declaredClass:"esri.layers._GridLayout",constructor:function(a,c,d,f){this.origin=a;this.cellWidth=c.width;this.cellHeight=c.height;this.mapWidth=d.width;this.mapHeight=d.height;this.srInfo=f},setResolution:function(a){this._resolution=(a.xmax-a.xmin)/this.mapWidth;this.srInfo&&(a=Math.round(2*this.srInfo.valid[1]/this._resolution),a=Math.round(a/this.cellWidth),this._frameStats=[a,0,a-1])},getCellCoordinates:function(a){var c=this._resolution,d=this.origin;return{row:Math.floor((d.y-
a.y)/(this.cellHeight*c)),col:Math.floor((a.x-d.x)/(this.cellWidth*c))}},normalize:function(a){var c=this._frameStats;if(c){var d=c[0],f=c[1],c=c[2];a<f?(a%=d,a=a<f?a+d:a):a>c&&(a%=d)}return a},intersects:function(a,c){var d=this.srInfo;return d?p.some(c._getParts(d),function(c){return a.intersects(c.extent)}):a.intersects(c)},getCellExtent:function(a,c){var d=this._resolution,m=this.origin,q=this.cellWidth,h=this.cellHeight;return new f(c*q*d+m.x,m.y-(a+1)*h*d,(c+1)*q*d+m.x,m.y-a*h*d,new n(m.spatialReference.toJson()))},
getLatticeID:function(a){var c=this.getCellCoordinates({x:a.xmin,y:a.ymax}),d=this.getCellCoordinates({x:a.xmax,y:a.ymin});a=c.row;var f=d.row,c=this.normalize(c.col),d=this.normalize(d.col);return a+"_"+f+"_"+c+"_"+d},sorter:function(a,c){return a<c?-1:1},getCellsInExtent:function(a,e){var d=this.getCellCoordinates({x:a.xmin,y:a.ymax}),f=this.getCellCoordinates({x:a.xmax,y:a.ymin}),q=d.row,h=f.row,d=d.col,f=f.col,k=[],b,t,r,v=[],g=[],w,n,z,A=[];for(b=q;b<=h;b++)for(t=d;t<=f;t++)r=this.normalize(t),
a=this.getCellExtent(b,r),k.push({row:b,col:r,extent:a,resolution:this._resolution}),e&&(v.push(a.xmin,a.xmax),g.push(a.ymin,a.ymax));d=this.normalize(d);f=this.normalize(f);v.sort(this.sorter);g.sort(this.sorter);t=v.length;for(b=t-1;0<=b;b--)b<t-1&&v[b]===v[b+1]&&v.splice(b,1);t=g.length;for(b=t-1;0<=b;b--)b<t-1&&g[b]===g[b+1]&&g.splice(b,1);if(v.length&&g.length){r=v[0];w=v[v.length-1];n=g[0];z=g[g.length-1];t=v.length;for(b=0;b<t;b++)A.push([[v[b],z],[v[b],n]]);t=g.length;for(b=0;b<t;b++)A.push([[r,
g[b]],[w,g[b]]]);b=new c({paths:A,spatialReference:this.origin.spatialReference.toJson()});k.push({latticeID:q+"_"+h+"_"+d+"_"+f,lattice:b,resolution:this._resolution})}return{minRow:q,maxRow:h,minCol:d,maxCol:f,cells:k}}});g("extend-esri")&&d.setObject("layers._GridLayout",l,s);return l})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(l,d,p){var g={};l.setObject("dojo.data.util.simpleFetch",g);g.errorHandler=function(g,n){n.onError&&
n.onError.call(n.scope||d.global,g,n)};g.fetchHandler=function(g,n){var f=n.abort||null,c=!1,a=n.start?n.start:0,e=n.count&&Infinity!==n.count?a+n.count:g.length;n.abort=function(){c=!0;f&&f.call(n)};var l=n.scope||d.global;n.store||(n.store=this);n.onBegin&&n.onBegin.call(l,g.length,n);n.sort&&g.sort(p.createSortFunction(n.sort,this));if(n.onItem)for(var m=a;m<g.length&&m<e;++m){var q=g[m];c||n.onItem.call(l,q,n)}n.onComplete&&!c&&(m=null,n.onItem||(m=g.slice(a,e)),n.onComplete.call(l,m,n))};g.fetch=
function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,l.hitch(this,"fetchHandler"),l.hitch(this,"errorHandler"));return d};return g})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(l,d,p,g,s,n){d=d("dojox.data.CsvStore",null,{constructor:function(d){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=
!1;d.url&&(this.url=d.url);this._csvData=d.data;d.label?this.label=d.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=d.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in d&&(this.separator=d.separator);"urlPreventCache"in d&&(this.urlPreventCache=d.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",
separator:",",urlPreventCache:!1,_assertIsItem:function(d){if(!this.isItem(d))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(d){d=this.getIdentity(d);this.identifier&&(d=this._idMap[d]);return d},getValue:function(d,c,a){this._assertIsItem(d);var e=a;if("string"===typeof c)c=this._attributeIndexes[c],null!=c&&(e=this._dataArray[this._getIndex(d)][c]||a);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
return e},getValues:function(d,c){var a=this.getValue(d,c);return a?[a]:[]},getAttributes:function(d){this._assertIsItem(d);var c=[];d=this._dataArray[this._getIndex(d)];for(var a=0;a<d.length;a++)""!==d[a]&&c.push(this._attributes[a]);return c},hasAttribute:function(d,c){this._assertIsItem(d);if("string"===typeof c){var a=this._attributeIndexes[c],e=this._dataArray[this._getIndex(d)];return"undefined"!==typeof a&&a<e.length&&""!==e[a]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
},containsValue:function(d,c,a){var e=void 0;"string"===typeof a&&(e=s.patternToRegExp(a,!1));return this._containsValue(d,c,a,e)},_containsValue:function(d,c,a,e){d=this.getValues(d,c);for(c=0;c<d.length;++c){var g=d[c];if("string"===typeof g&&e)return null!==g.match(e);if(a===g)return!0}return!1},isItem:function(d){if(d&&d[this._storeProp]===this)if(d=d[this._idProp],this.identifier){if(this._dataArray[this._idMap[d]])return!0}else if(0<=d&&d<this._dataArray.length)return!0;return!1},isItemLoaded:function(d){return this.isItem(d)},
loadItem:function(d){},getFeatures:function(){return this._features},getLabel:function(d){if(this.label&&this.isItem(d))return this.getValue(d,this.label)},getLabelAttributes:function(d){return this.label?[this.label]:null},_fetchItems:function(d,c,a){var e=this,g=function(b,a){var d=null;if(b.query){var k,h,d=[],f=b.queryOptions?b.queryOptions.ignoreCase:!1,m={};for(k in b.query)h=b.query[k],"string"===typeof h&&(m[k]=s.patternToRegExp(h,f));for(f=0;f<a.length;++f){var g=!0,q=a[f];for(k in b.query)h=
b.query[k],e._containsValue(q,k,h,m[k])||(g=!1);g&&d.push(q)}}else d=a.slice(0,a.length);c(d,b)};if(this._loadFinished)g(d,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:d,filter:g});else{this._loadInProgress=!0;var m=p.get({url:e.url,handleAs:"text",preventCache:e.urlPreventCache});m.addCallback(function(b){try{e._processData(b),g(d,e._arrayOfAllItems),e._handleQueuedFetches()}catch(c){a(c,d)}});m.addErrback(function(b){e._loadInProgress=!1;if(a)a(b,
d);else throw b;});var q=null;d.abort&&(q=d.abort);d.abort=function(){m&&-1===m.fired&&m.cancel();q&&q.call(d)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,g(d,this._arrayOfAllItems)}catch(h){a(h,d)}else{var k=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(a)a(k,d);else throw k;}},close:function(d){},_getArrayOfArraysFromCsvFileContents:function(d){if(l.isString(d)){var c=RegExp("^\\s+","g"),a=RegExp("\\s+$","g"),
e=RegExp('""',"g"),g=[],m=this._splitLines(d);for(d=0;d<m.length;++d){var q=m[d];if(0<q.length){for(var q=q.split(this.separator),h=0;h<q.length;){var k=q[h].replace(c,""),b=k.replace(a,""),t=b.charAt(0),r=b.charAt(b.length-1),v=b.charAt(b.length-2),n=b.charAt(b.length-3);if(2===b.length&&'""'==b)q[h]="";else if('"'==t&&('"'!=r||'"'==r&&'"'==v&&'"'!=n)){if(h+1===q.length)return;q[h]=k+this.separator+q[h+1];q.splice(h+1,1)}else'"'==t&&'"'==r&&(b=b.slice(1,b.length-1),b=b.replace(e,'"')),q[h]=b,h+=
1}g.push(q)}}this._attributes=g.shift();for(d=0;d<this._attributes.length;d++)this._attributeIndexes[this._attributes[d]]=d;this._dataArray=g}},_splitLines:function(d){var c=[],a,e="",g=!1;for(a=0;a<d.length;a++){var m=d.charAt(a);switch(m){case '"':g=!g;e+=m;break;case "\r":g?e+=m:(c.push(e),e="",a<d.length-1&&"\n"==d.charAt(a+1)&&a++);break;case "\n":g?e+=m:(c.push(e),e="");break;default:e+=m}}""!==e&&c.push(e);return c},_processData:function(d){this._getArrayOfArraysFromCsvFileContents(d);this._arrayOfAllItems=
[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(d=0;d<this._dataArray.length;d++){var c=d;this.identifier&&(c=this._dataArray[d][this._attributeIndexes[this.identifier]],this._idMap[c]=d);this._arrayOfAllItems.push(this._createItemFromIdentity(c))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(d){var c={};c[this._storeProp]=this;c[this._idProp]=
d;return c},getIdentity:function(d){return this.isItem(d)?d[this._idProp]:null},fetchItemByIdentity:function(d){var c,a=d.scope?d.scope:g.global;if(this._loadFinished)c=this._createItemFromIdentity(d.identity),this.isItem(c)||(c=null),d.onItem&&d.onItem.call(a,c);else{var e=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:d}):(this._loadInProgress=!0,c=p.get({url:e.url,handleAs:"text"}),c.addCallback(function(c){try{e._processData(c);var g=e._createItemFromIdentity(d.identity);
e.isItem(g)||(g=null);d.onItem&&d.onItem.call(a,g);e._handleQueuedFetches()}catch(h){d.onError&&d.onError.call(a,h)}}),c.addErrback(function(c){this._loadInProgress=!1;d.onError&&d.onError.call(a,c)}));else if(this._csvData)try{e._processData(e._csvData),e._csvData=null,c=e._createItemFromIdentity(d.identity),e.isItem(c)||(c=null),d.onItem&&d.onItem.call(a,c)}catch(n){d.onError&&d.onError.call(a,n)}}},getIdentityAttributes:function(d){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<
this._queuedFetches.length){for(var d=0;d<this._queuedFetches.length;d++){var c=this._queuedFetches[d],a=c.filter,e=c.args;a?a(e,this._arrayOfAllItems):this.fetchItemByIdentity(c.args)}this._queuedFetches=[]}}});l.extend(d,n);return d})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(l,d,p,g,s){l=l(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,
outputPixelType:null,constructor:function(g){d.isObject(g)&&(d.mixin(this,g),g.rasterFunction&&(this.functionName=g.rasterFunction),g.rasterFunctionArguments?this.functionArguments=g.rasterFunctionArguments:g.arguments&&(this.functionArguments=g.arguments))},toJson:function(){return s.filter({rasterFunction:this.functionName,rasterFunctionArguments:this.functionArguments||this.arguments,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(d){if(null!==
d&&void 0!==d)return!0})}});p("extend-esri")&&d.setObject("layers.RasterFunction",l,g);return l})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(l,d){var p={};l.setObject("dojo.date.stamp",p);p.fromISOString=function(g,l){p._isoRegExp||(p._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var n=p._isoRegExp.exec(g),f=null;if(n){n.shift();n[1]&&n[1]--;n[6]&&(n[6]*=1E3);l&&(l=new Date(l),d.forEach(d.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(a){return l["get"+a]()}),function(a,c){n[c]=n[c]||a}));f=new Date(n[0]||1970,n[1]||0,n[2]||1,n[3]||0,n[4]||0,n[5]||0,n[6]||0);100>n[0]&&f.setFullYear(n[0]||1970);var c=0,a=n[7]&&n[7].charAt(0);"Z"!=a&&(c=60*(n[8]||0)+(Number(n[9])||0),"-"!=a&&(c*=-1));a&&(c-=f.getTimezoneOffset());c&&f.setTime(f.getTime()+6E4*c)}return f};p.toISOString=function(d,l){var n=function(a){return 10>a?"0"+a:a};l=l||{};var f=[],c=l.zulu?"getUTC":"get",a="";"time"!=l.selector&&(a=d[c+"FullYear"](),a=["0000".substr((a+
"").length)+a,n(d[c+"Month"]()+1),n(d[c+"Date"]())].join("-"));f.push(a);if("date"!=l.selector){a=[n(d[c+"Hours"]()),n(d[c+"Minutes"]()),n(d[c+"Seconds"]())].join(":");c=d[c+"Milliseconds"]();l.milliseconds&&(a+="."+(100>c?"0":"")+n(c));if(l.zulu)a+="Z";else if("time"!=l.selector)var c=d.getTimezoneOffset(),e=Math.abs(c),a=a+((0<c?"-":"+")+n(Math.floor(e/60))+":"+n(e%60));f.push(a)}return f.join("T")};return p})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),
function(l,d,p,g,s,n,f){n.extend(l,{waiRole:"",waiState:""});return s("dijit._Templated",[d,p],{widgetsInTemplate:!1,constructor:function(){f.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(c,a){var d=this.inherited(arguments),f=a(c,"waiRole");f&&c.setAttribute("role",f);(f=a(c,"waiState"))&&g.forEach(f.split(/\s*,\s*/),function(a){-1!=a.indexOf("-")&&(a=a.split("-"),c.setAttribute("aria-"+
a[0],a[1]))});return d}})})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated esri/kernel esri/dijit/_EventedWidget dojo/i18n!esri/nls/jsapi dojo/NodeList-dom".split(" "),function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t,r){var v=0;d=d([t,h,k],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=
g.mixin({},r.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);var b=this.template,c=this.graphic,d=b.getComponents(c),k=this.showTitle?d.title:"",h=d.description,t=d.fields,r=d.mediaInfos,f=this.domNode,v=this._nls;this._prevMedia.title=v.NLS_prevMedia;this._nextMedia.title=v.NLS_nextMedia;e.set(this._title,"innerHTML",k);k||u.add(this._title,"hidden");!h&&t&&(h="",s.forEach(t,function(b){h+="\x3ctr valign\x3d'top'\x3e";h+="\x3ctd class\x3d'attrName'\x3e"+b[0]+"\x3c/td\x3e";h+="\x3ctd class\x3d'attrValue'\x3e"+
b[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+v.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";h+="\x3c/tr\x3e"}),h&&(h="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+h+"\x3c/table\x3e"));e.set(this._description,"innerHTML",h);h||u.add(this._description,"hidden");n.query("a",this._description).forEach(function(b){e.set(b,"target","_blank")});k&&h?n.query(".mainSection .hzLine",f).removeClass("hidden"):k||h?n.query(".mainSection .hzLine",
f).addClass("hidden"):n.query(".mainSection",f).addClass("hidden");if(b=this._dfd=b.getAttachments(c))b.addBoth(g.hitch(this,this._attListHandler,b)),e.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+v.NLS_searching+"...\x3c/li\x3e"),n.query(".attachmentsSection",f).removeClass("hidden");r&&r.length&&(n.query(".mediaSection",f).removeClass("hidden"),a.setSelectable(this._mediaFrame,!1),this._mediaInfos=r,this._mediaPtr=0,this._updateUI(),this._displayMedia());d.editSummary&&(e.set(this._editSummary,
"innerHTML",d.editSummary),r&&r.length&&u.remove(this._mediaBreak,"hidden"),u.remove(this._editSummarySection,"hidden"))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),
this._displayMedia())},_updateUI:function(){var b=this._mediaInfos,a=b.length,c=this.domNode,d=this._prevMedia,k=this._nextMedia;if(1<a){var h=0,t=0;s.forEach(b,function(b){"image"===b.type?h++:-1!==b.type.indexOf("chart")&&t++});h&&(e.set(this._imageCount,"innerHTML",h),n.query(".summary .image",c).removeClass("hidden"));t&&(e.set(this._chartCount,"innerHTML",t),n.query(".summary .chart",c).removeClass("hidden"))}else n.query(".summary",c).addClass("hidden"),u.add(d,"hidden"),u.add(k,"hidden");b=
this._mediaPtr;0===b?u.add(d,"hidden"):u.remove(d,"hidden");b===a-1?u.add(k,"hidden"):u.remove(k,"hidden");this._destroyFrame()},_displayMedia:function(){var b=this._mediaInfos[this._mediaPtr],a=b.title,c=b.caption,d=n.query(".mediaSection .hzLine",this.domNode)[0];e.set(this._mediaTitle,"innerHTML",a);u[a?"remove":"add"](this._mediaTitle,"hidden");e.set(this._mediaCaption,"innerHTML",c);u[c?"remove":"add"](this._mediaCaption,"hidden");u[a&&c?"remove":"add"](d,"hidden");this._rid=null;if("image"===
b.type)this._showImage(b.value);else{var k=this,a=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],c=b.value.theme||this.chartTheme||"esri/dijit/Rainbow";g.isString(c)&&(c=c.replace(/\./gi,"/"),-1===c.indexOf("/")&&(c="dojox/charting/themes/"+c),a.push(c));try{var h=this._rid=v++;l(a,function(a,c,d){h===k._rid&&(k._rid=null,k._showChart(b.type,b.value,a,c,d))})}catch(t){console.log("PopupRenderer: error loading modules")}}},_showImage:function(b){u.add(this._mediaFrame,"image");var a=
q.get(this._gallery,"height"),c="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+b.sourceURL+"' /\x3e";b.linkURL&&(c="\x3ca target\x3d'_blank' href\x3d'"+b.linkURL+"'\x3e"+c+"\x3c/a\x3e");e.set(this._mediaFrame,"innerHTML",c);var d=n.query(".esriPopupMediaImage",this._mediaFrame)[0],k=this,h;h=p.connect(d,"onload",function(){p.disconnect(h);h=null;k._imageLoaded(d,a)})},_showChart:function(b,a,c,d,e){u.remove(this._mediaFrame,"image");c=this._chart=new c(m.create("div",{"class":"chart"},this._mediaFrame),
{margins:{l:4,t:4,r:4,b:4}});e&&c.setTheme(e);switch(b){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",a.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});s.forEach(a.fields,function(b,a){b.x=a+1});c.addSeries("Series A",a.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",gap:3});c.addAxis("y",
{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",a.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",a.fields)}this._action=new d(c);c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=
null);e.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(b,a){var c=b.height;c<a&&(c=Math.round((a-c)/2),q.set(b,"marginTop",c+"px"))},_attListHandler:function(b,a){if(b===this._dfd){this._dfd=null;var c="";!(a instanceof Error)&&(a&&a.length)&&s.forEach(a,function(b){c+="\x3cli\x3e";c+="\x3ca href\x3d'"+b.url+"' target\x3d'_blank'\x3e"+(b.name||"[No name]")+"\x3c/a\x3e";c+="\x3c/li\x3e"});e.set(this._attachmentsList,"innerHTML",c||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}}});
f("extend-esri")&&g.setObject("dijit._PopupRenderer",d,b);return d})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(l){var d={};l.setObject("dojo.data.util.sorter",d);d.basicComparator=function(d,g){var l=-1;null===d&&(d=void 0);null===g&&(g=void 0);if(d==g)l=0;else if(d>g||null==d)l=1;return l};d.createSortFunction=function(l,g){function s(a,c,d,b){return function(e,r){var f=b.getValue(e,a),g=b.getValue(r,a);return c*d(f,g)}}for(var n=[],f,c=g.comparatorMap,a=d.basicComparator,
e=0;e<l.length;e++){f=l[e];var u=f.attribute;if(u){f=f.descending?-1:1;var m=a;c&&("string"!==typeof u&&"toString"in u&&(u=u.toString()),m=c[u]||a);n.push(s(u,f,m,g))}}return function(a,c){for(var d=0;d<n.length;){var b=n[d++](a,c);if(0!==b)return b}return 0}};return d})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style esri/kernel esri/config esri/sniff esri/domUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/layers/layer".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q){var h=l([q],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(a){this.inherited(arguments,[null,a]);this._mapImages=[];var b=p.hitch;this._panStart=b(this,this._panStart);this._pan=b(this,this._pan);this._extentChange=b(this,this._extentChange);this._zoom=b(this,this._zoom);this._zoomStart=b(this,this._zoomStart);this._scale=b(this,this._scale);this._resize=b(this,this._resize);d.connect(this,"onSuspend",this,this._onSuspend);
d.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},opacity:1,_transform:f._getDOMAccessor("transform"),addImage:function(a){var b=this._mapImages.push(a),b=b-1;a._idx=b;a._layer=this;this._div&&this._createImage(a,b)},removeImage:function(a){if(a){var b=a._idx,c=this._mapImages;if(c[b]===a){delete c[b];if(b=a._node)this._clearEvents(b),b.e_idx=b.e_bl=b.e_tr=b.e_l=b.e_t=b.e_w=b.e_h=null,b.parentNode&&(b.parentNode.removeChild(b),s.destroy(b));a._node=a._idx=a._layer=null}}},
removeAllImages:function(){var a=this._mapImages,b,c=a.length;for(b=0;b<c;b++){var d=a[b];d&&this.removeImage(d)}this._mapImages=[]},getImages:function(){var a=this._mapImages,b=[],c,d=a.length;for(c=0;c<d;c++)a[c]&&b.push(a[c]);return b},setOpacity:function(a){this.opacity!=a&&(this._opacityChanged(this.opacity=a),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(c){var b=this._div,d,e;if(b)if(!a("ie")||8<a("ie"))n.set(b,"opacity",c);else{e=b.childNodes;d=e.length;for(b=
0;b<d;b++)n.set(e[b],"opacity",c)}},_createImage:function(c,b){var e=s.create("img");n.set(e,{position:"absolute"});8>=a("ie")&&n.set(e,"opacity",this.opacity);if(c.rotation){var f="rotate("+(360-c.rotation)+"deg)";9>a("ie")||(n.set(e,this._transform,f),n.set(e,"transform",f))}c._node=e;e.e_idx=b;e.e_layer=this;e.e_load=d.connect(e,"onload",h.prototype._imageLoaded);e.e_error=d.connect(e,"onerror",h.prototype._imageError);e.e_abort=d.connect(e,"onabort",h.prototype._imageError);e.src=c.href},_imageLoaded:function(a,
b){var c=b||a.target||a.currentTarget,d=c.e_layer,e=d._mapImages[c.e_idx],h=d._map;h&&(h.__zooming||h.__panning||!d._sr)?d._standby.push(c):(d._clearEvents(c),e&&e._node===c&&h&&d._attach(e))},_imageError:function(a){a=a.target||a.currentTarget;var b=a.e_layer,c=b._mapImages[a.e_idx];b._clearEvents(a);c&&(c._node=null)},_clearEvents:function(a){var b=d.disconnect;b(a.e_load);b(a.e_error);b(a.e_abort);a.e_load=a.e_error=a.e_abort=a.e_layer=null},_attach:function(a){var b=a.extent,c=b.spatialReference,
d=this._sr,e=this._div,h=a._node,f=new u({x:b.xmin,y:b.ymin,spatialReference:c}),b=new u({x:b.xmax,y:b.ymax,spatialReference:c});d.equals(c)||(d.isWebMercator()&&4326===c.wkid?(f=m.geographicToWebMercator(f),b=m.geographicToWebMercator(b)):c.isWebMercator()&&4326===d.wkid&&(f=m.webMercatorToGeographic(f),b=m.webMercatorToGeographic(b)));h.e_bl=f;h.e_tr=b;a.visible&&(this._setPos(h,e._left,e._top),(this._active||e).appendChild(h))},_setPos:function(a,b,c){var d=a.e_bl,e=a.e_tr,h=this._map,d=h.toScreen(d),
e=h.toScreen(e);b=d.x-b;c=e.y-c;var g=Math.abs(e.x-d.x),d=Math.abs(d.y-e.y),e={width:g+"px",height:d+"px"},m=this._mapImages[a.e_idx];"css-transforms"===h.navigationMode?e[f._css.names.transform]=f._css.translate(b,c)+(m.rotation?" "+f._css.rotate(360-m.rotation):""):(e.left=b+"px",e.top=c+"px");n.set(a,e);a.e_l=b;a.e_t=c;a.e_w=g;a.e_h=d},managedSuspension:!0,_setMap:function(c,b){this.inherited(arguments);var d=this._div=s.create("div",null,b),h=f._css.names,g={position:"absolute"},m=c.__visibleDelta;
if(!a("ie")||8<a("ie"))g.opacity=this.opacity;"css-transforms"===c.navigationMode?(g[h.transform]=f._css.translate(m.x,m.y),n.set(d,g),d._left=m.x,d._top=m.y,g={position:"absolute",width:c.width+"px",height:c.height+"px",overflow:"visible"},this._active=s.create("div",null,d),n.set(this._active,g),this._passive=s.create("div",null,d),n.set(this._passive,g)):(d._left=0,d._top=0,n.set(d,g));this._standby=[];h=this._mapImages;m=h.length;for(g=0;g<m;g++){var q=h[g];q._node||this._createImage(q,q._idx)}e.hide(d);
return d},_unsetMap:function(a,b){this._disconnect();var c=this._div;if(c){var d=this._mapImages,e,h=d.length;for(e=0;e<h;e++){var f=d[e];if(f){var g=f._node;g&&(this._clearEvents(g),g.e_idx=g.e_bl=g.e_tr=g.e_l=g.e_t=g.e_w=g.e_h=null);f._node=null}}b.removeChild(c);s.destroy(c)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();e.hide(this._div)},_onResume:function(a){a.firstOccurrence&&(this._sr=this._map.spatialReference,
this._processStandbyList());a=this._map;var b=this._div,c=a.__visibleDelta;"css-transforms"===a.navigationMode&&(b._left=c.x,b._top=c.y,n.set(b,f._css.names.transform,f._css.translate(b._left,b._top)));this._redraw("css-transforms"===a.navigationMode);this._connect(a);e.show(b)},_connect:function(a){if(!this._connections){var b=d.connect,c="css-transforms"===a.navigationMode;this._connections=[b(a,"onPanStart",this._panStart),b(a,"onPan",this._pan),b(a,"onExtentChange",this._extentChange),c&&b(a,
"onZoomStart",this._zoomStart),c?b(a,"onScale",this._scale):b(a,"onZoom",this._zoom),c&&b(a,"onResize",this._resize)]}},_disconnect:function(){this._connections&&(g.forEach(this._connections,d.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(a,b){var c=this._div;c._left=this._panL+b.x;c._top=this._panT+b.y;"css-transforms"===this._map.navigationMode?n.set(c,f._css.names.transform,f._css.translate(c._left,c._top)):n.set(c,
{left:c._left+"px",top:c._top+"px"})},_extentChange:function(a,b,c){c?this._redraw("css-transforms"===this._map.navigationMode):b&&this._pan(a,b);this._processStandbyList()},_processStandbyList:function(){var a,b=this._standby;if(b&&b.length)for(a=b.length-1;0<=a;a--)this._imageLoaded(null,b[a]),b.splice(a,1)},_redraw:function(a){if(a){a=this._passive;var b=f._css.names;n.set(a,b.transition,"none");this._moveImages(a,this._active);n.set(a,b.transform,"none")}a=this._active||this._div;var b=this._div._left,
c=this._div._top,d,e=a.childNodes.length,h;for(d=0;d<e;d++)h=a.childNodes[d],this._setPos(h,b,c)},_zoom:function(a,b,c){a=this._div;var d=a._left,e=a._top,h,f=a.childNodes.length,g;for(h=0;h<f;h++){g=a.childNodes[h];var m=g.e_w*b,q=g.e_h*b,x=(c.x-d-g.e_l)*(m-g.e_w)/g.e_w,l=(c.y-e-g.e_t)*(q-g.e_h)/g.e_h,x=isNaN(x)?0:x,l=isNaN(l)?0:l;n.set(g,{left:g.e_l-x+"px",top:g.e_t-l+"px",width:m+"px",height:q+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(a,b){var c=
a.childNodes,d;d=c.length;if(0<d)for(d-=1;0<=d;d--)b.appendChild(c[d])},_scale:function(a,b){var d=f._css.names,e=this._passive;n.set(e,d.transition,b?"none":d.transformName+" "+c.defaults.map.zoomDuration+"ms ease");f._css.matrix(a);n.set(e,d.transform,f._css.matrix(a))},_resize:function(a,b,c){n.set(this._active,{width:b+"px",height:c+"px"});n.set(this._passive,{width:b+"px",height:c+"px"})}});a("extend-esri")&&p.setObject("layers.MapImageLayer",h,f);return h})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/layers/MapImage".split(" "),
function(l,d,p,g,s,n){l=l([n],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(d){s.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});p("extend-esri")&&d.setObject("layers.KMLGroundOverlay",l,g);return l})},"esri/tasks/SpatialRelationship":function(){define(["dojo/_base/lang","dojo/has","esri/kernel"],function(l,d,p){var g={SPATIAL_REL_INTERSECTS:"esriSpatialRelIntersects",SPATIAL_REL_CONTAINS:"esriSpatialRelContains",SPATIAL_REL_CROSSES:"esriSpatialRelCrosses",SPATIAL_REL_ENVELOPEINTERSECTS:"esriSpatialRelEnvelopeIntersects",
SPATIAL_REL_INDEXINTERSECTS:"esriSpatialRelIndexIntersects",SPATIAL_REL_OVERLAPS:"esriSpatialRelOverlaps",SPATIAL_REL_TOUCHES:"esriSpatialRelTouches",SPATIAL_REL_WITHIN:"esriSpatialRelWithin",SPATIAL_REL_RELATION:"esriSpatialRelRelation"};d("extend-esri")&&l.setObject("tasks._SpatialRelationship",g,p);return g})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(l,
d,p,g,s,n,f,c,a){var e=s.delegate(c,{mouseenter:n.enter,mouseleave:n.leave,keypress:p._keypress}),u;p=g("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var c=a;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(a,c){return a.getAttribute(c)},this._attach)||this.searchContainerNode)&&
c.firstChild)c=c.firstChild;else{if(c==a)break;for(;!c.nextSibling;)if(c=c.parentNode,c==a)return;c=c.nextSibling}},_processTemplateNode:function(a,c,d){var e=!0,b=this.attachScope||this,f=c(a,"dojoAttachPoint")||c(a,"data-dojo-attach-point");if(f)for(var g=f.split(/\s*,\s*/);f=g.shift();)s.isArray(b[f])?b[f].push(a):b[f]=a,e="containerNode"!=f,this._attachPoints.push(f);if(c=c(a,"dojoAttachEvent")||c(a,"data-dojo-attach-event")){f=c.split(/\s*,\s*/);for(g=s.trim;c=f.shift();)if(c){var v=null;-1!=
c.indexOf(":")?(v=c.split(":"),c=g(v[0]),v=g(v[1])):c=g(c);v||(v=c);this._attachEvents.push(d(a,c,s.hitch(b,v)))}}return e},_attach:function(a,c,d){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?u||(u=l("./a11yclick")):e[c]||c;return f(a,c,d)},_detachTemplateNodes:function(){var a=this.attachScope||this;d.forEach(this._attachPoints,function(c){delete a[c]});this._attachPoints=[];d.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});s.extend(a,{dojoAttachEvent:"",dojoAttachPoint:""});return p})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/has dojo/string esri/kernel esri/urlUtils esri/SpatialReference esri/geometry/Extent esri/layers/TiledMapServiceLayer esri/layers/TileInfo".split(" "),function(l,d,p,g,s,n,f,c,a,e,u,m){l=l(u,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(c,d){d||(d={});this.urlTemplate=c;
var k=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new a({wkid:102100})),b=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new a({wkid:102100}));this.initialExtent=d.initialExtent||k;this.fullExtent=d.fullExtent||b;this.tileInfo=d.tileInfo?d.tileInfo:new m({rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new a(this.tileInfo.spatialReference.toJson());this.copyright=d.copyright||"";var f=new g(c),k=f.scheme+"://"+f.authority+"/";this.urlPath=c.substring(k.length);this.tileServers=d.tileServers||[];-1===f.authority.indexOf("{subDomain}")&&this.tileServers.push(k);if(d.subDomains&&0<d.subDomains.length&&1<f.authority.split(".").length){this.subDomains=d.subDomains;var r;p.forEach(d.subDomains,function(b,
a){-1<f.authority.indexOf("${subDomain}")?r=f.scheme+"://"+n.substitute(f.authority,{subDomain:b})+"/":-1<f.authority.indexOf("{subDomain}")&&(r=f.scheme+"://"+f.authority.replace(/\{subDomain\}/gi,b)+"/");this.tileServers.push(r)},this)}this.tileServers=p.map(this.tileServers,function(b){"/"!==b.charAt(b.length-1)&&(b+="/");return b});this._levelToLevelValue=[];p.forEach(this.tileInfo.lods,function(b){this._levelToLevelValue[b.level]=b.levelValue||b.level},this);this.loaded=!0;this.onLoad(this)},
getTileUrl:function(a,d,e){a=this._levelToLevelValue[a];var b=this.tileServers[d%this.tileServers.length]+n.substitute(this.urlPath,{level:a,col:e,row:d}),b=b.replace(/\{level\}/gi,a).replace(/\{row\}/gi,d).replace(/\{col\}/gi,e),b=this.addTimestampToURL(b);return c.addProxy(b)}});s("extend-esri")&&d.setObject("layers.WebTiledLayer",l,f);return l})},"dojo/promise/all":function(){define(["../_base/array","../Deferred","../when"],function(l,d,p){var g=l.some;return function(l){var n,f;l instanceof Array?
f=l:l&&"object"===typeof l&&(n=l);var c,a=[];if(n){f=[];for(var e in n)Object.hasOwnProperty.call(n,e)&&(a.push(e),f.push(n[e]));c={}}else f&&(c=[]);if(!f||!f.length)return(new d).resolve(c);var u=new d;u.promise.always(function(){c=a=null});var m=f.length;g(f,function(d,e){n||a.push(e);p(d,function(d){u.isFulfilled()||(c[a[e]]=d,0===--m&&u.resolve(c))},u.reject);return u.isFulfilled()});return u.promise}})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/SpatialReference esri/tasks/query esri/layers/RenderMode".split(" "),
function(l,d,p,g,s,n,f){l=l([f],{declaredClass:"esri.layers._SnapshotMode",constructor:function(c){this.featureLayer=c;this._featureMap={};this._drawFeatures=d.hitch(this,this._drawFeatures);this._queryErrorHandler=d.hitch(this,this._queryErrorHandler)},startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(c){this._init&&(c?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(c){var a=c.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(a,c);this._incRefCount(a)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var c=this.featureLayer;c._collection?(c._fireUpdateStart(),c._refresh(!0),c._fireUpdateEnd()):this._fetchAll()},_getRequestId:function(c){return("_"+c.name+c.layerId+c._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var c=this.featureLayer;
!c._collection&&!c.suspended&&(c._fireUpdateStart(),this._clearIIf(),this._sendRequest())},_sendRequest:function(){var c=this.map,a=this.featureLayer,d=a.getDefinitionExpression(),f=new n;f.outFields=a.getOutFields();f.where=d||"1\x3d1";f.returnGeometry=!0;f.outSpatialReference=new s(c.spatialReference.toJson());f.timeExtent=a.getTimeDefinition();f.maxAllowableOffset=a._maxOffset;a._ts&&(f._ts=(new Date).getTime());f.orderByFields=a.supportsAdvancedQueries?a.getOrderByFields():null;var g;a._usePatch&&
(g=this._getRequestId(a),this._cancelPendingRequest(null,g));a._task.execute(f,this._drawFeatures,this._queryErrorHandler,g)},_drawFeatures:function(c){this._purgeRequests();var a=c.features,d=this.featureLayer,f=d.objectIdField,g,l=a.length,h,k;for(g=0;g<l;g++)h=a[g],k=h.attributes[f],this._addFeatureIIf(k,h),this._incRefCount(k);this._applyTimeFilter(!0);d._fireUpdateEnd(null,c.exceededTransferLimit?{queryLimitExceeded:!0}:null);if(c.exceededTransferLimit)d.onQueryLimitExceeded()},_queryErrorHandler:function(c){this._purgeRequests();
var a=this.featureLayer;a._errorHandler(c);a._fireUpdateEnd(c)}});p("extend-esri")&&d.setObject("layers._SnapshotMode",l,g);return l})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(l,d,p,g,s){l=l([s],{declaredClass:"esri.layers._SelectionMode",constructor:function(d){this.featureLayer=d;this._featureMap={}},propertyChangeHandler:function(d){this._init&&0===d&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});
p("extend-esri")&&d.setObject("layers._SelectionMode",l,g);return l})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/deferredUtils esri/urlUtils esri/Evented".split(" "),function(l,d,p,g,s,n,f,c){l=l(c,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,c){a&&d.isString(a)&&(this._url=f.urlToObject(this.url=a));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=
!0;this._errorHandler=d.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));a&&a.path&&(a.path=a.path.replace(c,"https:"))},_encode:function(a,c,f){var g,l,h={},k,b;for(k in a)if("declaredClass"!==k&&(g=a[k],l=typeof g,null!==g&&void 0!==g&&"function"!==l))if(d.isArray(g)){h[k]=[];b=g.length;for(l=0;l<b;l++)h[k][l]=this._encode(g[l])}else"object"===l?g.toJson&&(l=g.toJson(f&&f[k]),"esri.tasks.FeatureSet"===
g.declaredClass&&l.spatialReference&&(l.sr=l.spatialReference,delete l.spatialReference),h[k]=c?l:p.toJson(l)):h[k]=g;return h},_successHandler:function(a,c,d,f){c&&this[c].apply(this,a);d&&d.apply(null,a);f&&n._resDfd(f,a)},_errorHandler:function(a,c,d){this.onError(a);c&&c(a);d&&d.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});g("extend-esri")&&(s.Task=l);return l})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],
function(l,d,p){l.DeferredList=function(g,l,n,f,c){var a=[];d.call(this);var e=this;0===g.length&&!l&&this.resolve([0,[]]);var u=0;p.forEach(g,function(c,d){function h(c,b){a[d]=[c,b];u++;u===g.length&&e.resolve(a)}c.then(function(a){l?e.resolve([d,a]):h(!0,a)},function(a){n?e.reject(a):h(!1,a);if(f)return null;throw a;})})};l.DeferredList.prototype=new d;l.DeferredList.prototype.gatherResults=function(d){d=new l.DeferredList(d,!1,!0,!1);d.addCallback(function(d){var g=[];p.forEach(d,function(d){g.push(d[1])});
return g});return d};return l.DeferredList})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(l,d,p,g,s,n){l=g("dijit._OnDijitClickMixin",null,{connect:function(d,c,a){return this.inherited(arguments,[d,"ondijitclick"==c?n:c,a])}});l.a11yclick=n;return l})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(l,d,p,g){function s(c){if((c.keyCode===l.ENTER||c.keyCode===
l.SPACE)&&!/input|button|textarea/i.test(c.target.nodeName))for(c=c.target;c;c=c.parentNode)if(c.dojoClick)return!0}var n;p(document,"keydown",function(c){s(c)?(n=c.target,c.preventDefault()):n=null});p(document,"keyup",function(c){s(c)&&c.target==n&&(n=null,p.emit(c.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,metaKey:c.metaKey,altKey:c.altKey,_origType:c.type}))});var f=function(c,a){c.dojoClick=!0;return p(c,"click",a)};f.click=f;f.press=function(c,a){var e=p(c,
g.press,function(c){("mousedown"!=c.type||d.isLeft(c))&&a(c)}),f=p(c,"keydown",function(c){(c.keyCode===l.ENTER||c.keyCode===l.SPACE)&&a(c)});return{remove:function(){e.remove();f.remove()}}};f.release=function(c,a){var e=p(c,g.release,function(c){("mouseup"!=c.type||d.isLeft(c))&&a(c)}),f=p(c,"keyup",function(c){(c.keyCode===l.ENTER||c.keyCode===l.SPACE)&&a(c)});return{remove:function(){e.remove();f.remove()}}};f.move=g.move;return f})},"esri/layers/WMSLayer":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/request esri/urlUtils esri/SpatialReference esri/geometry/Extent esri/layers/DynamicMapServiceLayer esri/layers/WMSLayerInfo dojo/query".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q){p=p([m],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,
3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(c,d){this.url=c=this._stripParameters(c,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=a.urlToObject(c);this._getCapabilitiesURL=c;this._initLayer=g.hitch(this,this._initLayer);this._parseCapabilities=g.hitch(this,this._parseCapabilities);this._getCapabilitiesError=g.hitch(this,this._getCapabilitiesError);d?(this.imageFormat=this._getImageFormat(d.format),this.imageTransparency=!1===d.transparent?!1:!0,this.visibleLayers=d.visibleLayers?d.visibleLayers:[],d.resourceInfo?this._readResourceInfo(d.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=
!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=l.toUrl("esri/layers")+"/../images/pixel.png"},setVisibleLayers:function(a){this.visibleLayers=(a=this._checkVisibleLayersList(a))?a:[];this.refresh(!0)},setImageFormat:function(a){this.imageFormat=this._getImageFormat(a);this.refresh(!0)},setImageTransparency:function(a){this.imageTransparency=a;this.refresh(!0)},getImageUrl:function(c,d,b,e){if(!this.visibleLayers||0===this.visibleLayers.length)e(this._blankImageURL);else{var f=
c.spatialReference.wkid;if(s.some(this._WEB_MERCATOR,function(b){return b==f})){var g=s.filter(this.spatialReferences,function(b){return s.some(this._WEB_MERCATOR,function(a){return a==b})},this);0==g.length&&(g=s.filter(this.spatialReferences,function(b){return s.some(this._WORLD_MERCATOR,function(a){return a==b})},this));f=0<g.length?g[0]:this._WEB_MERCATOR[0]}this.spatialReferences=s.filter(this.spatialReferences,function(b){return b!==f});this.spatialReferences.unshift(f);var g=c.xmin,l=c.xmax,
m=c.ymin,q=c.ymax;c={SERVICE:"WMS",REQUEST:"GetMap"};c.FORMAT=this.imageFormat;c.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";c.STYLES="";c.VERSION=this.version;c.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;c.WIDTH=d;c.HEIGHT=b;this.maxWidth<d&&(c.WIDTH=this.maxWidth);this.maxHeight<b&&(c.HEIGHT=this.maxHeight);d=f?f:NaN;isNaN(d)||("1.3.0"==this.version?c.CRS="EPSG:"+d:c.SRS="EPSG:"+d);"1.3.0"==this.version&&this._useLatLong(d)?c.BBOX=m+","+g+","+q+","+l:c.BBOX=g+","+m+","+l+
","+q;d=this.getMapURL;var z;d+=-1==d.indexOf("?")?"?":"";for(z in c)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=z+"\x3d"+c[z];e(a.addProxy(d))}},_initLayer:function(a,c){this.spatialReference=new e(this.extent.spatialReference);this.initialExtent=new u(this.extent);this.fullExtent=new u(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=!0;this.onLoad(this);var b=this._loadCallback;b&&(delete this._loadCallback,b(this))},_readResourceInfo:function(a){a.extent?
a.layerInfos?(this.extent=a.extent,this.allExtents[0]=a.extent,this.layerInfos=a.layerInfos,this.description=a.description?a.description:"",this.copyright=a.copyright?a.copyright:"",this.title=a.title?a.title:"",this.getMapURL=a.getMapURL?a.getMapURL:this._getCapabilitiesURL,this.version=a.version?a.version:"1.3.0",this.maxWidth=a.maxWidth?a.maxWidth:5E3,this.maxHeight=a.maxHeight?a.maxHeight:5E3,this.spatialReferences=a.spatialReferences?a.spatialReferences:[],this.imageFormat=this._getImageFormat(a.format),
this.setScaleRange(a.minScale,a.maxScale),this._initLayer()):console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo"):console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo")},_getCapabilities:function(){var a=this._url.query?this._url.query:{};a.SERVICE="WMS";a.REQUEST="GetCapabilities";var d=this._url.path+"?",b;for(b in a)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=b+"\x3d"+a[b];c({url:d,handleAs:"xml",headers:{"Content-Type":null},
load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(a){if(a){this.version=this._getAttributeValue("WMS_Capabilities","version",a,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",a,"1.3.0"));var c=this._getTag("Service",a);this.title=this._getTagValue("Title",c,"");if(!this.title||0==this.title.length)this.title=this._getTagValue("Name",c,"");this.copyright=this._getTagValue("AccessConstraints",c,"");this.description=
this._getTagValue("Abstract",c,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",c,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",c,5E3),10);if(c=this._getTag("Layer",a)){var b=this._getLayerInfo(c),e=0,f=null,c=this._getTag("Capability",a);s.forEach(c.childNodes,function(a){"Layer"==a.nodeName&&(0===e?f=a:(1===e&&b.name&&(b.name="",b.subLayers=[],b.subLayers.push(this._getLayerInfo(f))),b.subLayers.push(this._getLayerInfo(a))),e++)},this);if(b){this.layerInfos=b.subLayers;if(!this.layerInfos||
0==this.layerInfos.length)this.layerInfos=[b];this.extent=b.extent;this.allExtents=b.allExtents;this.spatialReferences=b.spatialReferences;0==this.spatialReferences.length&&0<this.layerInfos.length&&(this.spatialReferences=this.layerInfos[0].spatialReferences)}this.getMapURL=this._getCapabilitiesURL;if((c=d.query("DCPType",this._getTag("GetMap",a)))&&0<c.length)if((c=d.query("HTTP",c[0]))&&0<c.length)if((c=d.query("Get",c[0]))&&0<c.length)if(c=this._getAttributeValue("OnlineResource","xlink:href",
c[0],null))c.indexOf("\x26")==c.length-1&&(c=c.substring(0,c.length-1)),this.getMapURL=c;this.getMapFormats=[];0==d.query("Operation",a).length?s.forEach(d.query("Format",this._getTag("GetMap",a)),function(b){this.getMapFormats.push(b.text?b.text:b.textContent)},this):s.forEach(d.query("Operation",a),function(b){"GetMap"==b.getAttribute("name")&&s.forEach(d.query("Format",b),function(b){this.getMapFormats.push(b.text?b.text:b.textContent)},this)},this);s.some(this.getMapFormats,function(b){return-1<
b.indexOf(this.imageFormat)},this)||(this.imageFormat=this.getMapFormats[0]);this._initLayer()}else this._getCapabilitiesError({error:{message:"Response does not contain any layers."}})}else this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)")},_getCapabilitiesError:function(a,c){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",a)},_getLayerInfo:function(a){if(!a)return null;var c=new q;c.name="";c.title="";c.description=
"";c.allExtents=[];c.spatialReferences=[];c.subLayers=[];var b=this._getTag("LatLonBoundingBox",a);b&&(c.allExtents[0]=this._getExtent(b,4326));if(b=this._getTag("EX_GeographicBoundingBox",a)){var d=new u(0,0,0,0,new e({wkid:4326}));d.xmin=parseFloat(this._getTagValue("westBoundLongitude",b,0));d.ymin=parseFloat(this._getTagValue("southBoundLatitude",b,0));d.xmax=parseFloat(this._getTagValue("eastBoundLongitude",b,0));d.ymax=parseFloat(this._getTagValue("northBoundLatitude",b,0));c.allExtents[0]=
d}c.extent=c.allExtents[0];var f=-1<s.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";s.forEach(a.childNodes,function(b){if("Name"==b.nodeName)c.name=(b.text?b.text:b.textContent)||"";else if("Title"==b.nodeName)c.title=(b.text?b.text:b.textContent)||"";else if("Abstract"==b.nodeName)c.description=(b.text?b.text:b.textContent)||"";else if("BoundingBox"==b.nodeName){var a=b.getAttribute(f);a&&0===a.indexOf("EPSG:")?(a=parseInt(a.substring(5),10),0!==a&&!isNaN(a)&&(b="1.3.0"==this.version?
this._getExtent(b,a,this._useLatLong(a)):this._getExtent(b,a),c.allExtents[a]=b,c.extent||(c.extent=b))):a&&0===a.indexOf("CRS:")?(a=parseInt(a.substring(4),10),0!==a&&!isNaN(a)&&(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),c.allExtents[a]=this._getExtent(b,a))):(a=parseInt(a,10),0!==a&&!isNaN(a)&&(c.allExtents[a]=this._getExtent(b,a)))}else if(b.nodeName==f)b=(b.text?b.text:b.textContent).split(" "),s.forEach(b,function(b){b=-1<b.indexOf(":")?parseInt(b.split(":")[1],10):parseInt(b,10);0!==b&&
!isNaN(b)&&(this._CRS_TO_EPSG[b]&&(b=this._CRS_TO_EPSG[b]),-1==s.indexOf(c.spatialReferences,b)&&c.spatialReferences.push(b))},this);else if("Style"==b.nodeName){if(b=this._getTag("LegendURL",b))if(b=this._getTag("OnlineResource",b))c.legendURL=b.getAttribute("xlink:href")}else"Layer"===b.nodeName&&c.subLayers.push(this._getLayerInfo(b))},this);c.title=c.title||c.name;return c},_getImageFormat:function(a){switch(a?a.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";
case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(a,c,b){var d;if(a){d=new u;var f=parseFloat(a.getAttribute("minx")),g=parseFloat(a.getAttribute("miny")),l=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));b?(d.xmin=isNaN(g)?
-1*Number.MAX_VALUE:g,d.ymin=isNaN(f)?-1*Number.MAX_VALUE:f,d.xmax=isNaN(a)?Number.MAX_VALUE:a,d.ymax=isNaN(l)?Number.MAX_VALUE:l):(d.xmin=isNaN(f)?-1*Number.MAX_VALUE:f,d.ymin=isNaN(g)?-1*Number.MAX_VALUE:g,d.xmax=isNaN(l)?Number.MAX_VALUE:l,d.ymax=isNaN(a)?Number.MAX_VALUE:a);d.spatialReference=new e({wkid:c})}return d},_useLatLong:function(a){var c,b;for(b=0;b<this._REVERSED_LAT_LONG_RANGES.length;b++){var d=this._REVERSED_LAT_LONG_RANGES[b];if(a>=d[0]&&a<=d[1]){c=!0;break}}return c},_getTag:function(a,
c){var b=d.query(a,c);return b&&0<b.length?b[0]:null},_getTagValue:function(a,c,b){return(a=d.query(a,c))&&0<a.length?a[0].text?a[0].text:a[0].textContent:b},_getAttributeValue:function(a,c,b,e){return(a=d.query(a,b))&&0<a.length?a[0].getAttribute(c):e},_checkVisibleLayersList:function(a){if(a&&(0<a.length&&this.layerInfos&&0<this.layerInfos.length)&&"number"==typeof a[0]){var c=[];s.forEach(a,function(b){b<this.layerInfos.length&&c.push(this.layerInfos[b].name)},this);a=c}return a},_stripParameters:function(c,
d){var b=a.urlToObject(c),e,f=[];for(e in b.query)-1===s.indexOf(d,e.toLowerCase())&&f.push(e+"\x3d"+b.query[e]);return b.path+(f.length?"?"+f.join("\x26"):"")}});n("extend-esri")&&g.setObject("layers.WMSLayer",p,f);return p})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(l,d,p,g){p(function(){d("highcontrast")&&l.add(g.body(),"dijit_a11y")});return d})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),
function(l,d,p,g,s,n,f,c){var a=d("dijit._TemplatedMixin",c,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var c=this.declaredClass,d=this;return f.substitute(a,this,function(a,e){"!"==e.charAt(0)&&(a=g.getObject(e.substr(1),!1,d));if("undefined"==typeof a)throw Error(c+" template:"+e);return null==a?"":"!"==e.charAt(0)?a:a.toString().replace(/"/g,"\x26quot;")},this)},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=
l(this.templatePath,{sanitize:!0}));var c=a.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),d;if(g.isString(c)){if(d=p.toDom(this._stringRepl(c),this.ownerDocument),1!=d.nodeType)throw Error("Invalid template: "+c);}else d=c.cloneNode(!0);this.domNode=d}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var c=this.containerNode;if(a&&c)for(;a.hasChildNodes();)c.appendChild(a.firstChild)}});a._templateCache=
{};a.getCachedTemplate=function(c,d,g){var l=a._templateCache,h=c,k=l[h];if(k){try{if(!k.ownerDocument||k.ownerDocument==(g||document))return k}catch(b){}p.destroy(k)}c=f.trim(c);if(d||c.match(/\$\{([^\}]+)\}/g))return l[h]=c;d=p.toDom(c,g);if(1!=d.nodeType)throw Error("Invalid template: "+c);return l[h]=d};n("ie")&&s(window,"unload",function(){var c=a._templateCache,d;for(d in c){var f=c[d];"object"==typeof f&&p.destroy(f);delete c[d]}});return a})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has esri/kernel esri/request esri/deferredUtils esri/tasks/Task esri/geometry/Extent esri/geometry/Polyline esri/geometry/Polygon esri/geometry/Multipoint esri/geometry/jsonUtils".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k){l=l(e,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],
"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=d.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=a(this,this._lengthsHandler);
this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);this._trimExtendHandler=a(this,
this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var c=[],d,e=a.length;for(d=0;d<e;d++)c.push(a[d].toJson());return{geometryType:k.getJsonType(a[0]),geometries:c}},_decodeGeometries:function(a,c,e){var f=k.getGeometryType(c);a=a.geometries;var g=[],h={spatialReference:e.toJson()},
l=d.mixin;p.forEach(a,function(a,b){g[b]=new f(l(a,h))});return g},_toProjectGeometry:function(a){var c=a.spatialReference.toJson();return a instanceof u?new q({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new m({paths:[[].concat(a.points)],spatialReference:c})},_fromProjectedGeometry:function(a,c,d){return"esriGeometryEnvelope"===c?(a=a.rings[0],new u(a[0][0],a[0][1],a[2][0],a[2][1],d)):new h({points:a.paths[0],spatialReference:d.toJson()})},
project:function(b,e,f,h){var l=d.mixin({},this._url.query,{f:"json"}),m;b.geometries?(h=f,f=e,e=b.outSR,m=b.geometries[0],l=d.mixin(l,b.toJson())):(m=b[0],l=d.mixin(l,{outSR:e.wkid||g.toJson(e.toJson()),inSR:m.spatialReference.wkid||g.toJson(m.spatialReference.toJson()),geometries:g.toJson(this._encodeGeometries(b))}));var n=k.getJsonType(m),z=this._projectHandler,A=this._errorHandler,x=new s(a._dfdCanceller);x._pendingDfd=c({url:this._url.path+"/project",content:l,callbackParamName:"callback",load:function(a,
b){z(a,b,n,e,f,h,x)},error:function(a){A(a,h,x)}});return x},_projectHandler:function(a,c,d,e,f,g,k){try{var h=this._decodeGeometries(a,d,e);this._successHandler([h],"onProjectComplete",f,k)}catch(l){this._errorHandler(l,g,k)}},onProjectComplete:function(){},simplify:function(b,e,f){var h=b[0].spatialReference,l=d.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:g.toJson(h.toJson()),geometries:g.toJson(this._encodeGeometries(b))}),m=k.getJsonType(b[0]),n=this._simplifyHandler,z=this._errorHandler,
p=new s(a._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/simplify",content:l,callbackParamName:"callback",load:function(a,b){n(a,b,m,h,e,f,p)},error:function(a){z(a,f,p)}});return p},_simplifyHandler:function(a,c,d,e,f,g,k){try{var h=this._decodeGeometries(a,d,e);this._successHandler([h],"onSimplifyComplete",f,k)}catch(l){this._errorHandler(l,g,k)}},onSimplifyComplete:function(){},convexHull:function(b,e,f){var k=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(k.toJson()),
geometries:g.toJson(this._encodeGeometries(b))});var h=this._convexHullHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/convexHull",content:b,callbackParamName:"callback",load:function(a,b){h(a,b,k,e,f,m)},error:function(a){l(a,f,m)}});return m},_convexHullHandler:function(a,c,d,e,f,g){try{var h=k.fromJson(a.geometry).setSpatialReference(d);this._successHandler([h],"onConvexHullComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onConvexHullComplete:function(){},
union:function(b,e,f){var k=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(k.toJson()),geometries:g.toJson(this._encodeGeometries(b))});var h=this._unionHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/union",content:b,callbackParamName:"callback",load:function(a,b){h(a,b,k,e,f,m)},error:function(a){l(a,f,m)}});return m},_unionHandler:function(a,c,d,e,f,g){try{var h=k.fromJson(a.geometry).setSpatialReference(d);this._successHandler([h],
"onUnionComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onUnionComplete:function(){},autoComplete:function(b,e,f,k){var h=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(h.toJson()),polygons:g.toJson(this._encodeGeometries(b).geometries),polylines:g.toJson(this._encodeGeometries(e).geometries)});var l=this._autoCompleteHandler,m=this._errorHandler,z=new s(a._dfdCanceller);z._pendingDfd=c({url:this._url.path+"/autoComplete",content:b,callbackParamName:"callback",load:function(a,
b){l(a,b,h,f,k,z)},error:function(a){m(a,k,z)}});return z},_autoCompleteHandler:function(a,c,d,e,f,k){try{var g=a.geometries;a=[];var h,l=g.length;for(h=0;h<l;h++)a[h]=new q({spatialReference:d,rings:g[h].rings});this._successHandler([a],"onAutoCompleteComplete",e,k)}catch(x){this._errorHandler(x,f,k)}},onAutoCompleteComplete:function(){},reshape:function(b,e,f,h){var l=b.spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(l.toJson()),target:g.toJson({geometryType:k.getJsonType(b),
geometry:b.toJson()}),reshaper:g.toJson(e.toJson())});var m=this._reshapeHandler,n=this._errorHandler,z=new s(a._dfdCanceller);z._pendingDfd=c({url:this._url.path+"/reshape",content:b,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,h,z)},error:function(a){n(a,h,z)}});return z},_reshapeHandler:function(a,c,d,e,f,g){try{var h=k.fromJson(a.geometry).setSpatialReference(d);this._successHandler([h],"onReshapeComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onReshapeComplete:function(){},cut:function(b,
e,f,h){var l=b[0].spatialReference,m=p.map(b,function(a){return a.toJson()});b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(l.toJson()),target:g.toJson({geometryType:k.getJsonType(b[0]),geometries:m}),cutter:g.toJson(e.toJson())});var n=this._cutHandler,z=this._errorHandler,q=new s(a._dfdCanceller);q._pendingDfd=c({url:this._url.path+"/cut",content:b,callbackParamName:"callback",load:function(a,b){n(a,b,l,f,h,q)},error:function(a){z(a,h,q)}});return q},_cutHandler:function(a,c,d,e,f,g){try{var h=
a.geometries,l={};l.cutIndexes=a.cutIndexes;l.geometries=[];p.forEach(h,function(a){l.geometries.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onCutComplete",e,g)}catch(m){this._errorHandler(m,f,g)}},onCutComplete:function(){},intersect:function(b,e,f,h){var l=b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(l.toJson()),geometries:g.toJson(this._encodeGeometries(b)),geometry:g.toJson({geometryType:k.getJsonType(e),geometry:e.toJson()})});var m=this._intersectHandler,
n=this._errorHandler,z=new s(a._dfdCanceller);z._pendingDfd=c({url:this._url.path+"/intersect",content:b,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,h,z)},error:function(a){n(a,h,z)}});return z},_intersectHandler:function(a,c,d,e,f,g){try{var h=[];p.forEach(a.geometries,function(a){h.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([h],"onIntersectComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onIntersectComplete:function(){},difference:function(b,e,f,h){var l=
b[0].spatialReference;b=d.mixin({},this._url.query,{f:"json",sr:g.toJson(l.toJson()),geometries:g.toJson(this._encodeGeometries(b)),geometry:g.toJson({geometryType:k.getJsonType(e),geometry:e.toJson()})});var m=this._differenceHandler,n=this._errorHandler,z=new s(a._dfdCanceller);z._pendingDfd=c({url:this._url.path+"/difference",content:b,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,h,z)},error:function(a){n(a,h,z)}});return z},_differenceHandler:function(a,c,d,e,f,g){try{var h=[];p.forEach(a.geometries,
function(a){h.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([h],"onDifferenceComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onDifferenceComplete:function(){},buffer:function(b,e,f){var g=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.outSpatialReference||b.geometries[0].spatialReference,k=this._bufferHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/buffer",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,
f,m)},error:function(a){l(a,f,m)}});return m},_bufferHandler:function(a,c,d,e,f,g){try{var h=a.geometries;a=[];var k,l=h.length;for(k=0;k<l;k++)a[k]=new q({spatialReference:d,rings:h[k].rings});this._successHandler([a],"onBufferComplete",e,g)}catch(m){this._errorHandler(m,f,g)}},onBufferComplete:function(){},areasAndLengths:function(b,e,f){b=d.mixin({},this._url.query,{f:"json"},b.toJson());var g=this._areasAndLengthsHandler,k=this._errorHandler,h=new s(a._dfdCanceller);h._pendingDfd=c({url:this._url.path+
"/areasAndLengths",content:b,callbackParamName:"callback",load:function(a,b){g(a,b,e,f,h)},error:function(a){k(a,f,h)}});return h},_areasAndLengthsHandler:function(a,c,d,e,f){try{this._successHandler([a],"onAreasAndLengthsComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onAreasAndLengthsComplete:function(){},lengths:function(b,e,f){b=d.mixin({},this._url.query,{f:"json"},b.toJson());var g=this._lengthsHandler,h=this._errorHandler,k=new s(a._dfdCanceller);k._pendingDfd=c({url:this._url.path+"/lengths",
content:b,callbackParamName:"callback",load:function(a,b){g(a,b,e,f,k)},error:function(a){h(a,f,k)}});return k},_lengthsHandler:function(a,c,d,e,f){try{this._successHandler([a],"onLengthsComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onLengthsComplete:function(){},labelPoints:function(b,e,f){var k=p.map(b,function(a){return a.toJson()}),h=b[0].spatialReference,k=d.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:g.toJson(h.toJson()),polygons:g.toJson(k)}),l=this._labelPointsHandler,m=this._errorHandler,
n=new s(a._dfdCanceller);n._pendingDfd=c({url:this._url.path+"/labelPoints",content:k,callbackParamName:"callback",load:function(a,c){l(a,c,b,h,e,f,n)},error:function(a){m(a,f,n)}});return n},_labelPointsHandler:function(a,c,d,e,f,g,h){try{var l=[];p.forEach(a.labelPoints,function(a){l.push(k.fromJson(a).setSpatialReference(e))});this._successHandler([l],"onLabelPointsComplete",f,h)}catch(m){this._errorHandler(m,g,h)}},onLabelPointsComplete:function(){},relation:function(b,e,f){b=d.mixin({},this._url.query,
{f:"json"},b.toJson());var g=this._relationHandler,h=this._errorHandler,k=new s(a._dfdCanceller);k._pendingDfd=c({url:this._url.path+"/relation",content:b,callbackParamName:"callback",load:function(a,b){g(a,b,e,f,k)},error:function(a){h(a,f,k)}});return k},_relationHandler:function(a,c,d,e,f){try{this._successHandler([a.relations],"onRelationComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onRelationComplete:function(){},trimExtend:function(b,e,f){var g=d.mixin({},this._url.query,{f:"json"},b.toJson()),
k=b.sr,h=this._trimExtendHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/trimExtend",content:g,callbackParamName:"callback",load:function(a,b){h(a,b,k,e,f,m)},error:function(a){l(a,f,m)}});return m},_trimExtendHandler:function(a,c,d,e,f,g){try{var k=a.geometries;a=[];var h,l=k.length;for(h=0;h<l;h++)a[h]=new m({spatialReference:d,paths:k[h].paths});this._successHandler([a],"onTrimExtendComplete",e,g)}catch(x){this._errorHandler(x,f,g)}},onTrimExtendComplete:function(){},
densify:function(b,e,f){var g=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometries[0].spatialReference,k=this._densifyHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/densify",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,f,m)},error:function(a){l(a,f,m)}});return m},_densifyHandler:function(a,c,d,e,f,g){try{var h=[];p.forEach(a.geometries,function(a){h.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([h],
"onDensifyComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onDensifyComplete:function(){},generalize:function(b,e,f){var g=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometries[0].spatialReference,k=this._generalizeHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/generalize",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,f,m)},error:function(a){l(a,f,m)}});return m},_generalizeHandler:function(a,c,d,e,f,g){try{var h=[];
p.forEach(a.geometries,function(a){h.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([h],"onGeneralizeComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onGeneralizeComplete:function(){},offset:function(b,e,f){var g=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometries[0].spatialReference,k=this._offsetHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/offset",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,
f,m)},error:function(a){l(a,f,m)}});return m},_offsetHandler:function(a,c,d,e,f,g){try{var h=[];p.forEach(a.geometries,function(a){h.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([h],"onOffsetComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onOffsetComplete:function(){},distance:function(b,e,f){var g=d.mixin({},this._url.query,{f:"json"},b.toJson()),h=b.geometry1.spatialReference,k=this._distanceHandler,l=this._errorHandler,m=new s(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+
"/distance",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,e,f,m)},error:function(a){l(a,f,m)}});return m},_distanceHandler:function(a,c,d,e,f,g){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",e,g)}catch(h){this._errorHandler(h,f,g)}},onDistanceComplete:function(){}});d.mixin(l,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});n("extend-esri")&&d.setObject("tasks.GeometryService",l,f);return l})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b){function t(a){return eval("("+a+")")}function r(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<y){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=y}return b}function v(a,b){var c=a.join();if(!w[c]){for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e];d[d.length]=w[g]=w[g]||p.getObject(g)||~g.indexOf("/")&&(b?b(g):l(g))}e=d.shift();w[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return w[c]}
new Date("X");var y=0;a.after(p,"extend",function(){y++},!0);var w={},C={_clearCache:function(){y++;w={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),f=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);f&&f.length&&g.forEach(f.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var e=(c.scope||d._scopeName)+"Type",f="data-"+(c.scope||d._scopeName)+"-",h=f+
"type",k=f+"mixins",l=[];g.forEach(a,function(a){var c=e in b?b[e]:a.getAttribute(h)||a.getAttribute(e);if(c){var d=a.getAttribute(k),c=d?[c].concat(d.split(/\s*,\s*/)):[c];l.push({node:a,types:c})}});return this._instantiate(l,b,c)},_instantiate:function(a,b,c,d){function f(a){!b._started&&!c.noStart&&g.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=g.map(a,function(a){var d=a.ctor||v(a.types,c.contextRequire);if(!d)throw Error("Unable to resolve constructor for: '"+
a.types.join()+"'");return this.construct(d,a.node,b,c,a.scripts,a.inherited)},this);return d?e(a).then(f):f(a)},construct:function(b,e,f,l,m,n){function s(b){C&&p.setObject(C,b);for(y=0;y<O.length;y++)a[O[y].advice||"after"](b,O[y].method,p.hitch(b,O[y].func),!0);for(y=0;y<V.length;y++)V[y].call(b);for(y=0;y<R.length;y++)b.watch(R[y].prop,R[y].func);for(y=0;y<P.length;y++)k(b,P[y].event,P[y].func);return b}var v=b&&b.prototype;l=l||{};var w={};l.defaults&&p.mixin(w,l.defaults);n&&p.mixin(w,n);var G;
q("dom-attributes-explicit")?G=e.attributes:q("dom-attributes-specified-flag")?G=g.filter(e.attributes,function(a){return a.specified}):(n=(/^input$|^img$/i.test(e.nodeName)?e:e.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),G=g.map(n.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==e.nodeName&&"value"==a||"enctype"==b?e.getAttribute(b):e.getAttributeNode(b).value}}));var M=l.scope||d._scopeName;
n="data-"+M+"-";var E={};"dojo"!==M&&(E[n+"props"]="data-dojo-props",E[n+"type"]="data-dojo-type",E[n+"mixins"]="data-dojo-mixins",E[M+"type"]="dojoType",E[n+"id"]="data-dojo-id");for(var y=0,D,M=[],C,N;D=G[y++];){var F=D.name,H=F.toLowerCase();D=D.value;switch(E[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":N=D;break;case "data-dojo-id":case "jsid":C=D;break;case "data-dojo-attach-point":case "dojoattachpoint":w.dojoAttachPoint=D;break;case "data-dojo-attach-event":case "dojoattachevent":w.dojoAttachEvent=
D;break;case "class":w["class"]=e.className;break;case "style":w.style=e.style&&e.style.cssText;break;default:if(F in v||(F=r(b)[H]||F),F in v)switch(typeof v[F]){case "string":w[F]=D;break;case "number":w[F]=D.length?Number(D):NaN;break;case "boolean":w[F]="false"!=D.toLowerCase();break;case "function":""===D||-1!=D.search(/[^\w\.]+/i)?w[F]=new Function(D):w[F]=p.getObject(D,!1)||new Function(D);M.push(F);break;default:H=v[F],w[F]=H&&"length"in H?D?D.split(/\s*,\s*/):[]:H instanceof Date?""==D?new Date(""):
"now"==D?new Date:u.fromISOString(D):H instanceof c?d.baseUrl+D:t(D)}else w[F]=D}}for(G=0;G<M.length;G++)E=M[G].toLowerCase(),e.removeAttribute(E),e[E]=null;if(N)try{N=t.call(l.propsThis,"{"+N+"}"),p.mixin(w,N)}catch(Y){throw Error(Y.toString()+" in data-dojo-props\x3d'"+N+"'");}p.mixin(w,f);m||(m=b&&(b._noScript||v._noScript)?[]:h("\x3e script[type^\x3d'dojo/']",e));var O=[],V=[],R=[],P=[];if(m)for(y=0;y<m.length;y++)E=m[y],e.removeChild(E),f=E.getAttribute(n+"event")||E.getAttribute("event"),l=
E.getAttribute(n+"prop"),N=E.getAttribute(n+"method"),M=E.getAttribute(n+"advice"),G=E.getAttribute("type"),E=this._functionFromScript(E,n),f?"dojo/connect"==G?O.push({method:f,func:E}):"dojo/on"==G?P.push({event:f,func:E}):w[f]=E:"dojo/aspect"==G?O.push({method:N,advice:M,func:E}):"dojo/watch"==G?R.push({prop:l,func:E}):V.push(E);b=(m=b.markupFactory||v.markupFactory)?m(w,e,b):new b(w,e);return b.then?b.then(s):s(b)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=
c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(t)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var e=[],f=[],h={},k=(b.scope||d._scopeName)+"Type",n="data-"+(b.scope||d._scopeName)+"-",p=n+"type",t=n+"textdir",n=n+"mixins",s=a.firstChild,r=b.inherited;if(!r){var w=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&w(a.parentNode,b)},r={dir:w(a,"dir"),lang:w(a,"lang"),textDir:w(a,t)},u;for(u in r)r[u]||
delete r[u]}for(var r={inherited:r},y,C;;)if(s)if(1!=s.nodeType)s=s.nextSibling;else if(y&&"script"==s.nodeName.toLowerCase())(F=s.getAttribute("type"))&&/^dojo\/\w/i.test(F)&&y.push(s),s=s.nextSibling;else if(C)s=s.nextSibling;else{var F=s.getAttribute(p)||s.getAttribute(k);u=s.firstChild;if(!F&&(!u||3==u.nodeType&&!u.nextSibling))s=s.nextSibling;else{C=null;if(F){var H=s.getAttribute(n);y=H?[F].concat(H.split(/\s*,\s*/)):[F];try{C=v(y,b.contextRequire)}catch(Y){}C||g.forEach(y,function(a){~a.indexOf("/")&&
!h[a]&&(h[a]=!0,f[f.length]=a)});H=C&&!C.prototype._noScript?[]:null;r={types:y,ctor:C,parent:r,node:s,scripts:H};r.inherited=c(r);e.push(r)}else r={node:s,scripts:y,parent:r};y=H;C=s.stopParser||C&&C.prototype.stopParser&&!b.template;s=u}}else{if(!r||!r.node)break;s=r.node.nextSibling;C=!1;r=r.parent;y=r.scripts}var O=new m;f.length?(q("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+f.join(", ")),(b.contextRequire||l)(f,function(){O.resolve(g.filter(e,function(a){if(!a.ctor)try{a.ctor=
v(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):O.resolve(e);return O.promise},_require:function(a,b){var c=t("{"+a.innerHTML+"}"),d=[],e=[],f=new m,g=b&&b.contextRequire||l,h;for(h in c)d.push(h),e.push(c[h]);g(e,function(){for(var a=0;a<d.length;a++)p.setObject(d[a],arguments[a]);f.resolve(arguments)});
return f.promise},_scanAmd:function(a,b){var c=new m,d=c.promise;c.resolve(!0);var e=this;h("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&p.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?n.byId(c):f.body();b=b||{};var d=b.template?{template:!0}:{},e=[],g=this,h=this._scanAmd(c,b).then(function(){return g.scan(c,b)}).then(function(a){return g._instantiate(a,
d,b,!0)}).then(function(a){return e=e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});p.mixin(e,h);return e}};d.parser=C;s.parseOnLoad&&b(100,C,"parse");return C})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(l,d,p,g,s,n,f,c,a,e,u,m,q){function h(){}
function k(a){return function(c,d,e,g){return c&&"string"==typeof d&&c[d]==h?c.on(d.substring(2).toLowerCase(),f.hitch(e,g)):a.apply(p,arguments)}}l.around(p,"connect",k);n.connect&&l.around(n,"connect",k);l=g("dijit._Widget",[u,m,q],{onClick:h,onDblClick:h,onKeyDown:h,onKeyPress:h,onKeyUp:h,onMouseDown:h,onMouseMove:h,onMouseOut:h,onMouseOver:h,onMouseLeave:h,onMouseEnter:h,onMouseUp:h,constructor:function(a){this._toConnect={};for(var c in a)this[c]===h&&(this._toConnect[c.replace(/^on/,"").toLowerCase()]=
a[c],delete a[c])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,c){return this[this._onMap(a)]===h?p.connect(this.domNode,a.toLowerCase(),this,c):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,c){n.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,c)},attr:function(a,
c){if(d.isDebug){var e=arguments.callee._ach||(arguments.callee._ach={}),f=(arguments.callee.caller||"unknown caller").toString();e[f]||(n.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+f,"","2.0"),e[f]=!0)}return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){n.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?
c("[widgetId]",this.containerNode).map(e.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});s("dijit-legacy-requires")&&a(0,function(){require(["dijit/_base"])});return l})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t){var r,v=new (d([m,f],{curNode:null,activeStack:[],constructor:function(){var a=c.hitch(this,function(a){p.isDescendant(this.curNode,a)&&this.set("curNode",null);p.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});l.before(s,"empty",a);l.before(s,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(b,c){var d=this,e=b.document&&b.document.body;if(e){var f=a(b.document,"mousedown, touchstart",function(a){d._justMouseDowned=
!0;setTimeout(function(){d._justMouseDowned=!1},0);if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),g=a(e,"focusin",function(a){r=(new Date).getTime();if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(k.isTabNavigable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),h=a(e,"focusout",function(a){(new Date).getTime()<r+100||d._onBlurNode(c||a.target)});return{remove:function(){f.remove();g.remove();h.remove();
e=f=g=h=null}}}},_onBlurNode:function(a){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(c.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0);this._justMouseDowned||(this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(c.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0))},_onTouchNode:function(a,c){this._clearActiveWidgetsTimer&&
(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var d=[];try{a&&(n.contains(a,"dijitMenuPopup")&&!a.getAttribute("dijitPopupParent"))&&(a=a.firstChild);for(;a;){var e=g.get(a,"dijitPopupParent");if(e)a=b.byId(e).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===q.body())break;a=h.get(a.ownerDocument).frameElement}else{var f=a.getAttribute&&a.getAttribute("widgetId"),k=f&&b.byId(f);k&&!("mouse"==c&&k.get("disabled"))&&d.unshift(f);a=a.parentNode}}}catch(l){}this._setStack(d,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,c){var d=this.activeStack,e=d.length-1,f=a.length-1;if(a[f]!=d[e]){this.set("activeStack",a);var g;for(g=e;0<=g&&d[g]!=a[g];g--)if(e=b.byId(d[g]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),this.emit("widget-blur",
e,c);for(g++;g<=f;g++)if(e=b.byId(a[g]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));e(function(){var b=v.registerWin(h.get(document));u("ie")&&a(window,"unload",function(){b&&(b.remove(),b=null)})});t.focus=function(a){v.focus(a)};for(var y in v)/^_/.test(y)||(t.focus[y]="function"==typeof v[y]?c.hitch(v,y):v[y]);v.watch(function(a,b,c){t.focus[a]=c});return v})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(l,d,p,g){g.extend(d,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return p("dijit._FocusMixin",null,{_focusManager:l})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang esri/geometry/Point".split(" "),function(l,d,p,g,s,n,f){var c=l(null,{declaredClass:"esri.layers.MosaicRule",
method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,constructor:function(a){d.isObject(a)&&(d.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),
a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new f(a.viewpoint)))},toJson:function(){var a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation};return n.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var d=c.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":d=
c.METHOD_ATTRIBUTE;break;case "center":d=c.METHOD_CENTER;break;case "lockraster":d=c.METHOD_LOCKRASTER;break;case "nadir":d=c.METHOD_NADIR;break;case "northwest":d=c.METHOD_NORTHWEST;break;case "seamline":d=c.METHOD_SEAMLINE;break;case "viewpoint":d=c.METHOD_VIEWPOINT}return d}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return c.OPERATION_FIRST;case "last":return c.OPERATION_LAST;case "max":return c.OPERATION_MAX;case "min":return c.OPERATION_MIN;case "blend":return c.OPERATION_BLEND;
case "mean":return c.OPERATION_MEAN}}});d.mixin(c,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});g("extend-esri")&&
d.setObject("layers.MosaicRule",c,s);return c})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has esri/kernel esri/request esri/deferredUtils esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/FeatureSet".split(" "),function(l,d,p,g,s,n,f,c,a,e,u,m){l=l(u,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],
"execute-relationship-query-complete":["featureSets"]},constructor:function(a,c){this._handler=d.hitch(this,this._handler);this._relationshipQueryHandler=d.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=d.hitch(this,this._executeForIdsHandler);this._countHandler=d.hitch(this,this._countHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},execute:function(a,e,f,b,g){var l=g.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json"},a.toJson(l&&l[0])));var m=this._handler,n=this._errorHandler;this.source&&(l={source:this.source.toJson()},a.layer=s.toJson(l));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return c({url:this._url.path+
"/query",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,e,f,g.dfd)},error:function(a){n(a,f,g.dfd)},callbackSuffix:b},this.requestOptions)},executeRelationshipQuery:function(e,f,k){e=this._encode(d.mixin({},this._url.query,{f:"json"},e.toJson()));var b=this._relationshipQueryHandler,l=this._errorHandler;this.gdbVersion&&(e.gdbVersion=this.gdbVersion);var m=new g(a._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/queryRelatedRecords",content:e,callbackParamName:"callback",load:function(a,
c){b(a,c,f,k,m)},error:function(a){l(a,k,m)}},this.requestOptions);return m},executeForIds:function(a,e,f,b){var g=b.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(g&&g[0])));var l=this._executeForIdsHandler,m=this._errorHandler;this.source&&(g={source:this.source.toJson()},a.layer=s.toJson(g));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){l(a,c,e,f,b.dfd)},error:function(a){m(a,
f,b.dfd)}},this.requestOptions)},executeForCount:function(a,e,f,b){var g=b.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(g&&g[0])));var l=this._countHandler,m=this._errorHandler;this.source&&(g={source:this.source.toJson()},a.layer=s.toJson(g));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){l(a,c,e,f,b.dfd)},error:function(a){m(a,f,b.dfd)}},
this.requestOptions)},_handler:function(a,c,d,b,e){try{var f=new m(a);this._successHandler([f],"onComplete",d,e)}catch(g){this._errorHandler(g,b,e)}},_relationshipQueryHandler:function(a,c,d,b,e){try{var f=a.geometryType,g=a.spatialReference,l={};p.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=f;b.spatialReference=g;b.features=a.relatedRecords;b=new m(b);l[a.objectId]=b});this._successHandler([l],"onExecuteRelationshipQueryComplete",d,e)}catch(n){this._errorHandler(n,b,e)}},_executeForIdsHandler:function(a,
c,d,b,e){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",d,e)}catch(f){this._errorHandler(f,b,e)}},_countHandler:function(a,c,d,b,e){try{var f,g=a.features,l=a.objectIds;if(l)f=l.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");f=a.count}this._successHandler([f],"onExecuteForCountComplete",d,e)}catch(m){this._errorHandler(m,b,e)}}});e._createWrappers(l);n("extend-esri")&&d.setObject("tasks.QueryTask",l,f);return l})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/has dojo/io-query esri/kernel esri/config esri/lang esri/request esri/deferredUtils esri/urlUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/layers/MosaicRule esri/layers/DynamicMapServiceLayer esri/layers/TimeInfo esri/layers/Field esri/graphic esri/tasks/ImageServiceIdentifyTask esri/tasks/ImageServiceIdentifyParameters".split(" "),
function(l,d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t,r,v,y,w,C,z,A){l=l(v,{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this._url=h.urlToObject(a);var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this._params=
d.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this._initLayer=d.hitch(this,this._initLayer);this._queryVisibleRastersHandler=d.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=b&&b.useMapImage||!1;this.infoTemplate=b&&b.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=
b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):m({url:this._url.path,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,e=this.maxScale;d.mixin(this,a);this.minScale=c;this.maxScale=e;this.initialExtent=this.fullExtent=this.extent=
new k(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var f=this.minValues,g=this.maxValues,h=this.meanValues,l=this.stdvValues,m=this.bands=[],c=0,e=this.bandCount;c<e;c++)m[c]={min:f[c],max:g[c],mean:h[c],stddev:l[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new y(c):null;e=this.fields=[];if(f=a.fields)for(c=0;c<f.length;c++)e.push(new w(f[c]));this.version=a.currentVersion;this.version||
(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);u.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);u.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=r.METHOD_NONE;this.defaultMosaicRule=new r(c);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(d.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=d.clone(a.fields))}));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new p(q._dfdCanceller);10<this.version?(b._pendingDfd=m({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=n.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new p(q._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=m({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=n.isDebug,
b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new p;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(d.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=
a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?d.clone(this.fields):[];var e=a.length;a[e]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")&&(a[e+1]=c);this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&
(c=g.filter(this._rasterAttributeTableFields,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=g.map(c,function(a){var c=d.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},getImageUrl:function(a,b,f,g){var k=a.spatialReference.wkid||s.toJson(a.spatialReference.toJson());delete this._params._ts;var l=this._url.path+"/exportImage?";d.mixin(this._params,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:k,bboxSR:k,size:b+","+f},this.disableClientCaching?
{_ts:(new Date).getTime()}:{});var n=this._params.token=this._getToken();a=h.addProxy(l+c.objectToQuery(d.mixin(this._params,{f:"image"})));a.length>e.defaults.io.postLength||this.useMapImage?this._jsonRequest=m({url:l,content:d.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;n&&(c+=-1===c.indexOf("?")?"?token\x3d"+n:"\x26token\x3d"+n);g(h.addProxy(c))},error:this._errorHandler}):g(a)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=
a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=s.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?s.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=r.METHOD_NONE);c.where=a;c=new r(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
b}},exportMapImage:function(a,b){var c=e.defaults.map,c=d.mixin({size:c.width+","+c.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete c._ts;this._exportMapImage(this._url.path+"/exportImage",c,b)},queryVisibleRasters:function(a,c,d,e){var f=this._map,g=q._fixDfd(new p(q._dfdCanceller));this._visibleRasters=[];var h,k,l=!0;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){l=!1;for(h=0;h<this.infoTemplate.info.fieldInfos.length;h++)(k=
this.infoTemplate.info.fieldInfos[h])&&(k.visible&&"raster.servicepixelvalue"!==k.fieldName.toLowerCase())&&(l=!0)}h=new A;h.geometry=a.geometry.getCenter();h.returnGeometry=!0;h.returnCatalogItems=l;h.timeExtent=a.timeExtent;h.mosaicRule=this.mosaicRule?this.mosaicRule:null;h.renderingRule=this.renderingRule?this.renderingRule:null;f&&(a=new b((f.extent.xmax-f.extent.xmin)/(2*f.width),(f.extent.ymax-f.extent.ymin)/(2*f.height),f.extent.spatialReference),h.pixelSize=a);var m=this;a=new z(this.url);
(g._pendingDfd=a.execute(h)).addCallbacks(function(a){m._queryVisibleRastersHandler(a,c,d,e,g)},function(a){m._resolve([a],null,e,g,!0)});return g},_queryVisibleRastersHandler:function(a,b,c,e,f){var h=a.features,l=a.value,m;a.catalogItems&&(h=a.catalogItems.features,m=a.properties.Values);this._visibleRasters=[];var n;a=-1<l.toLowerCase().indexOf("nodata");l&&(!h&&!a)&&(h=[],n=new C(new k(this.fullExtent),null,{ObjectId:0}),h.push(n));var p=[];if(h){a=this.getCustomRasterFields(b);var s=this._getDomainFields(a),
q=b?b.returnDomainValues:!1,t=b&&b.rasterAttributeTableFieldPrefix,r,z,v,A,w,y,R,P;this._getRasterAttributeTableFeatures().then(d.hitch(this,function(a){for(r=0;r<h.length;r++){n=h[r];n.setInfoTemplate(this.infoTemplate);if(l&&(z=l,m&&m.length>=r&&(v=m[r],z=v.replace(/ /gi,", ")),n.attributes["Raster.ItemPixelValue"]=z,n.attributes["Raster.ServicePixelValue"]=l,a&&0<a.length&&(A=g.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==z:a.attributes.VALUE==
z}),0<A.length&&(w=d.clone(A[0]),t&&w)))){P={};for(y in w.attributes)w.attributes.hasOwnProperty(y)&&(R=t+y,P[R]=w.attributes[y]);w.attributes=P;n.attributes=d.mixin(n.attributes,w.attributes)}q&&(s&&0<s.length)&&g.forEach(s,function(a){if(a){var b=n.attributes[a.name];u.isDefined(b)&&(b=this._getDomainValue(a.domain,b),u.isDefined(b)&&(n.attributes[a.name]=b))}},this);p.push(n);this._visibleRasters.push(n)}this._resolve([p,null,!0],null,c,f)}))}else this._resolve([p,null,null],null,c,f)},getVisibleRasters:function(){var a=
this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];g.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;g.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&q._resDfd(d,a,e)}});f("extend-esri")&&d.setObject("layers.ArcGISImageServiceLayer",
l,a);return l})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore esri/kernel esri/config esri/request esri/SpatialReference esri/geometry/Point esri/geometry/Geometry esri/geometry/jsonUtils esri/geometry/webMercatorUtils".split(" "),function(l,d,p,g,s,n,f,c,a,e,u,m,q,h){function k(a){var b=0,c="";d.forEach([","," ",";","|","\t"],function(d){var e=a.split(d).length;e>b&&(b=e,c=d)});return c}function b(a,b){if(!a||
"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime()))return!1;var c=!0;if(g("chrome")&&/\d+\W*$/.test(b)){var d=b.match(/[a-zA-Z]{2,}/);if(d){for(var c=!1,e=0,f=d.length,h=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!c&&e<=f&&!(c=!h.test(d[e]));)e++;c=!c}}return c}function t(a,c,f){var h=a.indexOf("\n"),h=l.trim(a.substr(0,h)),m=c.columnDelimiter;m||(m=
k(h));var p=new n({data:a,separator:m});a=9>g("ie")?750:1001;p.fetch({start:0,count:a,onComplete:function(a,g){var h=0,k={layerDefinition:c.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},l=k.layerDefinition.objectIdField;!l&&!d.some(k.layerDefinition.fields,function(a){return"esriFieldTypeOID"==a.type?(l=a.name,!0):!1})&&(k.layerDefinition.fields.push({name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}),l="__OBJECTID");var m,n,q=p._attributes,
t=[],r=[];d.forEach(k.layerDefinition.fields,function(a,b){"esriFieldTypeDate"===a.type?t.push(a.name):("esriFieldTypeDouble"===a.type||"esriFieldTypeInteger"===a.type)&&r.push(a.name)});c.locationInfo&&"coordinates"===c.locationInfo.locationType?(m=c.locationInfo.latitudeFieldName,n=c.locationInfo.longitudeFieldName):d.forEach(q,function(a){var b;b=d.indexOf(w,a.toLowerCase());-1!==b&&(m=a);b=d.indexOf(C,a.toLowerCase());-1!==b&&(n=a)},this);if(!m||!n)setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},
1);else{var q=0,v=a.length;for(q;q<v;q++){if(1E3<=k.featureSet.features.length){setTimeout(function(){console.error("1000 feature limit reached. Unable to load any more data.")},1);break}var z=a[q],y=p.getAttributes(z),B={};d.forEach(y,function(a,c){if(a){var e=a;0===a.length&&d.forEach(k.layerDefinition.fields,function(b,c){b.name==="attribute_"+(c-1)&&(a="attribute_"+(c-1))});if(d.some(t,function(b){return b===a})){var e=p.getValue(z,e),f=new Date(e);B[a]=b(f,e)?f.getTime():null}else if(d.some(r,
function(b){return b===a})){f=s.parse(p.getValue(z,e));if((a==m||a==n)&&(isNaN(f)||181<Math.abs(f)))f=parseFloat(p.getValue(z,e));isNaN(f)?B[a]=null:B[a]=f}else B[a]=p.getValue(z,e)}});B[l]=h;h++;var y=B[m],L=B[n];null==L||(null==y||isNaN(y)||isNaN(L))||(y={geometry:(new u(L,y,new e({wkid:4326}))).toJson(),attributes:B},k.featureSet.features.push(y))}k.layerDefinition.name="csv";f&&f(k)}},onError:function(a){console.error("Error fetching items from CSV store: ",a)}});return!0}function r(a,b,e,f,g,
k){0===a.length&&g(null);var m=q.getGeometryType(b),n=[];d.forEach(a,function(a){a=new m(a);a.spatialReference=e;n.push(a)},this);b=[102113,102100,3857];e.wkid&&4326===e.wkid&&f.wkid&&-1<d.indexOf(b,f.wkid)?(d.forEach(n,function(a){a.xmin?(a.xmin=Math.max(a.xmin,-180),a.xmax=Math.min(a.xmax,180),a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99)):a.rings?d.forEach(a.rings,function(a){d.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},
this)},this):a.paths?d.forEach(a.paths,function(a){d.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.x&&(a.x=Math.min(Math.max(a.x,-180),180),a.y=Math.min(Math.max(a.y,-89.99),89.99))},this),a=[],d.forEach(n,function(b){b=h.geographicToWebMercator(b);102100!==f.wkid&&(b.spatialReference=f);a.push(b.toJson())},this),g(a)):null!==e.wkid&&-1<d.indexOf(b,e.wkid)&&null!==f.wkid&&4326===f.wkid?(a=[],d.forEach(n,function(b){a.push(h.webMercatorToGeographic(b).toJson())},
this),g(a)):(b=function(b,c){b&&b.length===a.length?(a=[],d.forEach(b,function(b){b&&(b.rings&&0<b.rings.length&&0<b.rings[0].length&&0<b.rings[0][0].length&&!isNaN(b.rings[0][0][0])&&!isNaN(b.rings[0][0][1])||b.paths&&0<b.paths.length&&0<b.paths[0].length&&0<b.paths[0][0].length&&!isNaN(b.paths[0][0][0])&&!isNaN(b.paths[0][0][1])||b.xmin&&!isNaN(b.xmin)&&b.ymin&&!isNaN(b.ymin)||b.x&&!isNaN(b.x)&&b.y&&!isNaN(b.y))?a.push(b.toJson()):a.push(null)},this),g(a)):k(b,c)},c.defaults.geometryService?c.defaults.geometryService.project(n,
f,l.hitch(this,b),k):g(null))}function v(a,b){var c=[102113,102100,3857];return a&&b&&a.wkid===b.wkid&&a.wkt===b.wkt||a&&b&&a.wkid&&b.wkid&&-1<d.indexOf(c,a.wkid)&&-1<d.indexOf(c,b.wkid)?!0:!1}function y(a,b,c,f){if(a.featureSet&&0!==a.featureSet.features.length)if(v(c,b))f(a);else{var g=function(b){var c=[];d.forEach(a.featureSet.features,function(a,d){b[d]&&(a.geometry=b[d],c.push(a))},this);f(a)},h=function(b,c){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Final try.");
f(a)},k=function(d,e){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Try one more time.");r(m,a.featureSet.geometryType,b,c,l.hitch(this,g),l.hitch(this,h))};if(a.featureSet.features&&0<a.featureSet.features.length){var m=[];d.forEach(a.featureSet.features,function(b){if(b.geometry.toJson)m.push(b.geometry);else{var c=q.getGeometryType(a.featureSet.geometryType);m.push(new c(b.geometry))}});b.toJson||(b=new e(b));c.toJson||(c=new e(c));r(m,a.featureSet.geometryType,b,c,l.hitch(this,
g),l.hitch(this,k))}else f(a)}}var w="lat latitude y ycenter latitude83 latdecdeg POINT-Y".split(" "),C="lon lng long longitude x xcenter longitude83 longdecdeg POINT-X".split(" ");m={latFieldStrings:w,longFieldStrings:C,buildCSVFeatureCollection:function(b){var c=new p,d=function(a){c.callback(a)};a({url:b.url,handleAs:"text",load:function(a){t(a,b,l.hitch(this,d))},error:function(a){console.error("error: "+a)}},{usePost:!1});return c},projectFeatureCollection:function(a,b,c){var d=new p;c||(c=new e({wkid:4326}));
y(a,c,b,l.hitch(this,function(a){d.callback(a)}));return d},generateDefaultPopupInfo:function(a){var b={esriFieldTypeDouble:1,esriFieldTypeSingle:1},c={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},f=null;a=d.map(a.layerDefinition.fields,l.hitch(this,function(a){"NAME"===a.name.toUpperCase()&&(f=a.name);var d="esriFieldTypeOID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeGeometry"!==a.type,g=null;if(d){var h=a.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+
h+",")||-1<h.indexOf("area")||-1<h.indexOf("length")||-1<h.indexOf("shape")||-1<h.indexOf("perimeter")||-1<h.indexOf("objectid")||h.indexOf("_")===h.length-1||h.indexOf("_i")===h.length-2&&1<h.length)d=!1;a.type in c?g={places:0,digitSeparator:!0}:a.type in b?g={places:2,digitSeparator:!0}:a.type in e&&(g={dateFormat:"shortDateShortTime"})}return l.mixin({},{fieldName:a.name,label:a.alias,isEditable:!0,tooltip:"",visible:d,format:g,stringFieldOption:"textbox"})}));return{title:f?"{"+f+"}":"",fieldInfos:a,
description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:k,_isValidDate:b,_processCsvData:t,_projectGeometries:r,_sameSpatialReference:v,_projectFeatureSet:y};g("extend-esri")&&l.setObject("arcgis.csv",m,f);return m})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(l,d,p){return p("dijit.Destroyable",null,{destroy:function(d){this._destroyed=!0},own:function(){l.forEach(arguments,function(g){var l="destroyRecursive"in g?"destroyRecursive":
"destroy"in g?"destroy":"remove",n=d.before(this,"destroy",function(c){g[l](c)}),f=d.after(g,l,function(){n.remove();f.remove()},!0)},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(l,d,p,g){l=l(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(g){g&&d.isObject(g)&&(this.objectId=g.objectId,this.success=g.success,g.success||(g=g.error,this.error=Error(),this.error.code=
g.code,this.error.message=g.description))}});p("extend-esri")&&d.setObject("layers.FeatureEditResult",l,g);return l})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(l){return l.cache})},"esri/tasks/query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has esri/kernel esri/geometry/jsonUtils esri/tasks/SpatialRelationship dojo/has!extend-esri?esri/tasks/QueryTask dojo/has!extend-esri?esri/tasks/RelationshipQuery dojo/has!extend-esri?esri/tasks/StatisticDefinition".split(" "),
function(l,d,p,g,s,n,f,c){var a=l(null,{declaredClass:"esri.tasks.Query",constructor:function(){this.spatialRelationship=a.SPATIAL_REL_INTERSECTS},text:null,where:"",geometry:null,groupByFieldsForStatistics:null,objectIds:null,returnGeometry:!1,orderByFields:null,outSpatialReference:null,outFields:null,outStatistics:null,timeExtent:null,relationParam:null,pixelSize:null,toJson:function(c){var d={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,
maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};c=c&&c.geometry||this.geometry;var l=this.objectIds,n=this.outFields,h=this.outSpatialReference,k=this.groupByFieldsForStatistics,b=this.orderByFields,s=this.outStatistics;c&&(d.geometry=c,d.geometryType=f.getJsonType(c),d.inSR=c.spatialReference.wkid||g.toJson(c.spatialReference.toJson()));l&&(d.objectIds=l.join(","));n&&(d.outFields=n.join(","));k&&(d.groupByFieldsForStatistics=k.join(","));b&&(d.orderByFields=
b.join(","));if(s){var r=[];p.forEach(s,function(a,b){r.push(a.toJson())});d.outStatistics=g.toJson(r)}null!==h?d.outSR=h.wkid||g.toJson(h.toJson()):c&&(d.outSR=c.spatialReference.wkid||g.toJson(c.spatialReference.toJson()));c=this.timeExtent;d.time=c?c.toJson().join(","):null;if((c=this.relationParam)&&this.spatialRelationship===a.SPATIAL_REL_RELATION)d.relationParam=c;d.pixelSize=this.pixelSize?g.toJson(this.pixelSize.toJson()):null;d._ts=this._ts;return d}});d.mixin(a,c);s("extend-esri")&&d.setObject("tasks.Query",
a,n);return a})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/lang esri/graphic esri/SpatialReference esri/graphicsUtils esri/geometry/jsonUtils esri/symbols/jsonUtils".split(" "),function(l,d,p,g,s,n,f,c,a,e,u){l=l(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){d.mixin(this,a);var g=this.features,h=a.spatialReference,k=e.getGeometryType(a.geometryType),h=this.spatialReference=new c(h);this.geometryType=
a.geometryType;a.fields&&(this.fields=a.fields);p.forEach(g,function(a,c){var d=a.geometry&&a.geometry.spatialReference;g[c]=new f(k&&a.geometry?new k(a.geometry):null,a.symbol&&u.fromJson(a.symbol),a.attributes);g[c].geometry&&!d&&g[c].geometry.setSpatialReference(h)})}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(c){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);
this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=e.getJsonType(this.features[0].geometry)),d.features=a._encodeGraphics(this.features,c));d.exceededTransferLimit=this.exceededTransferLimit;return n.fixJson(d)}});g("extend-esri")&&d.setObject("tasks.FeatureSet",l,s);return l})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/graphic".split(" "),
function(l,d,p,g,s,n){l=l(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(f){f&&d.isObject(f)&&(this.name=f.name,this.description=f.description,this.drawingTool=f.drawingTool,f=f.prototype,this.prototype=new n(f.geometry,null,f.attributes))},toJson:function(){return s.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()})}});d.mixin(l,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",
TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",
TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});p("extend-esri")&&d.setObject("layers.FeatureTemplate",l,g);return l})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang".split(" "),function(l,d,p,g,s,n){l=l(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,
bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(d){var c=this.bbox||this.extent;d=(c=c&&d&&c._normalize(!0))?c.spatialReference.wkid||p.toJson(c.spatialReference.toJson()):null;var a=this.imageSpatialReference,c={bbox:c?c.xmin+","+c.ymin+","+c.xmax+","+c.ymax:null,bboxSR:d,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:a?a.wkid||p.toJson(a.toJson()):d,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,
bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?p.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?p.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation};d=this.timeExtent;c.time=d?d.toJson().join(","):null;return n.filter(c,function(a){if(null!==a&&void 0!==a)return!0})}});d.mixin(l,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",
INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});g("extend-esri")&&d.setObject("layers.ImageServiceParameters",l,s);return l})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(l){var d={};l.setObject("dojo.data.util.filter",d);d.patternToRegExp=function(d,g){for(var l="^",n=null,f=0;f<d.length;f++)switch(n=d.charAt(f),n){case "\\":l+=n;f++;l+=d.charAt(f);break;case "*":l+=".*";break;case "?":l+=
".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":l+="\\";default:l+=n}l+="$";return g?RegExp(l,"mi"):RegExp(l,"m")};return d})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct esri/kernel esri/InfoTemplate esri/PopupInfo esri/dijit/PopupRenderer".split(" "),function(l,d,p,g,s,n,f,c){l=l([n,f],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,
constructor:function(a,c){d.mixin(this,c);this.initialize(a,c)},getTitle:function(a){return this.info?this.getComponents(a).title:""},getContent:function(a){return this.info?(new c({template:this,graphic:a,chartTheme:this.chartTheme},g.create("div"))).domNode:""}});p("extend-esri")&&d.setObject("dijit.PopupTemplate",l,s);return l})},"*noref":1}});
define("esri/arcgis/utils","dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/has dojo/DeferredList dojo/dom-construct esri/kernel esri/config esri/lang esri/request esri/SpatialReference esri/map esri/urlUtils esri/geometry/ScreenPoint esri/geometry/Extent esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/renderers/jsonUtils esri/dijit/PopupTemplate esri/dijit/Popup esri/tasks/query esri/tasks/GeometryService esri/arcgis/csv esri/layers/ArcGISTiledMapServiceLayer esri/layers/ArcGISDynamicMapServiceLayer esri/layers/ArcGISImageServiceLayer esri/layers/OpenStreetMapLayer esri/layers/WebTiledLayer esri/layers/FeatureLayer esri/layers/WMSLayer esri/layers/KMLLayer esri/layers/GeoRSSLayer esri/virtualearth/VETiledLayer esri/layers/TileInfo esri/layers/DynamicLayerInfo esri/layers/LayerDrawingOptions esri/layers/ImageParameters esri/layers/ImageServiceParameters esri/layers/RasterFunction esri/layers/MosaicRule esri/layers/WMSLayerInfo dojo/i18n!esri/nls/jsapi".split(" "),function(l,
d,p,g,s,n,f,c,a,e,u,m,q,h,k,b,t,r,v,y,w,C,z,A,x,B,L,I,K,U,fa,G,M,E,Q,D,X,N,F,H,Y,O,V,R,P){function W(a){return q({url:J.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function na(a){var c={f:"json"};if(e.id){var d=e.id.findCredential(b.urlToObject(J.arcgisUrl).path);d&&(c.token=d.token)}return q({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function oa(a){a.itemProperties.layerDefinition&&(a.layerDefinition?
(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),m.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),m.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),m.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):a.layerDefinition=a.itemProperties.layerDefinition);
a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);m.isDefined(a.itemProperties.showLegend)&&!m.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);m.isDefined(a.itemProperties.refreshInterval)&&!m.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}function Z(a,b){var e=new g,f=a.itemData,h=[],k=[];d.forEach(f.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")||
-1<b.indexOf("/mapserver/")?(k.push(a),h.push(W(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!m.isDefined(a.minScale)&&!m.isDefined(a.maxScale))?(k.push(a),h.push(W(a))):-1<b.indexOf("/imageserver")&&(!m.isDefined(a.minScale)&&!m.isDefined(a.maxScale))&&(k.push(a),h.push(W(a)))}});f.baseMap&&f.baseMap.baseMapLayers&&d.forEach(f.baseMap.baseMapLayers,function(a){("BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type)&&a.portalUrl?(delete b.bingMapsKey,
k.push(a),h.push(na(a.portalUrl))):a.itemId&&(k.push(a),h.push(W(a)))});0<h.length?(new c(h)).addCallback(function(c){d.forEach(k,function(a,e){if(("BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type)&&a.portalUrl)c[e][1].bingKey?b.bingMapsKey=c[e][1].bingKey:(a.errors=a.errors||[],a.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+a.type+"]"}));else{var f=c[e][1];if(f&&!a.type){var g=a.url.toLowerCase();(-1<g.indexOf("/featureserver")||
-1<g.indexOf("/mapserver/"))&&f.layers?d.forEach(f.layers,function(b){if(g.endsWith("/featureserver/"+b.id)||g.endsWith("/mapserver/"+b.id))a.itemProperties=b,oa(a)}):-1<g.indexOf("/mapserver")?(f.layers&&!a.layers&&(a.layers=f.layers),m.isDefined(f.minScale)&&!m.isDefined(a.minScale)&&(a.minScale=f.minScale),m.isDefined(f.maxScale)&&!m.isDefined(a.maxScale)&&(a.maxScale=f.maxScale),m.isDefined(f.refreshInterval)&&!m.isDefined(a.refreshInterval)&&(a.refreshInterval=f.refreshInterval)):-1<g.indexOf("/imageserver")&&
(m.isDefined(f.minScale)&&!m.isDefined(a.minScale)&&(a.minScale=f.minScale),m.isDefined(f.maxScale)&&!m.isDefined(a.maxScale)&&(a.maxScale=f.maxScale),m.isDefined(f.refreshInterval)&&!m.isDefined(a.refreshInterval)&&(a.refreshInterval=f.refreshInterval),f.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=f.popupInfo),f.renderingRule&&!a.renderingRule&&(a.renderingRule=f.renderingRule,f.renderingRule.functionName&&(a.renderingRule.rasterFunction=f.renderingRule.functionName)),f.bandIds&&!a.bandIds&&
(a.bandIds=f.bandIds),f.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=f.mosaicRule),f.format&&!a.format&&(a.format=f.format),m.isDefined(f.compressionQuality)&&!m.isDefined(a.compressionQuality)&&(a.compressionQuality=f.compressionQuality))}}});e.callback(a)}):e.callback(a);return e}function ga(a,b){var c=a.dynamicLayerInfos||a.layerInfos,e=b.layers;if(e&&c){var f=[],g=[],h=[],k=[],l=[],n=[];d.forEach(c,function(b){var c=b.id;if(!b.subLayerIds&&-1!==d.indexOf(a.visibleLayers,c))for(b=0;b<e.length;b++){var p=
e[b];if(p.id===c){g.push(c);f.push(p.popupInfo);h.push(p.layerUrl||"");p.layerDefinition&&p.layerDefinition.definitionExpression?k.push(p.layerDefinition.definitionExpression):k.push("");l.push(m.isDefined(p.minScale)?p.minScale:null);n.push(m.isDefined(p.maxScale)?p.maxScale:null);break}}});f.length&&(a.__popups=f,a.__popupIds=g,a.__popupUrls=h,a.__popupWhereClauses=k,a.__popupMinScales=l,a.__popupMaxScales=n,a.__resourceInfo=b.resourceInfo)}}function pa(a){if(!a)return!1;var b=(new n(J.arcgisUrl)).authority;
return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function qa(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function S(a){if("https:"===location.protocol&&(pa(a)||qa(a)))a=a.replace("http:","https:");return a}function ha(a){var b=[];a.displayLevels||(b=d.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));b=new L(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||b,
id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});ga(b,a);return b}function ia(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function ra(a){var b=new H;b.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&
-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&(b.format="png32");var b=new I(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:b,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),c=a.visibleLayers;if(!a.visibleLayers){var e="";d.forEach(b.layerInfos,function(a){a.defaultVisibility&&(e+=(0<e.length?",":"")+a.id)});c=e}if(a.layers&&0<a.layers.length){var f=[],g=[],h,k=[],m;d.forEach(a.layers,function(b){b.layerDefinition&&
b.layerDefinition.definitionExpression&&(f[b.id]=b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){h=new N(l.mixin(b,b.layerDefinition));delete h.layerDefinition;h.id=b.id;if(a.visibleLayers){var c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers;-1<d.indexOf(c,b.id)?h.defaultVisibility=!0:h.defaultVisibility=!1}g.push(h)}b.layerDefinition&&(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(m=new F(b.layerDefinition.drawingInfo),
k[b.id]=m)},this);0<f.length&&b.setLayerDefinitions(f);0<g.length?(b.setDynamicLayerInfos(g,!0),0<k.length&&b.setLayerDrawingOptions(k,!0)):(c=ia(b.layerInfos,c),b.setVisibleLayers(c))}else c=ia(b.layerInfos,c),b.setVisibleLayers(c);ga(b,a);return b}function Ga(a,b){var c=new Y;c.bandIds=a.bandIds;null!=a.format&&(c.format=a.format,null!=a.compressionQuality&&(c.compressionQuality=a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var d=new O(a.renderingRule);c.renderingRule=
d}a.mosaicRule&&(d=new V(a.mosaicRule),c.mosaicRule=d);m.isDefined(a.noData)&&(c.noData=a.noData);m.isDefined(a.noDataInterpretation)&&(c.noDataInterpretation=a.noDataInterpretation);m.isDefined(a.interpolation)&&(c.interpolation=a.interpolation);c=new K(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:c,infoTemplate:a.popupInfo&&new b(a.popupInfo),minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});a.layerDefinition&&
a.layerDefinition.definitionExpression&&c.setDefinitionExpression(a.layerDefinition.definitionExpression,!0);return c}function ja(a,b,c){var e=[102113,102100,3857],f=c||new h(b[0].layerObject.fullExtent.spatialReference),g=new h(a.resourceInfo.fullExtent.spatialReference);return f.wkt==g.wkt&&(f.wkid==g.wkid||m.isDefined(f.latestWkid)&&f.latestWkid==g.wkid||m.isDefined(g.latestWkid)&&f.wkid==g.latestWkid||m.isDefined(f.latestWkid)&&f.latestWkid==g.latestWkid)||f.wkid&&g.wkid&&d.some(e,function(a){return a===
g.wkid})&&d.some(e,function(a){return a===f.wkid})?!0:!1}function ka(a,b){if(!b[0].layerObject.tileInfo)return!1;var c=[];d.forEach(b,function(a){a.baseMapLayer&&a.layerObject.tileInfo&&(c=c.concat(d.map(a.layerObject.tileInfo.lods,function(a){return a.scale})))});return d.some(a.resourceInfo.tileInfo.lods,function(a){return d.some(c,function(b){return b===a.scale})})}function la(a,c,f,g,k){var n,q=f._clazz;if("OpenStreetMap"===a.type)n=new U({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&
void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var t=[],u=[];d.forEach(a.layers,function(a){u.push(new R({name:a.name,title:a.title,legendURL:a.legendURL}));t.push(a.name)},this);a.visibleLayers&&(t=a.visibleLayers);g={extent:new r(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new h({wkid:4326})),layerInfos:u,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright};n=new M(a.url,
{id:a.id,visibleLayers:t,format:"png",transparent:a.baseMapLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:!0,resourceInfo:g,refreshInterval:a.refreshInterval});n.spatialReference.wkid=g.spatialReferences[0]}else if("KML"===a.type){f=a.url;if(e.id&&(q=e.id.findCredential(b.urlToObject(J.arcgisUrl).path))){c=J.arcgisUrl.substring(J.arcgisUrl.indexOf("//")+2,J.arcgisUrl.indexOf("/",J.arcgisUrl.indexOf("//")+3));k=c.split(".");k=k[k.length-2]+"."+k[k.length-1];var v=f.indexOf(k);
-1<v&&(f="https://"+c+f.substring(v+k.length));f+="?token\x3d"+q.token}n=new E(f,{id:a.id,visible:null!==a.visibility?a.visibility:!0,outSR:g,refreshInterval:a.refreshInterval});p.connect(n,"onLoad",function(){var b=function(c){d.forEach(c,function(c){"esri.layers.FeatureLayer"===c.declaredClass||"esri.layers.MapImageLayer"===c.declaredClass?c.setOpacity(a.opacity):"esri.layers.KMLLayer"===c.declaredClass&&(c.loaded?b(c.getLayers()):p.connect(c,"onLoad",l.hitch(this,function(a){b(a.getLayers())})))})};
(a.opacity||0===a.opacity)&&b(n.getLayers());a.visibleFolders&&d.forEach(n.folders,function(b){-1<d.indexOf(a.visibleFolders,b.id)?n.setFolderVisibility(b,!0):n.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(n=new fa(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new r(a.fullExtent),initialExtent:a.fullExtent&&new r(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new X(a.tileInfo):null,
refreshInterval:a.refreshInterval}),p.connect(n,"onLoad",function(){(m.isDefined(a.minScale)||m.isDefined(a.maxScale))&&n.setScaleRange(a.minScale,a.maxScale)})):"GeoRSS"===a.type?(n=new Q(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:g,refreshInterval:a.refreshInterval}),p.connect(n,"onLoad",function(){!1===a.visibility&&n.hide();var b=n.getFeatureLayers();d.forEach(b,function(b){a.pointSymbol&&"esriGeometryPoint"===b.geometryType?b.renderer.symbol=y.fromJson(a.pointSymbol):a.lineSymbol&&
"esriGeometryPolyline"===b.geometryType?b.renderer.symbol=y.fromJson(a.lineSymbol):a.polygonSymbol&&"esriGeometryPolygon"===b.geometryType&&(b.renderer.symbol=y.fromJson(a.polygonSymbol));(m.isDefined(a.minScale)||m.isDefined(a.maxScale))&&b.setScaleRange(a.minScale,a.maxScale)})})):"CSV"==a.type&&a.url?n=new G(a.featureCollection,{infoTemplate:new C(a.popupInfo?a.popupInfo:B.generateDefaultPopupInfo(a.featureCollection)),id:a.id?a.id:null,outFields:["*"],visible:null!==a.visibility?a.visibility:
!0,opacity:a.opacity,autoGeneralize:!0}):a.layerDefinition&&!a.url?(g=s.fromJson(s.toJson(a)),delete g.id,delete g.opacity,delete g.visibility,n=new G(g,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],infoTemplate:g.popupInfo&&new q(g.popupInfo),autoGeneralize:!0})):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?f.bingMapsKey?(g=D.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?g=D.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(g=D.MAP_STYLE_ROAD),
n=new D({bingMapsKey:f.bingMapsKey,mapStyle:g,opacity:a.opacity,id:a.id}),p.connect(n,"onError",dojo.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?n=!0===
a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ja(a,c,g)&&ka(a,k))?ha(a):ra(a):a.resourceInfo&&a.resourceInfo.pixelSizeX?n=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ja(a,c,g)&&ka(a,k))?ha(a):Ga(a,q):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type&&(n=new G(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:m.isDefined(a.mode)?a.mode:G.MODE_ONDEMAND,outFields:["*"],infoTemplate:a.popupInfo&&new q(a.popupInfo),autoGeneralize:!0,refreshInterval:a.refreshInterval}),
a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(g=w.fromJson(a.layerDefinition.drawingInfo.renderer),g.isMaxInclusive=!0,n.setRenderer(g)),a.layerDefinition.definitionExpression&&n.setDefinitionExpression(a.layerDefinition.definitionExpression),m.isDefined(a.layerDefinition.minScale)&&n.setMinScale(a.layerDefinition.minScale),m.isDefined(a.layerDefinition.maxScale)&&n.setMaxScale(a.layerDefinition.maxScale)));n&&(n.arcgisProps={title:a.title},a.baseMapLayer&&
(n._basemapGalleryLayerType=a.isReference?"reference":"basemap"));return n}function $(a,b,c,e){d.forEach(a,function(d,f){if(d.url&&!d.type){if(0===f||a[0].layerObject)d.layerObject=la(d,a,b,c,e)}else d.layerObject=la(d,a,b,c,e)});var f=d.filter(a,function(a){return!a.isReference}),g=d.filter(a,function(a){return!!a.isReference});return a=f.concat(g)}function ma(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new h,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),
a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new h({wkid:102100}):"WMS"==a.type&&(b=new h({wkid:a.spatialReferences[0]}));return b}function sa(a,b,e,f,g,h,k){d.forEach(b,function(b,c){b.url&&!b.type?(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos):b.url&&"CSV"==b.type&&(b.featureCollection=f[b.deferredsPos].results[0],delete b.deferredsPos)});h=h||ma(b);var l=[];d.forEach(b,function(a){a.url&&
"CSV"==a.type&&(a.deferredsPos=l.length,l.push(B.projectFeatureCollection(a.featureCollection,h)))});0==l.length?(b=$(b,e,h,k),g.callback(b)):(new c(l)).addCallback(function(){d.forEach(b,function(a){a.url&&"CSV"==a.type&&(a.featureCollection=l[a.deferredsPos].results[0],delete a.deferredsPos)});b=$(b,e,h,k);g.callback(b)});return g}function ta(a,b){var c=S(a);return q({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+
c+"]";b.push(a);u.defaults.io.errorHandler(a,d)}})}function ua(a){var b=J.arcgisUrl+"/"+a.itemId+"/data";return q({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);u.defaults.io.errorHandler(c,d)}})}function va(a,b,c){var d=new g;if(!c.featureCollection||!c.featureCollection.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=
a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),d.errback(),d;wa(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?dojo.forEach(c.featureCollection.layers,function(b,c){var d=a.featureCollection.layers[c];if(!d.poupInfo&&!d.layerDefinition)d.popupInfo=b.popupInfo,d.layerDefinition=b.layerDefinition;else if(d.layerDefinition){if(m.isDefined(d.layerDefinition.minScale)&&m.isDefined(d.layerDefinition.maxScale)&&
(d.layerDefinition.minScale!==b.layerDefinition.minScale||d.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minscale,delete b.layerDefinition.maxScale;d.layerDefinition.drawingInfo&&s.toJson(d.layerDefinition.drawingInfo)!==s.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;d.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;d.layerDefinition=dojo.mixin(d.layerDefinition,b.layerDefinition)}else d.layerDefinition=
b.layerDefinition;d.featureSet=b.featureSet;d.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=dojo.mixin(a.featureCollection,c.featureCollection));d.callback(a)});return d}function wa(a,b,e){var f=new g,h=[];d.forEach(b.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=h.length,h.push(B.projectFeatureCollection(a,
e,a.featureSet.features[0].geometry.spatialReference)))});(new c(h)).addCallback(function(){d.forEach(b.layers,function(b){esri.isDefined(b.deferredsPos)&&(h[b.deferredsPos].results&&h[b.deferredsPos].results.length?b=h[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});f.callback(b)});
return f}function aa(a,b,e,f){var h=new g,k=[];d.forEach(a.operationalLayers,function(a,b){a.itemId&&"Feature Collection"==a.type&&k.push(ua(a).then(l.hitch(null,va,a,e)))});0==k.length?xa(a,b,e,f,h):(new c(k)).addCallback(function(c){xa(a,b,e,f,h)});return h}function xa(a,b,e,f,g){var h=[],k=[],l=[];d.forEach(a.operationalLayers,function(a,b){a.featureCollection?d.forEach(a.featureCollection.layers,function(c,e){var f=!0;a.visibleLayers&&-1==d.indexOf(a.visibleLayers,e)&&(f=!1);c.visibility=a.visibility&&
f;c.opacity=a.opacity;c.id=(a.id||"operational"+b)+"_"+e;l.push(c)},this):l.push(a)});d.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;h.push(a)});d.forEach(l,function(a,b){a.id=a.id||"operational"+b;h.push(a)});d.forEach(h,function(a){a.url&&!a.type?(a.deferredsPos=k.length,a.errors=a.errors||[],k.push(ta(a.url,a.errors))):a.url&&"CSV"==a.type&&(a.deferredsPos=k.length,k.push(B.buildCSVFeatureCollection(a)))});0==k.length?(e=e||ma(h),h=$(h,b,e,f),g.callback(h)):
(new c(k)).addCallback(function(a){sa(a,h,b,k,g,e,f)});return g}function ba(a,b,c,e){var f=a.minScale,g=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==e)if(0==f&&0<b[a].minScale?f=b[a].minScale:0<f&&0==b[a].minScale?f=c.minScale:0<f&&0<b[a].minScale&&(f=Math.min(f,b[a].minScale)),g=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(f,g),-1<b[a].parentLayerId)e=b[a].parentLayerId;else break}else 10.1<c.version&&(d.forEach(a.layerInfos,function(a){a.id==e&&(0==f&&0<a.minScale?
f=a.minScale:0<f&&0==a.minScale||0<f&&0<a.minScale&&(f=Math.min(f,a.minScale)),g=Math.max(g||0,a.maxScale||0))}),c.setScaleRange(f,g))}function ca(a,b,c,e){var f=a.url,g=a.__popupIds,h=a.__popupUrls,k=a.__popupWhereClauses,n=a.__popupMinScales,q=a.__popupMaxScales,t=a.__resourceInfo,s=[];d.forEach(a.__popups,function(e,l){if(e){var r,u=[];d.forEach(e.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var v=d.filter(a.dynamicLayerInfos,
function(a){return g[l]==a.id})[0].source;r=new G(f+"/dynamicLayer",{id:a.id+"_"+g[l],source:v,outFields:u,mode:G.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,autoGeneralize:!0});var x=function(c,d){0<k[c].length&&d.setDefinitionExpression(k[c]);if(!m.isDefined(n[c])&&!m.isDefined(q[c]))ba(a,b||t.layers,d,g[c]);else if(m.isDefined(a.minScale)||m.isDefined(a.maxScale)){var e=a.minScale,f=a.maxScale;0==e&&0<n[c]?e=n[c]:0<e&&0==n[c]||0<e&&0<n[c]&&(e=Math.min(e,n[c]));f=Math.max(f||
0,q[c]||0);d.setScaleRange(e,f)}else d.setScaleRange(n[c],q[c])};r.loaded?x(l,r):p.connect(r,"onLoad",function(a){x(l,r)})}else{var w,v=null;if(b)for(w=0;w<b.length;w++)if(b[w].id===g[l]){v=b[w];break}w=f+"/"+g[l];h[l].length&&(w=h[l]);r=new G(S(w),{id:a.id+"_"+g[l],outFields:u,mode:G.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,resourceInfo:v,autoGeneralize:!0});r.loaded?(0<k[l].length&&r.setDefinitionExpression(k[l]),ba(a,b||t.layers,r,g[l])):p.connect(r,"onLoad",function(c){0<
k[l].length&&r.setDefinitionExpression(k[l]);ba(a,b||t.layers,c,g[l])})}s.push(r)}});0<s.length&&(p.connect(a,"onVisibilityChange",l.hitch(this,function(a,b){d.forEach(a,function(a){b?a.show():a.hide()})},s)),p.connect(e,"onLayerRemove",l.hitch(this,function(a,b,c){a.id===c.id&&d.forEach(b,function(a){e.removeLayer(a)})},a,s)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return s}
function ya(a){return q({url:S(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function za(a,b,e){var f=[];d.forEach(a,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=f.length,f.push(ya(a)))});var g=[];0<f.length?(new c(f)).addCallback(function(c){d.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(g=g.concat(ca(a,c[a.__deferredsPos][1].layers,e,b)),delete a.__deferredsPos):g=g.concat(ca(a,
null,e,b)))});b.addLayers(g)}):(d.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(g=g.concat(ca(a,null,e,b)))}),b.addLayers(g))}function Aa(a){d.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&-1<b.name.indexOf("Text")&&d.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},
this))})}function Ba(a){var b=6;d.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&d.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function da(a){var b=
this,c=b.infoWindow,e=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var f=[];d.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("FeatureLayer")&&a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&f.push(a)});d.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&f.push(a)});e=e&&e.getInfoTemplate()?e:null;if(f.length||e){var h=Ba(f),k=a.screenPoint,
l=b.toMap(new t(k.x-h,k.y+h)),h=b.toMap(new t(k.x+h,k.y-h)),l=new r(l.x,l.y,h.x,h.y,b.spatialReference),m=new A;m.geometry=l;m.timeExtent=b.timeExtent;var n=!0,l=d.map(f,function(a){var b;-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?(n=!1,b=a.queryVisibleRasters(m,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),b.addCallback(function(){return a.getVisibleRasters()})):(b=a.selectFeatures(m),b.addCallback(function(){return a.getSelectedFeatures()}));return b});e&&(h=new g,
h.callback([e]),l.splice(0,0,h));if(!d.some(l,function(a){return-1===a.fired})){var p=e?1:0;d.forEach(f,function(a){p=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?p+a.getVisibleRasters().length:p+a.getSelectedFeatures().length});if(!p)return}c.setFeatures(l);c.show(a.mapPoint,{closestFirst:n})}}}function Ha(b,c){var d=c.mapOptions||{},e;d.infoWindow||(e=new z({visibleWhenEmpty:!1},a.create("div")),d.infoWindow=e);m.isDefined(d.showInfoWindowOnClick)||(d.showInfoWindowOnClick=!1);d=new k(b,
d);p.connect(d,"onLayersAddResult",Aa);return d}function T(a,b,c,e,f,g){var h,k,l;e.map?(h=e.map,k=e.clickEventHandle,l=e.errors):(h=Ha(e,f),!f.ignorePopups&&!f.disableClickBehavior&&(k=p.connect(h,"onClick",da)));f.ignorePopups&&d.forEach(a,function(a){delete a.infoTemplate});h.addLayers(a);f.ignorePopups||za(a,h,f._clazz);var m=l||[];d.forEach(b,function(a){a.errors&&(m=m.concat(a.errors))},this);h.loaded?g.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:da}):p.connect(h,
"onLoad",function(){g.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:da})})}function ea(a,b,c,e,f){var g=[];d.forEach(f,function(a){l.isArray(a.layerObject)?d.forEach(a.layerObject,function(a){g.push(a)}):g.push(a.layerObject)});if("BingMapsAerial"===f[0].type||"BingMapsRoad"===f[0].type||"BingMapsHybrid"===f[0].type)var h=setInterval(function(){if(f[0].layerObject&&f[0].layerObject.loaded)clearInterval(h),Ca(a,b,c,e,f,g);else if(f[0].errors){clearInterval(h);var d="";f[0].errors&&
f[0].errors.length&&(d=" ("+f[0].errors[0].message+")");e.errback(Error(P.arcgis.utils.baseLayerError+d))}},10);else if(!g[0]&&f[0].baseMapLayer){var k="";f[0].errors&&f[0].errors.length&&(k=" ("+f[0].errors[0].message+")");e.errback(Error(P.arcgis.utils.baseLayerError+k))}else Ca(a,b,c,e,f,g)}function Ca(a,b,c,e,f,g){try{var k=c.mapOptions||{};c.mapOptions=k;var l=a.item;g=d.filter(g,m.isDefined);if(l)if(l.extent&&l.extent.length)if(k.extent)T(g,f,a,b,c,e);else{var n=new r(l.extent[0][0],l.extent[0][1],
l.extent[1][0],l.extent[1][1],new h({wkid:4326})),p=g[0].spatialReference;4326===p.wkid?(k.extent=n,T(g,f,a,b,c,e)):102100===p.wkid||102113===p.wkid||3857===p.wkid?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,89.99),k.extent=v.geographicToWebMercator(n),T(g,f,a,b,c,e)):c.geometryServiceURL||u.defaults.geometryService?(c.geometryServiceURL?new x(c.geometryServiceURL):u.defaults.geometryService).project([n],p,function(d){d=d[0];k.extent=
k.extent||d;T(g,f,a,b,c,e)},function(){T(g,f,a,b,c,e)}):e.errback(Error(P.arcgis.utils.geometryServiceError))}else T(g,f,a,b,c,e);else T(g,f,a,b,c,e)}catch(q){e.errback(q)}}function Da(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);d.forEach(a,function(a,c){var e={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&d.forEach(a.featureCollection.layers,function(c){!1!==c.showLegend&&(e={layer:c.layerObject,title:a.title,defaultSymbol:c.renderer&&c.renderer.defaultSymbol&&
c.renderer.defaultLabel?!0:!1},1<a.featureCollection.layers.length&&(e.title+=" - "+c.layerDefinition.name),b.push(e))});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject){var f=a.layerObject.renderer,f=!f||f&&f.defaultSymbol&&f.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&(a.layerObject instanceof I||a.layerObject instanceof L)||a.layerObject instanceof esri.layers.ArcGISImageServiceLayer)f=!0;e={layer:a.layerObject,title:a.title,defaultSymbol:f};
a.layers&&(f=d.map(d.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),f.length&&(e.hideLayers=f));b.push(e)}});return b}function Ea(a,b,c,e){if(!e.itemData.operationalLayers||0===e.itemData.operationalLayers.length)Z(e,b).addCallback(function(d){aa(d.itemData,b).addCallback(l.hitch(null,ea,d,a,b,c))});else{var f=new g,h=e.itemData.baseMap.baseMapLayers.slice(0),k=d.filter(e.itemData.baseMap.baseMapLayers,function(a){return!a.isReference}),m={item:e.item,itemData:{baseMap:{baseMapLayers:k}}};
e.itemData.baseMap.baseMapLayers=d.filter(e.itemData.baseMap.baseMapLayers,function(a){return a.isReference});Z(m,b).addCallback(function(c){aa(c.itemData,b).addCallback(l.hitch(null,ea,c,a,b,f))});f.then(function(a){Z(e,b).addCallback(function(d){aa(d.itemData,b,a.map.spatialReference,k).addCallback(function(e){d.itemData.baseMap.baseMapLayers=h;ea(d,a,b,c,e)})})},l.hitch(c,c.errback))}}function Fa(a){J._arcgisUrl&&0<J._arcgisUrl.length&&(J.arcgisUrl=J._arcgisUrl);var b=J.arcgisUrl+"/"+a,c={},d=
new g;q({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a){c.item=a;q({url:b+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){c.itemData=a;d.callback(c)},error:function(a){d.errback(a)}})},error:function(a){d.errback(a)}});return d}String.prototype.endsWith=function(a){return this.match(a+"$")==a};var J;J={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:Fa,createMap:function(a,b,c){var d=new g;c=c||{};var e=c.infoTemplateClass;
c._clazz=e&&(l.isObject(e)?e:l.getObject(e))||C;l.isString(a)?Fa(a).addCallback(l.hitch(null,Ea,b,c,d)).addErrback(l.hitch(d,d.errback)):Ea(b,c,d,a);return d},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Da(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:Z,_getItemData:W,_getBingKey:na,_processFSItemProperties:oa,_getLayers:aa,_preBuildLayerObjects:sa,_buildLayerObjects:$,_preCreateMap:ea,_getMapSR:ma,_createMap:T,_addSelectionLayers:za,_createSelectionFeatureLayers:ca,
_getServiceInfo:ta,_getFeatureCollectionItem:ua,_mergeFeatureCollectionItem:va,_projectFeatureCollection:wa,_getLayersInfo:ya,_initLayer:la,_loadAsCached:ha,_loadAsDynamic:ra,_processPopups:ga,_onLayersAddResult:Aa,_sameSpatialReferenceAsBasemap:ja,_sameTilingSchemeAsBasemap:ka,_showPopup:da,_calculateClickTolerance:Ba,_getVisibleFeatureLayers:ia,_updateLayerScaleInfo:ba,_checkUrl:S,_isHostedService:pa,_isAgolService:qa,_getLegendLayers:Da};l.setObject("arcgis.utils",J,e);return J});